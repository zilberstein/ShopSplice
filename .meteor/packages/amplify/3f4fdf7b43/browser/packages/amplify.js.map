{"version":3,"file":"/packages/amplify.js","sources":["amplify/amplify.js"],"names":[],"mappings":";;;;;;;;AAAA,G;AACA,yC;AACA,G;AACA,0D;AACA,+C;AACA,2C;AACA,G;AACA,uB;AACA,G;AACA,G;AACA,qB;AACA,G;AACA,0D;AACA,+C;AACA,2C;AACA,G;AACA,uB;AACA,G;AACA,gC;;AAEA,qB;AACA,oB;;AAEA,gC;AACA,6B;AACA,wC;AACA,sB;AACA,gB;AACA,U;AACA,S;AACA,O;;AAEA,kC;AACA,e;AACA,G;;AAEA,sD;AACA,+D;AACA,0C;AACA,mE;AACA,yB;AACA,U;AACA,I;AACA,G;AACA,uB;AACA,G;;AAEA,4D;AACA,iE;AACA,uB;AACA,sB;AACA,kB;AACA,G;AACA,iC;AACA,sB;AACA,kB;AACA,G;AACA,4B;;AAEA,qB;AACA,gC;AACA,+B;AACA,S;AACA,oD;AACA,gC;AACA,iB;AACA,mC;AACA,gC;AACA,I;AACA,C;AACA,6C;AACA,wB;AACA,wB;AACA,sB;AACA,uB;AACA,M;AACA,C;AACA,0B;AACA,6D;AACA,iE;AACA,kB;AACA,W;AACA,K;AACA,I;;AAEA,kB;AACA,uD;AACA,I;AACA,G;;AAEA,kB;AACA,G;;AAEA,2C;AACA,kC;AACA,U;AACA,G;;AAEA,6C;AACA,S;;AAEA,6B;AACA,6D;AACA,0C;AACA,U;AACA,I;AACA,G;AACA,E;AACA,E;;AAEA,Y;AACA,G;AACA,uD;AACA,G;AACA,0D;AACA,+C;AACA,2C;AACA,G;AACA,uB;AACA,G;AACA,iC;;AAEA,mE;AACA,uB;AACA,gE;AACA,sB;AACA,E;AACA,yD;AACA,E;;AAEA,iB;AACA,kB;AACA,2C;AACA,qB;AACA,oB;AACA,E;;AAEA,+B;AACA,kD;AACA,0B;AACA,sB;AACA,sC;AACA,G;AACA,C;AACA,0B;AACA,wC;AACA,E;;AAEA,6B;AACA,6D;AACA,8D;AACA,qC;AACA,e;AACA,gC;;AAEA,e;AACA,Y;AACA,e;AACA,S;AACA,Q;AACA,oE;AACA,4D;AACA,oE;AACA,mC;AACA,0D;AACA,yB;;AAEA,wC;AACA,iC;AACA,oD;AACA,sD;AACA,0B;AACA,c;AACA,uD;AACA,O;AACA,M;AACA,K;AACA,kC;AACA,+B;AACA,K;AACA,uB;AACA,c;AACA,G;;AAEA,wD;AACA,4B;;AAEA,8B;AACA,wC;AACA,sE;AACA,mD;AACA,8B;AACA,W;AACA,uB;AACA,I;AACA,U;AACA,0B;AACA,8B;AACA,W;AACA,6B;AACA,iB;AACA,4D;AACA,O;AACA,S;AACA,oC;AACA,qB;AACA,sB;AACA,qC;AACA,4B;AACA,U;AACA,qC;AACA,uB;AACA,0B;AACA,M;AACA,K;AACA,I;AACA,G;;AAEA,a;AACA,I;AACA,C;;AAEA,gC;AACA,gF;AACA,sE;AACA,0C;AACA,M;AACA,2C;AACA,0E;AACA,G;AACA,gB;AACA,C;;AAEA,gB;AACA,2B;AACA,6D;AACA,6B;AACA,0C;AACA,M;AACA,8C;AACA,sD;AACA,8D;AACA,0C;AACA,2E;AACA,0C;AACA,gC;AACA,G;AACA,gB;AACA,C;;AAEA,W;AACA,sB;AACA,iE;AACA,a;AACA,oD;AACA,oD;AACA,2D;AACA,kC;AACA,S;AACA,E;;AAEA,kE;AACA,2C;AACA,sB;AACA,4B;AACA,iE;;AAEA,4C;AACA,mC;AACA,0E;AACA,uC;AACA,M;AACA,yC;AACA,sB;AACA,e;AACA,oC;AACA,S;AACA,E;;AAEA,6D;AACA,sB;AACA,yC;AACA,e;AACA,gC;;AAEA,e;AACA,Y;AACA,e;AACA,S;AACA,uE;AACA,sC;AACA,oD;AACA,8B;AACA,Y;AACA,oC;AACA,K;AACA,I;AACA,iC;AACA,+B;AACA,I;AACA,uB;AACA,c;AACA,G;;AAEA,yC;AACA,0C;AACA,yD;AACA,gE;AACA,kI;;AAEA,8B;AACA,kC;AACA,wD;AACA,mD;AACA,+B;AACA,W;AACA,uB;AACA,I;AACA,U;AACA,0B;AACA,+B;AACA,W;AACA,oE;AACA,wC;AACA,6B;AACA,iB;AACA,gE;AACA,O;AACA,oC;AACA,I;AACA,G;;AAEA,O;AACA,uB;AACA,mB;AACA,qB;AACA,+C;AACA,8B;AACA,+B;AACA,W;AACA,uC;AACA,I;;AAEA,mC;AACA,oB;AACA,Q;AACA,oC;AACA,wB;AACA,sB;AACA,gD;AACA,+B;AACA,gC;AACA,Y;AACA,wC;AACA,K;AACA,wB;AACA,I;AACA,G;AACA,a;AACA,I;AACA,M;;AAEA,oB;AACA,4E;AACA,a;AACA,iB;AACA,e;;AAEA,uB;AACA,6E;AACA,E;;AAEA,2D;AACA,e;AACA,yB;AACA,G;;AAEA,8B;AACA,gC;AACA,G;;AAEA,yB;AACA,kC;AACA,yB;AACA,G;;AAEA,yB;AACA,wB;AACA,e;AACA,G;;AAEA,wB;AACA,0B;AACA,2C;AACA,yB;AACA,0B;AACA,wB;AACA,G;;AAEA,e;AACA,I;AACA,M;;AAEA,yC;AACA,G;AACA,wB;AACA,G;AACA,0D;AACA,+C;AACA,2C;AACA,G;AACA,uB;AACA,G;AACA,iC;;AAEA,kB;AACA,4B;AACA,0D;AACA,C;;AAEA,sB;AACA,qB;AACA,wB;AACA,iB;AACA,Q;AACA,oB;AACA,kB;AACA,oB;AACA,kB;AACA,0B;AACA,U;AACA,0B;AACA,2B;AACA,U;AACA,G;AACA,G;AACA,C;;AAEA,0D;AACA,uE;AACA,gB;AACA,iC;;AAEA,sC;AACA,6B;AACA,mB;AACA,a;AACA,G;AACA,c;AACA,0B;AACA,oB;AACA,oB;AACA,I;AACA,E;;AAEA,+B;AACA,8D;AACA,qC;AACA,iC;AACA,qD;AACA,+B;AACA,+D;AACA,gE;AACA,0B;AACA,I;AACA,mD;AACA,6B;AACA,6D;AACA,gE;AACA,wB;AACA,I;;AAEA,mB;AACA,+B;AACA,mD;AACA,G;AACA,sE;AACA,E;;AAEA,wD;AACA,kC;AACA,S;AACA,E;;AAEA,uE;AACA,gB;AACA,E;;AAEA,2B;AACA,+B;AACA,iE;AACA,kC;AACA,6C;AACA,yD;AACA,G;;AAEA,mC;AACA,2C;AACA,6C;AACA,S;AACA,kE;AACA,iD;AACA,E;AACA,E;;AAEA,e;;;;;;AAMA,oC;;AAEA,uF;AACA,+B;;AAEA,uD;AACA,0B;AACA,a;AACA,mB;;AAEA,uC;AACA,U;AACA,0B;AACA,yB;AACA,8E;AACA,mB;AACA,a;AACA,kB;AACA,+C;AACA,gD;AACA,M;AACA,uC;AACA,wC;AACA,M;AACA,wC;AACA,yC;AACA,M;AACA,wC;AACA,yC;AACA,M;AACA,uB;AACA,oB;AACA,U;AACA,kB;AACA,iD;AACA,oB;AACA,qC;AACA,M;AACA,uC;AACA,sC;AACA,M;AACA,qC;AACA,oC;AACA,K;AACA,K;;AAEA,6C;AACA,kD;;AAEA,2B;AACA,sC;AACA,mC;AACA,K;AACA,oC;AACA,mC;AACA,K;AACA,gD;AACA,e;AACA,iC;AACA,uC;AACA,uE;AACA,yD;AACA,oD;AACA,I;AACA,K;AACA,yB;;AAEA,2C;AACA,yC;AACA,S;AACA,gC;AACA,mB;AACA,M;AACA,wC;AACA,8C;AACA,2C;AACA,kC;AACA,I;AACA,8B;AACA,kD;AACA,gB;AACA,I;AACA,mB;AACA,qB;AACA,I;AACA,gD;AACA,iC;AACA,W;AACA,mC;AACA,I;AACA,8C;AACA,6C;AACA,qE;AACA,2B;AACA,G;;AAEA,8B;AACA,kB;AACA,sB;AACA,I;AACA,G;AACA,E;;;;AAIA,gG;AACA,qB;AACA,2B;;AAEA,kC;AACA,S;AACA,E;;AAEA,sD;;AAEA,6E;AACA,sB;AACA,6B;AACA,yB;AACA,G;AACA,I;;AAEA,6D;AACA,0C;AACA,qB;AACA,I;;AAEA,0B;AACA,G;;;;AAIA,gG;AACA,8B;AACA,iC;;AAEA,8C;AACA,S;AACA,E;;AAEA,iC;AACA,sC;AACA,S;AACA,2D;AACA,wB;AACA,mC;AACA,wB;AACA,I;AACA,K;AACA,2B;AACA,E;AACA,G;;;;AAIA,qC;AACA,0C;AACA,oB;AACA,2B;AACA,S;AACA,sB;;AAEA,wB;AACA,uB;AACA,G;;AAEA,oB;AACA,wC;AACA,kC;AACA,iC;AACA,gC;AACA,G;;AAEA,kD;AACA,G;;AAEA,wB;AACA,uB;AACA,+D;AACA,mE;AACA,kD;AACA,2C;AACA,8B;;AAEA,mC;AACA,8C;AACA,iB;AACA,I;AACA,gC;AACA,sC;AACA,mC;AACA,yC;AACA,4B;AACA,qC;AACA,mB;AACA,K;AACA,qC;AACA,K;AACA,I;AACA,K;AACA,E;;AAEA,sB;AACA,gD;AACA,wE;AACA,kD;AACA,2C;AACA,+C;;AAEA,kB;AACA,mC;AACA,iB;AACA,I;AACA,gC;AACA,uC;AACA,iF;AACA,qC;AACA,K;AACA,I;AACA,I;AACA,6C;AACA,C;;AAEA,gE;AACA,gC;AACA,mB;AACA,2D;AACA,0C;AACA,6D;AACA,6B;AACA,E;AACA,G;;;;AAIA,4B;AACA,qC;AACA,0D;AACA,oC;AACA,wB;AACA,wC;AACA,8B;AACA,yC;AACA,sB;AACA,0B;AACA,G;AACA,E;AACA,E;;AAEA,gG;AACA,+B;AACA,wB;AACA,4C;AACA,qB;AACA,iD;AACA,kD;AACA,wC;;AAEA,kB;AACA,S;AACA,E;;AAEA,mC;AACA,2B;AACA,E;AACA,iC;AACA,yB;AACA,E;AACA,4C;AACA,kD;AACA,G;AACA,0C;AACA,kD;AACA,G;AACA,G;;AAEA,uB","sourcesContent":["/*!\n * AmplifyJS 1.1.0 - Core, Store, Request\n * \n * Copyright 2011 appendTo LLC. (http://appendto.com/team)\n * Dual licensed under the MIT or GPL licenses.\n * http://appendto.com/open-source-licenses\n * \n * http://amplifyjs.com\n */\n/*!\n * Amplify Core 1.1.0\n * \n * Copyright 2011 appendTo LLC. (http://appendto.com/team)\n * Dual licensed under the MIT or GPL licenses.\n * http://appendto.com/open-source-licenses\n * \n * http://amplifyjs.com\n */\n(function( global, undefined ) {\n\nvar slice = [].slice,\n\tsubscriptions = {};\n\nvar amplify = global.amplify = {\n\tpublish: function( topic ) {\n\t\tvar args = slice.call( arguments, 1 ),\n\t\t\ttopicSubscriptions,\n\t\t\tsubscription,\n\t\t\tlength,\n\t\t\ti = 0,\n\t\t\tret;\n\n\t\tif ( !subscriptions[ topic ] ) {\n\t\t\treturn true;\n\t\t}\n\n\t\ttopicSubscriptions = subscriptions[ topic ].slice();\n\t\tfor ( length = topicSubscriptions.length; i < length; i++ ) {\n\t\t\tsubscription = topicSubscriptions[ i ];\n\t\t\tret = subscription.callback.apply( subscription.context, args );\n\t\t\tif ( ret === false ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn ret !== false;\n\t},\n\n\tsubscribe: function( topic, context, callback, priority ) {\n\t\tif ( arguments.length === 3 && typeof callback === \"number\" ) {\n\t\t\tpriority = callback;\n\t\t\tcallback = context;\n\t\t\tcontext = null;\n\t\t}\n\t\tif ( arguments.length === 2 ) {\n\t\t\tcallback = context;\n\t\t\tcontext = null;\n\t\t}\n\t\tpriority = priority || 10;\n\n\t\tvar topicIndex = 0,\n\t\t\ttopics = topic.split( /\\s/ ),\n\t\t\ttopicLength = topics.length,\n\t\t\tadded;\n\t\tfor ( ; topicIndex < topicLength; topicIndex++ ) {\n\t\t\ttopic = topics[ topicIndex ];\n\t\t\tadded = false;\n\t\t\tif ( !subscriptions[ topic ] ) {\n\t\t\t\tsubscriptions[ topic ] = [];\n\t\t\t}\n\t\n\t\t\tvar i = subscriptions[ topic ].length - 1,\n\t\t\t\tsubscriptionInfo = {\n\t\t\t\t\tcallback: callback,\n\t\t\t\t\tcontext: context,\n\t\t\t\t\tpriority: priority\n\t\t\t\t};\n\t\n\t\t\tfor ( ; i >= 0; i-- ) {\n\t\t\t\tif ( subscriptions[ topic ][ i ].priority <= priority ) {\n\t\t\t\t\tsubscriptions[ topic ].splice( i + 1, 0, subscriptionInfo );\n\t\t\t\t\tadded = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( !added ) {\n\t\t\t\tsubscriptions[ topic ].unshift( subscriptionInfo );\n\t\t\t}\n\t\t}\n\n\t\treturn callback;\n\t},\n\n\tunsubscribe: function( topic, callback ) {\n\t\tif ( !subscriptions[ topic ] ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar length = subscriptions[ topic ].length,\n\t\t\ti = 0;\n\n\t\tfor ( ; i < length; i++ ) {\n\t\t\tif ( subscriptions[ topic ][ i ].callback === callback ) {\n\t\t\t\tsubscriptions[ topic ].splice( i, 1 );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n};\n\n}( this ) );\n/*!\n * Amplify Store - Persistent Client-Side Storage 1.1.0\n * \n * Copyright 2011 appendTo LLC. (http://appendto.com/team)\n * Dual licensed under the MIT or GPL licenses.\n * http://appendto.com/open-source-licenses\n * \n * http://amplifyjs.com\n */\n(function( amplify, undefined ) {\n\nvar store = amplify.store = function( key, value, options, type ) {\n\tvar type = store.type;\n\tif ( options && options.type && options.type in store.types ) {\n\t\ttype = options.type;\n\t}\n\treturn store.types[ type ]( key, value, options || {} );\n};\n\nstore.types = {};\nstore.type = null;\nstore.addType = function( type, storage ) {\n\tif ( !store.type ) {\n\t\tstore.type = type;\n\t}\n\n\tstore.types[ type ] = storage;\n\tstore[ type ] = function( key, value, options ) {\n\t\toptions = options || {};\n\t\toptions.type = type;\n\t\treturn store( key, value, options );\n\t};\n}\nstore.error = function() {\n\treturn \"amplify.store quota exceeded\"; \n};\n\nvar rprefix = /^__amplify__/;\nfunction createFromStorageInterface( storageType, storage ) {\n\tstore.addType( storageType, function( key, value, options ) {\n\t\tvar storedValue, parsed, i, remove,\n\t\t\tret = value,\n\t\t\tnow = (new Date()).getTime();\n\n\t\tif ( !key ) {\n\t\t\tret = {};\n\t\t\tremove = [];\n\t\t\ti = 0;\n\t\t\ttry {\n\t\t\t\t// accessing the length property works around a localStorage bug\n\t\t\t\t// in Firefox 4.0 where the keys don't update cross-page\n\t\t\t\t// we assign to key just to avoid Closure Compiler from removing\n\t\t\t\t// the access as \"useless code\"\n\t\t\t\t// https://bugzilla.mozilla.org/show_bug.cgi?id=662511\n\t\t\t\tkey = storage.length;\n\n\t\t\t\twhile ( key = storage.key( i++ ) ) {\n\t\t\t\t\tif ( rprefix.test( key ) ) {\n\t\t\t\t\t\tparsed = JSON.parse( storage.getItem( key ) );\n\t\t\t\t\t\tif ( parsed.expires && parsed.expires <= now ) {\n\t\t\t\t\t\t\tremove.push( key );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tret[ key.replace( rprefix, \"\" ) ] = parsed.data;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twhile ( key = remove.pop() ) {\n\t\t\t\t\tstorage.removeItem( key );\n\t\t\t\t}\n\t\t\t} catch ( error ) {}\n\t\t\treturn ret;\n\t\t}\n\n\t\t// protect against name collisions with direct storage\n\t\tkey = \"__amplify__\" + key;\n\n\t\tif ( value === undefined ) {\n\t\t\tstoredValue = storage.getItem( key );\n\t\t\tparsed = storedValue ? JSON.parse( storedValue ) : { expires: -1 };\n\t\t\tif ( parsed.expires && parsed.expires <= now ) {\n\t\t\t\tstorage.removeItem( key );\n\t\t\t} else {\n\t\t\t\treturn parsed.data;\n\t\t\t}\n\t\t} else {\n\t\t\tif ( value === null ) {\n\t\t\t\tstorage.removeItem( key );\n\t\t\t} else {\n\t\t\t\tparsed = JSON.stringify({\n\t\t\t\t\tdata: value,\n\t\t\t\t\texpires: options.expires ? now + options.expires : null\n\t\t\t\t});\n\t\t\t\ttry {\n\t\t\t\t\tstorage.setItem( key, parsed );\n\t\t\t\t// quota exceeded\n\t\t\t\t} catch( error ) {\n\t\t\t\t\t// expire old data and try again\n\t\t\t\t\tstore[ storageType ]();\n\t\t\t\t\ttry {\n\t\t\t\t\t\tstorage.setItem( key, parsed );\n\t\t\t\t\t} catch( error ) {\n\t\t\t\t\t\tthrow store.error();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn ret;\n\t});\n}\n\n// localStorage + sessionStorage\n// IE 8+, Firefox 3.5+, Safari 4+, Chrome 4+, Opera 10.5+, iPhone 2+, Android 2+\nfor ( var webStorageType in { localStorage: 1, sessionStorage: 1 } ) {\n\t// try/catch for file protocol in Firefox\n\ttry {\n\t\tif ( window[ webStorageType ].getItem ) {\n\t\t\tcreateFromStorageInterface( webStorageType, window[ webStorageType ] );\n\t\t}\n\t} catch( e ) {}\n}\n\n// globalStorage\n// non-standard: Firefox 2+\n// https://developer.mozilla.org/en/dom/storage#globalStorage\nif ( window.globalStorage ) {\n\t// try/catch for file protocol in Firefox\n\ttry {\n\t\tcreateFromStorageInterface( \"globalStorage\",\n\t\t\twindow.globalStorage[ window.location.hostname ] );\n\t\t// Firefox 2.0 and 3.0 have sessionStorage and globalStorage\n\t\t// make sure we default to globalStorage\n\t\t// but don't default to globalStorage in 3.5+ which also has localStorage\n\t\tif ( store.type === \"sessionStorage\" ) {\n\t\t\tstore.type = \"globalStorage\";\n\t\t}\n\t} catch( e ) {}\n}\n\n// userData\n// non-standard: IE 5+\n// http://msdn.microsoft.com/en-us/library/ms531424(v=vs.85).aspx\n(function() {\n\t// IE 9 has quirks in userData that are a huge pain\n\t// rather than finding a way to detect these quirks\n\t// we just don't register userData if we have localStorage\n\tif ( store.types.localStorage ) {\n\t\treturn;\n\t}\n\n\t// append to html instead of body so we can do this from the head\n\tvar div = document.createElement( \"div\" ),\n\t\tattrKey = \"amplify\";\n\tdiv.style.display = \"none\";\n\tdocument.getElementsByTagName( \"head\" )[ 0 ].appendChild( div );\n\n\t// we can't feature detect userData support\n\t// so just try and see if it fails\n\t// surprisingly, even just adding the behavior isn't enough for a failure\n\t// so we need to load the data as well\n\ttry {\n\t\tdiv.addBehavior( \"#default#userdata\" );\n\t\tdiv.load( attrKey );\n\t} catch( e ) {\n\t\tdiv.parentNode.removeChild( div );\n\t\treturn;\n\t}\n\n\tstore.addType( \"userData\", function( key, value, options ) {\n\t\tdiv.load( attrKey );\n\t\tvar attr, parsed, prevValue, i, remove,\n\t\t\tret = value,\n\t\t\tnow = (new Date()).getTime();\n\n\t\tif ( !key ) {\n\t\t\tret = {};\n\t\t\tremove = [];\n\t\t\ti = 0;\n\t\t\twhile ( attr = div.XMLDocument.documentElement.attributes[ i++ ] ) {\n\t\t\t\tparsed = JSON.parse( attr.value );\n\t\t\t\tif ( parsed.expires && parsed.expires <= now ) {\n\t\t\t\t\tremove.push( attr.name );\n\t\t\t\t} else {\n\t\t\t\t\tret[ attr.name ] = parsed.data;\n\t\t\t\t}\n\t\t\t}\n\t\t\twhile ( key = remove.pop() ) {\n\t\t\t\tdiv.removeAttribute( key );\n\t\t\t}\n\t\t\tdiv.save( attrKey );\n\t\t\treturn ret;\n\t\t}\n\n\t\t// convert invalid characters to dashes\n\t\t// http://www.w3.org/TR/REC-xml/#NT-Name\n\t\t// simplified to assume the starting character is valid\n\t\t// also removed colon as it is invalid in HTML attribute names\n\t\tkey = key.replace( /[^-._0-9A-Za-z\\xb7\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\u037d\\u37f-\\u1fff\\u200c-\\u200d\\u203f\\u2040\\u2070-\\u218f]/g, \"-\" );\n\n\t\tif ( value === undefined ) {\n\t\t\tattr = div.getAttribute( key );\n\t\t\tparsed = attr ? JSON.parse( attr ) : { expires: -1 };\n\t\t\tif ( parsed.expires && parsed.expires <= now ) {\n\t\t\t\tdiv.removeAttribute( key );\n\t\t\t} else {\n\t\t\t\treturn parsed.data;\n\t\t\t}\n\t\t} else {\n\t\t\tif ( value === null ) {\n\t\t\t\tdiv.removeAttribute( key );\n\t\t\t} else {\n\t\t\t\t// we need to get the previous value in case we need to rollback\n\t\t\t\tprevValue = div.getAttribute( key );\n\t\t\t\tparsed = JSON.stringify({\n\t\t\t\t\tdata: value,\n\t\t\t\t\texpires: (options.expires ? (now + options.expires) : null)\n\t\t\t\t});\n\t\t\t\tdiv.setAttribute( key, parsed );\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tdiv.save( attrKey );\n\t\t// quota exceeded\n\t\t} catch ( error ) {\n\t\t\t// roll the value back to the previous value\n\t\t\tif ( prevValue === null ) {\n\t\t\t\tdiv.removeAttribute( key );\n\t\t\t} else {\n\t\t\t\tdiv.setAttribute( key, prevValue );\n\t\t\t}\n\n\t\t\t// expire old data and try again\n\t\t\tstore.userData();\n\t\t\ttry {\n\t\t\t\tdiv.setAttribute( key, parsed );\n\t\t\t\tdiv.save( attrKey );\n\t\t\t} catch ( error ) {\n\t\t\t\t// roll the value back to the previous value\n\t\t\t\tif ( prevValue === null ) {\n\t\t\t\t\tdiv.removeAttribute( key );\n\t\t\t\t} else {\n\t\t\t\t\tdiv.setAttribute( key, prevValue );\n\t\t\t\t}\n\t\t\t\tthrow store.error();\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t});\n}() );\n\n// in-memory storage\n// fallback for all browsers to enable the API even if we can't persist data\n(function() {\n\tvar memory = {},\n\t\ttimeout = {};\n\n\tfunction copy( obj ) {\n\t\treturn obj === undefined ? undefined : JSON.parse( JSON.stringify( obj ) );\n\t}\n\n\tstore.addType( \"memory\", function( key, value, options ) {\n\t\tif ( !key ) {\n\t\t\treturn copy( memory );\n\t\t}\n\n\t\tif ( value === undefined ) {\n\t\t\treturn copy( memory[ key ] );\n\t\t}\n\n\t\tif ( timeout[ key ] ) {\n\t\t\tclearTimeout( timeout[ key ] );\n\t\t\tdelete timeout[ key ];\n\t\t}\n\n\t\tif ( value === null ) {\n\t\t\tdelete memory[ key ];\n\t\t\treturn null;\n\t\t}\n\n\t\tmemory[ key ] = value;\n\t\tif ( options.expires ) {\n\t\t\ttimeout[ key ] = setTimeout(function() {\n\t\t\t\tdelete memory[ key ];\n\t\t\t\tdelete timeout[ key ];\n\t\t\t}, options.expires );\n\t\t}\n\n\t\treturn value;\n\t});\n}() );\n\n}( this.amplify = this.amplify || {} ) );\n/*!\n * Amplify Request 1.1.0\n * \n * Copyright 2011 appendTo LLC. (http://appendto.com/team)\n * Dual licensed under the MIT or GPL licenses.\n * http://appendto.com/open-source-licenses\n * \n * http://amplifyjs.com\n */\n(function( amplify, undefined ) {\n\nfunction noop() {}\nfunction isFunction( obj ) {\n\treturn ({}).toString.call( obj ) === \"[object Function]\";\n}\n\nfunction async( fn ) {\n\tvar isAsync = false;\n\tsetTimeout(function() {\n\t\tisAsync = true;\n\t}, 1 );\n\treturn function() {\n\t\tvar that = this,\n\t\t\targs = arguments;\n\t\tif ( isAsync ) {\n\t\t\tfn.apply( that, args );\n\t\t} else {\n\t\t\tsetTimeout(function() {\n\t\t\t\tfn.apply( that, args );\n\t\t\t}, 1 );\n\t\t}\n\t};\n}\n\namplify.request = function( resourceId, data, callback ) {\n\t// default to an empty hash just so we can handle a missing resourceId\n\t// in one place\n\tvar settings = resourceId || {};\n\n\tif ( typeof settings === \"string\" ) {\n\t\tif ( isFunction( data ) ) {\n\t\t\tcallback = data;\n\t\t\tdata = {};\n\t\t}\n\t\tsettings = {\n\t\t\tresourceId: resourceId,\n\t\t\tdata: data || {},\n\t\t\tsuccess: callback\n\t\t};\n\t}\n\n\tvar request = { abort: noop },\n\t\tresource = amplify.request.resources[ settings.resourceId ],\n\t\tsuccess = settings.success || noop,\n\t\terror = settings.error || noop;\n\tsettings.success = async( function( data, status ) {\n\t\tstatus = status || \"success\";\n\t\tamplify.publish( \"request.success\", settings, data, status );\n\t\tamplify.publish( \"request.complete\", settings, data, status );\n\t\tsuccess( data, status );\n\t});\n\tsettings.error = async( function( data, status ) {\n\t\tstatus = status || \"error\";\n\t\tamplify.publish( \"request.error\", settings, data, status );\n\t\tamplify.publish( \"request.complete\", settings, data, status );\n\t\terror( data, status );\n\t});\n\n\tif ( !resource ) {\n\t\tif ( !settings.resourceId ) {\n\t\t\tthrow \"amplify.request: no resourceId provided\";\n\t\t}\n\t\tthrow \"amplify.request: unknown resourceId: \" + settings.resourceId;\n\t}\n\n\tif ( !amplify.publish( \"request.before\", settings ) ) {\n\t\tsettings.error( null, \"abort\" );\n\t\treturn;\n\t}\n\n\tamplify.request.resources[ settings.resourceId ]( settings, request );\n\treturn request;\n};\n\namplify.request.types = {};\namplify.request.resources = {};\namplify.request.define = function( resourceId, type, settings ) {\n\tif ( typeof type === \"string\" ) {\n\t\tif ( !( type in amplify.request.types ) ) {\n\t\t\tthrow \"amplify.request.define: unknown type: \" + type;\n\t\t}\n\n\t\tsettings.resourceId = resourceId;\n\t\tamplify.request.resources[ resourceId ] =\n\t\t\tamplify.request.types[ type ]( settings );\n\t} else {\n\t\t// no pre-processor or settings for one-off types (don't invoke)\n\t\tamplify.request.resources[ resourceId ] = type;\n\t}\n};\n\n}( amplify ) );\n\n\n\n\n\n(function( amplify, $, undefined ) {\n\nvar xhrProps = [ \"status\", \"statusText\", \"responseText\", \"responseXML\", \"readyState\" ],\n    rurlData = /\\{([^\\}]+)\\}/g;\n\namplify.request.types.ajax = function( defnSettings ) {\n\tdefnSettings = $.extend({\n\t\ttype: \"GET\"\n\t}, defnSettings );\n\n\treturn function( settings, request ) {\n\t\tvar xhr,\n\t\t\turl = defnSettings.url,\n\t\t\tabort = request.abort,\n\t\t\tajaxSettings = $.extend( true, {}, defnSettings, { data: settings.data } ),\n\t\t\taborted = false,\n\t\t\tampXHR = {\n\t\t\t\treadyState: 0,\n\t\t\t\tsetRequestHeader: function( name, value ) {\n\t\t\t\t\treturn xhr.setRequestHeader( name, value );\n\t\t\t\t},\n\t\t\t\tgetAllResponseHeaders: function() {\n\t\t\t\t\treturn xhr.getAllResponseHeaders();\n\t\t\t\t},\n\t\t\t\tgetResponseHeader: function( key ) {\n\t\t\t\t\treturn xhr.getResponseHeader( key );\n\t\t\t\t},\n\t\t\t\toverrideMimeType: function( type ) {\n\t\t\t\t\treturn xhr.overrideMideType( type );\n\t\t\t\t},\n\t\t\t\tabort: function() {\n\t\t\t\t\taborted = true;\n\t\t\t\t\ttry {\n\t\t\t\t\t\txhr.abort();\n\t\t\t\t\t// IE 7 throws an error when trying to abort\n\t\t\t\t\t} catch( e ) {}\n\t\t\t\t\thandleResponse( null, \"abort\" );\n\t\t\t\t},\n\t\t\t\tsuccess: function( data, status ) {\n\t\t\t\t\tsettings.success( data, status );\n\t\t\t\t},\n\t\t\t\terror: function( data, status ) {\n\t\t\t\t\tsettings.error( data, status );\n\t\t\t\t}\n\t\t\t};\n\n\t\tamplify.publish( \"request.ajax.preprocess\",\n\t\t\tdefnSettings, settings, ajaxSettings, ampXHR );\n\n\t\t$.extend( ajaxSettings, {\n\t\t\tsuccess: function( data, status ) {\n\t\t\t\thandleResponse( data, status );\n\t\t\t},\n\t\t\terror: function( _xhr, status ) {\n\t\t\t\thandleResponse( null, status );\n\t\t\t},\n\t\t\tbeforeSend: function( _xhr, _ajaxSettings ) {\n\t\t\t\txhr = _xhr;\n\t\t\t\tajaxSettings = _ajaxSettings;\n\t\t\t\tvar ret = defnSettings.beforeSend ?\n\t\t\t\t\tdefnSettings.beforeSend.call( this, ampXHR, ajaxSettings ) : true;\n\t\t\t\treturn ret && amplify.publish( \"request.before.ajax\",\n\t\t\t\t\tdefnSettings, settings, ajaxSettings, ampXHR );\n\t\t\t}\n\t\t});\n\t\t$.ajax( ajaxSettings );\n\n\t\tfunction handleResponse( data, status ) {\n\t\t\t$.each( xhrProps, function( i, key ) {\n\t\t\t\ttry {\n\t\t\t\t\tampXHR[ key ] = xhr[ key ];\n\t\t\t\t} catch( e ) {}\n\t\t\t});\n\t\t\t// Playbook returns \"HTTP/1.1 200 OK\"\n\t\t\t// TODO: something also returns \"OK\", what?\n\t\t\tif ( /OK$/.test( ampXHR.statusText ) ) {\n\t\t\t\tampXHR.statusText = \"success\";\n\t\t\t}\n\t\t\tif ( data === undefined ) {\n\t\t\t\t// TODO: add support for ajax errors with data\n\t\t\t\tdata = null;\n\t\t\t}\n\t\t\tif ( aborted ) {\n\t\t\t\tstatus = \"abort\";\n\t\t\t}\n\t\t\tif ( /timeout|error|abort/.test( status ) ) {\n\t\t\t\tampXHR.error( data, status );\n\t\t\t} else {\n\t\t\t\tampXHR.success( data, status );\n\t\t\t}\n\t\t\t// avoid handling a response multiple times\n\t\t\t// this can happen if a request is aborted\n\t\t\t// TODO: figure out if this breaks polling or multi-part responses\n\t\t\thandleResponse = $.noop;\n\t\t}\n\n\t\trequest.abort = function() {\n\t\t\tampXHR.abort();\n\t\t\tabort.call( this );\n\t\t};\n\t};\n};\n\n\n\namplify.subscribe( \"request.ajax.preprocess\", function( defnSettings, settings, ajaxSettings ) {\n\tvar mappedKeys = [],\n\t\tdata = ajaxSettings.data;\n\n\tif ( typeof data === \"string\" ) {\n\t\treturn;\n\t}\n\n\tdata = $.extend( true, {}, defnSettings.data, data );\n\n\tajaxSettings.url = ajaxSettings.url.replace( rurlData, function ( m, key ) {\n\t\tif ( key in data ) {\n\t\t    mappedKeys.push( key );\n\t\t    return data[ key ];\n\t\t}\n\t});\n\n\t// We delete the keys later so duplicates are still replaced\n\t$.each( mappedKeys, function ( i, key ) {\n\t\tdelete data[ key ];\n\t});\n\n\tajaxSettings.data = data;\n});\n\n\n\namplify.subscribe( \"request.ajax.preprocess\", function( defnSettings, settings, ajaxSettings ) {\n\tvar data = ajaxSettings.data,\n\t\tdataMap = defnSettings.dataMap;\n\n\tif ( !dataMap || typeof data === \"string\" ) {\n\t\treturn;\n\t}\n\n\tif ( $.isFunction( dataMap ) ) {\n\t\tajaxSettings.data = dataMap( data );\n\t} else {\n\t\t$.each( defnSettings.dataMap, function( orig, replace ) {\n\t\t\tif ( orig in data ) {\n\t\t\t\tdata[ replace ] = data[ orig ];\n\t\t\t\tdelete data[ orig ];\n\t\t\t}\n\t\t});\n\t\tajaxSettings.data = data;\n\t}\n});\n\n\n\nvar cache = amplify.request.cache = {\n\t_key: function( resourceId, url, data ) {\n\t\tdata = url + data;\n\t\tvar length = data.length,\n\t\t\ti = 0,\n\t\t\tchecksum = chunk();\n\n\t\twhile ( i < length ) {\n\t\t\tchecksum ^= chunk();\n\t\t}\n\n\t\tfunction chunk() {\n\t\t\treturn data.charCodeAt( i++ ) << 24 |\n\t\t\t\tdata.charCodeAt( i++ ) << 16 |\n\t\t\t\tdata.charCodeAt( i++ ) << 8 |\n\t\t\t\tdata.charCodeAt( i++ ) << 0;\n\t\t}\n\n\t\treturn \"request-\" + resourceId + \"-\" + checksum;\n\t},\n\n\t_default: (function() {\n\t\tvar memoryStore = {};\n\t\treturn function( resource, settings, ajaxSettings, ampXHR ) {\n\t\t\t// data is already converted to a string by the time we get here\n\t\t\tvar cacheKey = cache._key( settings.resourceId,\n\t\t\t\t\tajaxSettings.url, ajaxSettings.data ),\n\t\t\t\tduration = resource.cache;\n\n\t\t\tif ( cacheKey in memoryStore ) {\n\t\t\t\tampXHR.success( memoryStore[ cacheKey ] );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar success = ampXHR.success;\n\t\t\tampXHR.success = function( data ) {\n\t\t\t\tmemoryStore[ cacheKey ] = data;\n\t\t\t\tif ( typeof duration === \"number\" ) {\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tdelete memoryStore[ cacheKey ];\n\t\t\t\t\t}, duration );\n\t\t\t\t}\n\t\t\t\tsuccess.apply( this, arguments );\n\t\t\t};\n\t\t};\n\t}())\n};\n\nif ( amplify.store ) {\n\t$.each( amplify.store.types, function( type ) {\n\t\tcache[ type ] = function( resource, settings, ajaxSettings, ampXHR ) {\n\t\t\tvar cacheKey = cache._key( settings.resourceId,\n\t\t\t\t\tajaxSettings.url, ajaxSettings.data ),\n\t\t\t\tcached = amplify.store[ type ]( cacheKey );\n\n\t\t\tif ( cached ) {\n\t\t\t\tajaxSettings.success( cached );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar success = ampXHR.success;\n\t\t\tampXHR.success = function( data ) {\t\n\t\t\t\tamplify.store[ type ]( cacheKey, data, { expires: resource.cache.expires } );\n\t\t\t\tsuccess.apply( this, arguments );\n\t\t\t};\n\t\t};\n\t});\n\tcache.persist = cache[ amplify.store.type ];\n}\n\namplify.subscribe( \"request.before.ajax\", function( resource ) {\n\tvar cacheType = resource.cache;\n\tif ( cacheType ) {\n\t\t// normalize between objects and strings/booleans/numbers\n\t\tcacheType = cacheType.type || cacheType;\n\t\treturn cache[ cacheType in cache ? cacheType : \"_default\" ]\n\t\t\t.apply( this, arguments );\n\t}\n});\n\n\n\namplify.request.decoders = {\n\t// http://labs.omniti.com/labs/jsend\n\tjsend: function( data, status, ampXHR, success, error ) {\n\t\tif ( data.status === \"success\" ) {\n\t\t\tsuccess( data.data );\n\t\t} else if ( data.status === \"fail\" ) {\n\t\t\terror( data.data, \"fail\" );\n\t\t} else if ( data.status === \"error\" ) {\n\t\t\tdelete data.status;\n\t\t\terror( data, \"error\" );\n\t\t}\n\t}\n};\n\namplify.subscribe( \"request.before.ajax\", function( resource, settings, ajaxSettings, ampXHR ) {\n\tvar _success = ampXHR.success,\n\t\t_error = ampXHR.error,\n\t\tdecoder = $.isFunction( resource.decoder )\n\t\t\t? resource.decoder\n\t\t\t: resource.decoder in amplify.request.decoders\n\t\t\t\t? amplify.request.decoders[ resource.decoder ]\n\t\t\t\t: amplify.request.decoders._default;\n\n\tif ( !decoder ) {\n\t\treturn;\n\t}\n\n\tfunction success( data, status ) {\n\t\t_success( data, status );\n\t}\n\tfunction error( data, status ) {\n\t\t_error( data, status );\n\t}\n\tampXHR.success = function( data, status ) {\n\t\tdecoder( data, status, ampXHR, success, error );\n\t};\n\tampXHR.error = function( data, status ) {\n\t\tdecoder( data, status, ampXHR, success, error );\n\t};\n});\n\n}( amplify, jQuery ) );\n"]}