{"version":3,"file":"/packages/templating:tests.js","sources":["templating/templating_tests.js","templating/templating_tests.html"],"names":[],"mappings":";;;;;;;;;AACA,uD;;AAEA,sE;AACA,mE;AACA,sD;AACA,6D;AACA,qB;;AAEA,mE;AACA,mD;AACA,uE;AACA,iD;AACA,gC;AACA,I;AACA,gD;AACA,+C;AACA,sC;AACA,2D;AACA,8B;AACA,e;AACA,0D;AACA,sC;AACA,e;AACA,G;;AAEA,oE;AACA,gE;;;;;;;AAOA,4D;AACA,0C;AACA,gD;AACA,gC;AACA,O;AACA,I;;AAEA,Y;;AAEA,uE;;AAEA,yE;AACA,8E;AACA,+D;AACA,mC;;AAEA,qC;AACA,uE;AACA,mC;;AAEA,gC;AACA,sB;AACA,sB;AACA,sB;AACA,gD;AACA,uB;AACA,4E;AACA,sC;AACA,0C;;AAEA,+D;AACA,gD;AACA,4B;AACA,oC;AACA,oC;AACA,oC;;;AAGA,sC;AACA,e;AACA,G;;AAEA,gE;;AAEA,mD;AACA,mD;AACA,uD;;AAEA,wC;AACA,wC;AACA,4B;AACA,2C;AACA,+B;AACA,K;AACA,K;;AAEA,qB;AACA,yB;AACA,+B;AACA,2C;AACA,2C;AACA,Q;;AAEA,qD;AACA,6B;;AAEA,wB;AACA,iC;AACA,uB;;AAEA,wB;AACA,iC;AACA,uB;;AAEA,wB;AACA,mC;AACA,uB;;AAEA,c;AACA,e;AACA,G;;AAEA,wD;;AAEA,+C;AACA,iB;AACA,I;AACA,+C;AACA,4C;AACA,I;;AAEA,4B;AACA,wD;;AAEA,kE;AACA,2C;AACA,2C;;AAEA,G;;AAEA,8D;AACA,oD;AACA,kB;AACA,K;AACA,sD;AACA,mB;AACA,K;;AAEA,uD;AACA,sB;AACA,K;;AAEA,sB;AACA,oD;AACA,a;AACA,K;;AAEA,mC;AACA,Y;AACA,iB;AACA,kC;AACA,gC;AACA,uB;AACA,Q;AACA,kC;AACA,gC;AACA,6B;AACA,wC;AACA,mC;AACA,kB;AACA,2C;AACA,yC;AACA,oC;AACA,iB;AACA,iB;AACA,O;AACA,M;AACA,I;;AAEA,2D;;AAEA,4C;AACA,gD;AACA,mB;AACA,I;;AAEA,gD;AACA,+D;AACA,mC;AACA,O;AACA,sD;AACA,I;;AAEA,iB;AACA,Y;AACA,sB;AACA,uB;AACA,mB;AACA,wC;AACA,iD;AACA,yC;AACA,0C;AACA,4B;AACA,4B;AACA,I;;AAEA,8D;AACA,sE;AACA,8D;AACA,gD;AACA,4C;AACA,iD;AACA,K;;AAEA,8D;AACA,uC;AACA,e;AACA,mC;AACA,Y;AACA,K;;AAEA,8D;AACA,kD;AACA,kB;AACA,oB;AACA,e;AACA,c;AACA,iB;AACA,iB;AACA,sB;AACA,uB;AACA,K;;AAEA,8D;AACA,wD;AACA,wB;AACA,iD;AACA,oB;AACA,sD;AACA,a;AACA,uB;AACA,uB;AACA,iC;AACA,K;;AAEA,8D;AACA,oB;AACA,kC;AACA,+B;AACA,wC;AACA,6C;AACA,qC;AACA,K;;AAEA,8D;AACA,0B;AACA,wC;AACA,qC;AACA,8C;AACA,mD;AACA,2C;AACA,K;;AAEA,4D;AACA,uB;AACA,8D;AACA,oB;AACA,yB;AACA,K;;AAEA,qC;;AAEA,oD;;AAEA,c;AACA,2D;AACA,uB;AACA,iD;AACA,uB;AACA,kI;AACA,uB;AACA,mP;AACA,uB;AACA,kI;AACA,uB;AACA,mP;AACA,+B;;AAEA,mD;;AAEA,oD;AACA,8B;AACA,I;AACA,kD;AACA,2B;AACA,wC;AACA,+C;AACA,O;AACA,e;AACA,I;AACA,iE;AACA,yC;AACA,wB;AACA,uC;AACA,I;AACA,mD;AACA,e;AACA,I;AACA,2D;AACA,qC;AACA,6C;AACA,I;AACA,oD;;AAEA,U;AACA,2D;AACA,mD;AACA,mD;AACA,0D;AACA,yD;AACA,mB;AACA,sC;AACA,sC;AACA,uB;AACA,qE;AACA,kD;AACA,oD;AACA,+B;AACA,G;;;AAGA,+D;AACA,6B;AACA,2C;AACA,Y;AACA,sB;AACA,I;;AAEA,0C;;AAEA,wB;AACA,+B;AACA,gD;AACA,Q;;AAEA,gD;;AAEA,qD;AACA,qD;AACA,mB;AACA,mB;;AAEA,e;AACA,e;AACA,qD;AACA,qD;AACA,mB;AACA,2B;AACA,mB;AACA,4B;;AAEA,a;AACA,e;;AAEA,O;;AAEA,yB;;AAEA,2C;AACA,Y;AACA,uB;AACA,I;AACA,0C;;AAEA,oB;AACA,+B;AACA,gD;AACA,Q;;AAEA,gD;;AAEA,qD;AACA,qD;AACA,mB;AACA,mB;;AAEA,e;AACA,e;AACA,qD;AACA,qD;AACA,mB;AACA,2B;AACA,mB;AACA,4B;;AAEA,a;AACA,e;;AAEA,O;;AAEA,oC;AACA,4B;;AAEA,0C;;AAEA,oB;AACA,sB;AACA,qC;AACA,oD;AACA,U;;AAEA,qD;AACA,qD;AACA,mB;AACA,mB;;AAEA,kD;AACA,e;AACA,qD;AACA,qD;AACA,mB;AACA,2B;AACA,mB;AACA,4B;;AAEA,a;AACA,e;;AAEA,O;;AAEA,oC;AACA,4B;;AAEA,0C;;AAEA,mD;AACA,+D;;AAEA,qD;AACA,qD;AACA,mB;AACA,mB;;AAEA,kD;AACA,e;AACA,qD;AACA,qD;AACA,mB;AACA,2B;AACA,mB;AACA,4B;;AAEA,a;AACA,e;;AAEA,G;;AAEA,2D;AACA,6B;AACA,iD;AACA,mB;AACA,I;;AAEA,iB;;AAEA,6C;AACA,mD;AACA,4D;AACA,oB;AACA,2B;AACA,iD;AACA,yD;AACA,sD;AACA,6C;AACA,wD;AACA,6D;AACA,8D;AACA,gE;AACA,qC;AACA,6C;AACA,0D;AACA,mC;AACA,I;;AAEA,iE;AACA,e;AACA,iE;AACA,8B;;AAEA,e;AACA,e;AACA,kD;AACA,gE;AACA,kC;AACA,kC;AACA,kC;AACA,iE;;AAEA,a;AACA,e;AACA,G;;AAEA,+D;AACA,gC;AACA,yB;AACA,yB;AACA,yB;;AAEA,2C;AACA,2C;AACA,uC;AACA,K;;AAEA,e;AACA,2C;AACA,4C;AACA,2B;AACA,oC;AACA,4C;AACA,6D;AACA,2B;AACA,M;AACA,6C;AACA,K;;AAEA,6B;AACA,qE;AACA,e;;AAEA,iE;AACA,gF;AACA,wC;;AAEA,iB;AACA,e;AACA,e;AACA,iE;AACA,gF;AACA,qC;;AAEA,a;AACA,e;;AAEA,G;;AAEA,6D;AACA,qE;AACA,8C;AACA,8D;AACA,4D;AACA,qD;;AAEA,qC;AACA,0B;AACA,e;AACA,sB;AACA,K;AACA,K;;AAEA,gE;;AAEA,gC;AACA,mD;AACA,I;AACA,8B;AACA,4C;AACA,I;;AAEA,e;AACA,oB;AACA,6C;AACA,6C;AACA,6C;AACA,6C;AACA,kC;AACA,6C;AACA,6C;AACA,6C;;AAEA,a;AACA,e;;AAEA,G;;AAEA,2D;AACA,uC;AACA,uC;AACA,6C;AACA,4C;AACA,oC;AACA,kD;AACA,wD;AACA,4B;AACA,K;AACA,K;;AAEA,qD;AACA,oB;AACA,iC;AACA,gC;AACA,wD;AACA,2D;AACA,I;;AAEA,uD;AACA,wB;AACA,+C;AACA,yC;AACA,kC;AACA,6C;AACA,uD;AACA,I;;AAEA,uD;AACA,oB;AACA,iC;AACA,gC;AACA,wD;AACA,2D;AACA,I;;AAEA,kD;AACA,uD;AACA,M;;AAEA,wC;AACA,e;AACA,kD;AACA,+C;AACA,iF;;AAEA,a;AACA,e;AACA,G;;AAEA,uD;AACA,6B;;AAEA,+C;AACA,wB;AACA,wB;AACA,8B;AACA,uC;AACA,6D;AACA,M;AACA,4B;AACA,gD;;AAEA,6C;AACA,e;AACA,uE;AACA,wB;AACA,kB;AACA,8D;AACA,8B;AACA,K;;AAEA,e;AACA,e;AACA,uE;AACA,wB;AACA,kB;AACA,8D;AACA,8B;AACA,K;;AAEA,qC;AACA,qC;AACA,qC;AACA,qC;AACA,qC;AACA,qC;AACA,sC;AACA,sC;;AAEA,a;AACA,e;AACA,G;;AAEA,sD;AACA,8C;;AAEA,iB;AACA,2B;AACA,sD;AACA,4D;;AAEA,6C;AACA,gD;AACA,a;AACA,e;;AAEA,0C;;AAEA,gB;AACA,gB;AACA,iB;AACA,oB;AACA,gB;AACA,c;AACA,K;;AAEA,yC;AACA,uC;AACA,qC;AACA,iE;AACA,gE;AACA,gE;AACA,+D;AACA,iE;AACA,+D;AACA,wB;AACA,qB;AACA,2B;AACA,a;AACA,e;;AAEA,mC;AACA,0C;AACA,yC;AACA,8B;AACA,a;AACA,e;AACA,G;;AAEA,qD;AACA,6C;;AAEA,e;;AAEA,c;AACA,iB;AACA,6C;AACA,I;;AAEA,6C;AACA,+C;AACA,yB;AACA,a;AACA,e;;AAEA,K;;AAEA,yC;AACA,W;AACA,c;AACA,e;AACA,6C;AACA,K;AACA,e;AACA,6C;AACA,K;;AAEA,6C;AACA,+C;AACA,+C;AACA,8B;AACA,a;AACA,e;;AAEA,+C;AACA,yC;AACA,W;AACA,e;AACA,6C;AACA,K;AACA,e;AACA,6C;AACA,K;;AAEA,yC;AACA,+C;AACA,4B;AACA,oC;AACA,oC;AACA,a;AACA,e;AACA,G;;AAEA,sE;AACA,wE;AACA,uB;;AAEA,sC;AACA,0B;AACA,0B;AACA,0B;;AAEA,e;;AAEA,iD;AACA,qC;AACA,gD;AACA,+B;AACA,8B;AACA,+E;AACA,I;AACA,6C;AACA,e;AACA,4D;AACA,iB;;AAEA,U;AACA,0B;AACA,sB;AACA,e;AACA,wE;AACA,iB;;AAEA,Y;AACA,0B;AACA,sB;AACA,e;AACA,4D;AACA,iB;;AAEA,kB;AACA,4C;AACA,sB;AACA,e;AACA,0D;AACA,4D;AACA,iB;;AAEA,a;AACA,e;;AAEA,sB;;AAEA,6C;AACA,gB;AACA,yB;AACA,qC;AACA,mD;AACA,2B;AACA,8B;AACA,8C;AACA,S;AACA,c;AACA,2B;AACA,4C;AACA,S;AACA,Q;AACA,O;AACA,M;AACA,+B;AACA,8B;AACA,+E;AACA,I;AACA,W;AACA,6C;AACA,sB;AACA,e;AACA,4D;AACA,iB;;AAEA,qC;AACA,qC;AACA,K;AACA,sB;AACA,e;AACA,2C;AACA,qD;AACA,4D;AACA,iB;;AAEA,a;AACA,e;AACA,G;;AAEA,mE;AACA,e;;AAEA,6B;;AAEA,gD;AACA,yB;AACA,qC;AACA,oE;AACA,qE;AACA,uE;AACA,yD;AACA,I;AACA,wB;AACA,mB;AACA,I;;AAEA,6C;AACA,oD;AACA,e;AACA,a;AACA,uC;AACA,iB;;AAEA,e;AACA,e;AACA,oD;AACA,mC;AACA,iB;;AAEA,a;AACA,e;AACA,mC;AACA,G;;AAEA,wE;AACA,e;;AAEA,6B;;AAEA,gD;AACA,0B;AACA,yB;AACA,qC;AACA,oE;AACA,qE;AACA,uE;AACA,yD;AACA,I;AACA,wB;AACA,mB;AACA,I;;AAEA,6C;AACA,e;AACA,a;AACA,qC;AACA,iB;;AAEA,e;AACA,e;AACA,a;AACA,wC;AACA,iB;;AAEA,a;AACA,e;AACA,kC;AACA,G;;AAEA,oE;AACA,e;;AAEA,6B;;AAEA,6C;AACA,gD;AACA,K;AACA,gC;AACA,0D;AACA,I;AACA,0D;AACA,0B;AACA,kD;AACA,mD;AACA,oD;AACA,K;;AAEA,iD;AACA,e;AACA,4C;AACA,a;AACA,qC;AACA,iB;;AAEA,e;AACA,e;AACA,4C;AACA,a;AACA,kC;AACA,iB;;AAEA,a;AACA,e;AACA,kC;AACA,G;;AAEA,+D;AACA,6B;;AAEA,mD;AACA,iC;AACA,6C;AACA,6C;AACA,6C;AACA,6C;AACA,6C;AACA,wC;AACA,Q;AACA,M;AACA,M;;AAEA,e;AACA,iE;AACA,6D;AACA,0C;AACA,e;;AAEA,a;AACA,e;AACA,G;;AAEA,qE;AACA,gB;;AAEA,4C;;AAEA,6B;;AAEA,uB;AACA,wB;AACA,mB;AACA,I;;AAEA,6C;AACA,e;;AAEA,e;AACA,gE;AACA,kE;AACA,e;AACA,e;;AAEA,a;AACA,e;AACA,G;;;AAGA,yE;;AAEA,yE;AACA,gE;AACA,qC;AACA,8C;AACA,gE;AACA,kC;AACA,iC;AACA,uD;AACA,W;AACA,a;AACA,K;;AAEA,uD;AACA,+D;AACA,a;AACA,W;AACA,4D;AACA,kB;AACA,gE;AACA,gB;AACA,gE;AACA,e;AACA,oD;AACA,wE;AACA,kB;AACA,G;;AAEA,mE;AACA,mC;;AAEA,kC;AACA,yB;;AAEA,a;;AAEA,gE;AACA,yB;AACA,I;;AAEA,0D;AACA,mB;AACA,I;;AAEA,oD;AACA,0C;AACA,2C;AACA,2C;AACA,K;;AAEA,+E;AACA,e;AACA,qB;AACA,e;AACA,e;;AAEA,W;AACA,e;AACA,+C;AACA,8E;;AAEA,a;AACA,e;AACA,G;;AAEA,oE;AACA,6B;AACA,uF;AACA,4D;AACA,wE;AACA,G;;AAEA,oE;AACA,yE;AACA,yE;AACA,4D;AACA,2E;AACA,G;;;;;;;;;;;;;;;;;;;AC5kCA,mH;AACA,mH;AACA,mH;AACA,+F;AACA,mH;AACA,0J;AACA,+F;AACA,0M;AACA,sI;AACA,sI;AACA,8F;AACA,2O;AACA,sI;AACA,sI;AACA,8F;AACA,+M;AACA,yS;AACA,4Y;AACA,2Q;AACA,wJ;AACA,oc;AACA,8W;AACA,sf;AACA,8jB;AACA,0K;AACA,4gD;AACA,ksB;AACA,oH;AACA,6I;AACA,kG;AACA,8R;AACA,yO;AACA,mH;AACA,mV;AACA,gI;AACA,iX;AACA,uJ;AACA,sM;AACA,0M;AACA,iI;AACA,iI;AACA,iI;AACA,kL;AACA,kL;AACA,uL;AACA,0L;AACA,qH;AACA,wG;AACA,wG;AACA,wG;AACA,4J;AACA,mH;AACA,sL;AACA,0L;AACA,kM;AACA,mO;AACA,wH;AACA,8I;AACA,wS","sourcesContent":["\nTinytest.add(\"templating - assembly\", function (test) {\n\n  // Test for a bug that made it to production -- after a replacement,\n  // we need to also check the newly replaced node for replacements\n  var frag = Meteor.render(Template.test_assembly_a0);\n  test.equal(canonicalizeHtml(DomUtils.fragmentToHtml(frag)),\n               \"Hi\");\n\n  // Another production bug -- we must use LiveRange to replace the\n  // placeholder, or risk breaking other LiveRanges\n  Session.set(\"stuff\", true); // XXX bad form to use Session in a test?\n  Template.test_assembly_b1.stuff = function () {\n    return Session.get(\"stuff\");\n  };\n  var onscreen = DIV({style: \"display: none\"}, [\n    Meteor.render(Template.test_assembly_b0)]);\n  document.body.appendChild(onscreen);\n  test.equal(canonicalizeHtml(onscreen.innerHTML), \"xyhi\");\n  Session.set(\"stuff\", false);\n  Deps.flush();\n  test.equal(canonicalizeHtml(onscreen.innerHTML), \"xhi\");\n  document.body.removeChild(onscreen);\n  Deps.flush();\n});\n\n// Test that if a template throws an error, then pending_partials is\n// cleaned up properly (that template rendering doesn't break..)\n\n\n\n\n\n\nTinytest.add(\"templating - table assembly\", function(test) {\n  var childWithTag = function(node, tag) {\n    return _.find(node.childNodes, function(n) {\n      return n.nodeName === tag;\n    });\n  };\n\n  var table;\n\n  table = childWithTag(Meteor.render(Template.test_table_a0), \"TABLE\");\n\n  // table.rows is a great test, as it fails not only when TR/TD tags are\n  // stripped due to improper html-to-fragment, but also when they are present\n  // but don't show up because we didn't create a TBODY for IE.\n  test.equal(table.rows.length, 3);\n\n  // this time with an explicit TBODY\n  table = childWithTag(Meteor.render(Template.test_table_b0), \"TABLE\");\n  test.equal(table.rows.length, 3);\n\n  var c = new LocalCollection();\n  c.insert({bar:'a'});\n  c.insert({bar:'b'});\n  c.insert({bar:'c'});\n  var onscreen = DIV({style: \"display: none;\"});\n  onscreen.appendChild(\n    Meteor.render(_.bind(Template.test_table_each, null, {foo: c.find()})));\n  document.body.appendChild(onscreen);\n  table = childWithTag(onscreen, \"TABLE\");\n\n  test.equal(table.rows.length, 3, table.parentNode.innerHTML);\n  var tds = onscreen.getElementsByTagName(\"TD\");\n  test.equal(tds.length, 3);\n  test.equal(tds[0].innerHTML, \"a\");\n  test.equal(tds[1].innerHTML, \"b\");\n  test.equal(tds[2].innerHTML, \"c\");\n\n\n  document.body.removeChild(onscreen);\n  Deps.flush();\n});\n\nTinytest.add(\"templating - event handler this\", function(test) {\n\n  Template.test_event_data_with.ONE = {str: \"one\"};\n  Template.test_event_data_with.TWO = {str: \"two\"};\n  Template.test_event_data_with.THREE = {str: \"three\"};\n\n  Template.test_event_data_with.events({\n    'click': function(event, template) {\n      test.isTrue(this.str);\n      test.equal(template.data.str, \"one\");\n      event_buf.push(this.str);\n    }\n  });\n\n  var event_buf = [];\n  var tmpl = OnscreenDiv(\n    Meteor.render(function () {\n      return Template.test_event_data_with(\n        Template.test_event_data_with.ONE);\n    }));\n\n  var divs = tmpl.node().getElementsByTagName(\"div\");\n  test.equal(3, divs.length);\n\n  clickElement(divs[0]);\n  test.equal(event_buf, ['one']);\n  event_buf.length = 0;\n\n  clickElement(divs[1]);\n  test.equal(event_buf, ['two']);\n  event_buf.length = 0;\n\n  clickElement(divs[2]);\n  test.equal(event_buf, ['three']);\n  event_buf.length = 0;\n\n  tmpl.kill();\n  Deps.flush();\n});\n\nTinytest.add(\"templating - safestring\", function(test) {\n\n  Template.test_safestring_a.foo = function() {\n    return \"1<2\";\n  };\n  Template.test_safestring_a.bar = function() {\n    return new Handlebars.SafeString(\"3<4\");\n  };\n\n  var obj = {fooprop: \"1<2\",\n             barprop: new Handlebars.SafeString(\"3<4\")};\n\n  test.equal(Template.test_safestring_a(obj).replace(/\\s+/g, ' '),\n             \"1&lt;2 1<2 3<4 3<4 1<2 3<4 \"+\n             \"1&lt;2 1<2 3<4 3<4 1<2 3<4\");\n\n});\n\nTinytest.add(\"templating - helpers and dots\", function(test) {\n  Handlebars.registerHelper(\"platypus\", function() {\n    return \"eggs\";\n  });\n  Handlebars.registerHelper(\"watermelon\", function() {\n    return \"seeds\";\n  });\n\n  Handlebars.registerHelper(\"daisygetter\", function() {\n    return this.daisy;\n  });\n\n  // XXX for debugging\n  Handlebars.registerHelper(\"debugger\", function() {\n    debugger;\n  });\n\n  var getFancyObject = function() {\n    return {\n      foo: 'bar',\n      apple: {banana: 'smoothie'},\n      currentFruit: function() {\n        return 'guava';\n      },\n      currentCountry: function() {\n        return {name: 'Iceland',\n                _pop: 321007,\n                population: function() {\n                  return this._pop;\n                },\n                unicorns: 0, // falsy value\n                daisyGetter: function() {\n                  return this.daisy;\n                }\n               };\n      }\n    };\n  };\n\n  Handlebars.registerHelper(\"fancyhelper\", getFancyObject);\n\n  Template.test_helpers_a.platypus = 'bill';\n  Template.test_helpers_a.warthog = function() {\n    return 'snout';\n  };\n\n  var listFour = function(a, b, c, d, options) {\n    var keywordArgs = _.map(_.keys(options.hash), function(k) {\n      return k+':'+options.hash[k];\n    });\n    return [a, b, c, d].concat(keywordArgs).join(' ');\n  };\n\n  var dataObj = {\n    zero: 0,\n    platypus: 'weird',\n    watermelon: 'rind',\n    daisy: 'petal',\n    tree: function() { return 'leaf'; },\n    thisTest: function() { return this.tree(); },\n    getNull: function() { return null; },\n    getUndefined: function () { return; },\n    fancy: getFancyObject(),\n    methodListFour: listFour\n  };\n\n  test.equal(Template.test_helpers_a(dataObj).match(/\\S+/g), [\n    'platypus=bill', // helpers on Template object take first priority\n    'watermelon=seeds', // global helpers take second priority\n    'daisy=petal', // unshadowed object property\n    'tree=leaf', // function object property\n    'warthog=snout' // function Template property\n  ]);\n\n  test.equal(Template.test_helpers_b(dataObj).match(/\\S+/g), [\n    // unknown properties silently fail\n    'unknown=',\n    // falsy property comes through\n    'zero=0'\n  ]);\n\n  test.equal(Template.test_helpers_c(dataObj).match(/\\S+/g), [\n    // property gets are supposed to silently fail\n    'platypus.X=',\n    'watermelon.X=',\n    'daisy.X=',\n    'tree.X=',\n    'warthog.X=',\n    'getNull.X=',\n    'getUndefined.X=',\n    'getUndefined.X.Y='\n  ]);\n\n  test.equal(Template.test_helpers_d(dataObj).match(/\\S+/g), [\n    // helpers should get current data context in `this`\n    'daisygetter=petal',\n    // object methods should get object in `this`\n    'thisTest=leaf',\n    // nesting inside {{#with fancy}} shouldn't affect\n    // method\n    '../thisTest=leaf',\n    // combine .. and .\n    '../fancy.currentFruit=guava'\n  ]);\n\n  test.equal(Template.test_helpers_e(dataObj).match(/\\S+/g), [\n    'fancy.foo=bar',\n    'fancy.apple.banana=smoothie',\n    'fancy.currentFruit=guava',\n    'fancy.currentCountry.name=Iceland',\n    'fancy.currentCountry.population=321007',\n    'fancy.currentCountry.unicorns=0'\n  ]);\n\n  test.equal(Template.test_helpers_f(dataObj).match(/\\S+/g), [\n    'fancyhelper.foo=bar',\n    'fancyhelper.apple.banana=smoothie',\n    'fancyhelper.currentFruit=guava',\n    'fancyhelper.currentCountry.name=Iceland',\n    'fancyhelper.currentCountry.population=321007',\n    'fancyhelper.currentCountry.unicorns=0'\n  ]);\n\n  // test significance of 'this', which prevents helper from\n  // shadowing property\n  test.equal(Template.test_helpers_g(dataObj).match(/\\S+/g), [\n    'platypus=eggs',\n    'this.platypus=weird'\n  ]);\n\n  // test interpretation of arguments\n\n  Template.test_helpers_h.helperListFour = listFour;\n\n  var trials =\n        Template.test_helpers_h(dataObj).match(/\\(.*?\\)/g);\n  test.equal(trials[0],\n             '(methodListFour 6 7 8 9=6 7 8 9)');\n  test.equal(trials[1],\n             '(methodListFour platypus thisTest fancyhelper.currentFruit fancyhelper.currentCountry.unicorns=eggs leaf guava 0)');\n  test.equal(trials[2],\n             '(methodListFour platypus thisTest fancyhelper.currentFruit fancyhelper.currentCountry.unicorns a=platypus b=thisTest c=fancyhelper.currentFruit d=fancyhelper.currentCountry.unicorns=eggs leaf guava 0 a:eggs b:leaf c:guava d:0)');\n  test.equal(trials[3],\n             '(helperListFour platypus thisTest fancyhelper.currentFruit fancyhelper.currentCountry.unicorns=eggs leaf guava 0)');\n  test.equal(trials[4],\n             '(helperListFour platypus thisTest fancyhelper.currentFruit fancyhelper.currentCountry.unicorns a=platypus b=thisTest c=fancyhelper.currentFruit d=fancyhelper.currentCountry.unicorns=eggs leaf guava 0 a:eggs b:leaf c:guava d:0)');\n  test.equal(trials.length, 5);\n\n  // test interpretation of block helper invocation\n\n  Template.test_helpers_i.uppercase = function(fn) {\n    return fn().toUpperCase();\n  };\n  Template.test_helpers_i.tr = function(options) {\n    var str = options.fn();\n    _.each(options.hash, function(v,k) {\n      str = str.replace(new RegExp(k, 'g'), v);\n    });\n    return str;\n  };\n  Template.test_helpers_i.arg_and_dict = function(arg, options) {\n    if (typeof options.hash !== \"object\")\n      throw new Error();\n    return _.keys(options.hash).length;\n  };\n  Template.test_helpers_i.get_arg = function(arg) {\n    return arg;\n  };\n  Template.test_helpers_i.two_args = function(arg1, arg2) {\n    return [typeof arg1 === \"string\",\n            typeof arg2 === \"string\"].join();\n  };\n  Template.test_helpers_i.helperListFour = listFour;\n\n  trials =\n        Template.test_helpers_i(dataObj).match(/\\(.*?\\)/g);\n  test.equal(trials[0], \"(uppercase apple=APPLE)\");\n  test.equal(trials[1], \"(altered banana=bododo)\");\n  // presence of arg should prevent keyword arguments from\n  // being passed to block helper, whether or not the arg\n  // is a function.\n  test.equal(trials[2], \"(nokeys=0)\");\n  test.equal(trials[3], \"(nokeys=0)\");\n  test.equal(trials[4],\n             '(biggie=eggs leaf guava 0 a:eggs b:leaf c:guava d:0)');\n  // can't pass > 1 positional arg to block helper\n  test.equal(trials[5], \"(twoArgBlock=true,false)\");\n  test.equal(trials.length, 6);\n});\n\n\nTinytest.add(\"templating - rendered template\", function(test) {\n  var R = ReactiveVar('foo');\n  Template.test_render_a.foo = function() {\n    R.get();\n    return this.x + 1;\n  };\n\n  Template.test_render_a.preserve(['br']);\n\n  var div = OnscreenDiv(\n    Meteor.render(function () {\n      return Template.test_render_a({ x: 123 });\n    }));\n\n  test.equal(div.text().match(/\\S+/)[0], \"124\");\n\n  var br1 = div.node().getElementsByTagName('br')[0];\n  var hr1 = div.node().getElementsByTagName('hr')[0];\n  test.isTrue(br1);\n  test.isTrue(hr1);\n\n  R.set('bar');\n  Deps.flush();\n  var br2 = div.node().getElementsByTagName('br')[0];\n  var hr2 = div.node().getElementsByTagName('hr')[0];\n  test.isTrue(br2);\n  test.isTrue(br1 === br2);\n  test.isTrue(hr2);\n  test.isFalse(hr1 === hr2);\n\n  div.kill();\n  Deps.flush();\n\n  /////\n\n  R = ReactiveVar('foo');\n\n  Template.test_render_b.foo = function() {\n    R.get();\n    return (+this) + 1;\n  };\n  Template.test_render_b.preserve(['br']);\n\n  div = OnscreenDiv(\n    Meteor.render(function () {\n      return Template.test_render_b({ x: 123 });\n    }));\n\n  test.equal(div.text().match(/\\S+/)[0], \"201\");\n\n  var br1 = div.node().getElementsByTagName('br')[0];\n  var hr1 = div.node().getElementsByTagName('hr')[0];\n  test.isTrue(br1);\n  test.isTrue(hr1);\n\n  R.set('bar');\n  Deps.flush();\n  var br2 = div.node().getElementsByTagName('br')[0];\n  var hr2 = div.node().getElementsByTagName('hr')[0];\n  test.isTrue(br2);\n  test.isTrue(br1 === br2);\n  test.isTrue(hr2);\n  test.isFalse(hr1 === hr2);\n\n  div.kill();\n  Deps.flush();\n\n  /////\n\n  var stuff = new LocalCollection();\n  stuff.insert({foo:'bar'});\n\n  Template.test_render_c.preserve(['br']);\n\n  div = OnscreenDiv(\n    Meteor.renderList(\n      stuff.find(), function (data) {\n        return Template.test_render_c(data, 'blah');\n      }));\n\n  var br1 = div.node().getElementsByTagName('br')[0];\n  var hr1 = div.node().getElementsByTagName('hr')[0];\n  test.isTrue(br1);\n  test.isTrue(hr1);\n\n  stuff.update({foo:'bar'}, {$set: {foo: 'baz'}});\n  Deps.flush();\n  var br2 = div.node().getElementsByTagName('br')[0];\n  var hr2 = div.node().getElementsByTagName('hr')[0];\n  test.isTrue(br2);\n  test.isTrue(br1 === br2);\n  test.isTrue(hr2);\n  test.isFalse(hr1 === hr2);\n\n  div.kill();\n  Deps.flush();\n\n  /////\n\n  var stuff = new LocalCollection();\n  stuff.insert({foo:'bar'});\n\n  Template.test_render_c.preserve(['br']);\n\n  div = OnscreenDiv(Meteor.renderList(stuff.find(),\n                                      Template.test_render_c));\n\n  var br1 = div.node().getElementsByTagName('br')[0];\n  var hr1 = div.node().getElementsByTagName('hr')[0];\n  test.isTrue(br1);\n  test.isTrue(hr1);\n\n  stuff.update({foo:'bar'}, {$set: {foo: 'baz'}});\n  Deps.flush();\n  var br2 = div.node().getElementsByTagName('br')[0];\n  var hr2 = div.node().getElementsByTagName('hr')[0];\n  test.isTrue(br2);\n  test.isTrue(br1 === br2);\n  test.isTrue(hr2);\n  test.isFalse(hr1 === hr2);\n\n  div.kill();\n  Deps.flush();\n\n});\n\nTinytest.add(\"templating - branch labels\", function(test) {\n  var R = ReactiveVar('foo');\n  Template.test_branches_a['var'] = function () {\n    return R.get();\n  };\n\n  var elems = [];\n\n  // use constant landmarks to test that each\n  // block helper invocation gets a different label\n  Template.test_branches_a.myConstant = function (options) {\n    var data = this;\n    var firstRender = true;\n    return Spark.createLandmark({ constant: true,\n                                  rendered: function () {\n                                    if (! firstRender)\n                                      return;\n                                    firstRender = false;\n                                    var hr = this.find('hr');\n                                    hr.myIndex = elems.length;\n                                    elems.push(this.find('hr'));\n                                  }},\n                                function () {\n                                  return options.fn(data);\n                                });\n  };\n\n  var div = OnscreenDiv(Meteor.render(Template.test_branches_a));\n  Deps.flush();\n  test.equal(DomUtils.find(div.node(), 'span').innerHTML, 'foo');\n  test.equal(elems.length, 3);\n\n  R.set('bar');\n  Deps.flush();\n  var elems2 = DomUtils.findAll(div.node(), 'hr');\n  elems2.sort(function(a, b) { return a.myIndex - b.myIndex; });\n  test.equal(elems[0], elems2[0]);\n  test.equal(elems[1], elems2[1]);\n  test.equal(elems[2], elems2[2]);\n  test.equal(DomUtils.find(div.node(), 'span').innerHTML, 'bar');\n\n  div.kill();\n  Deps.flush();\n});\n\nTinytest.add(\"templating - matching in list\", function (test) {\n  var c = new LocalCollection();\n  c.insert({letter:'a'});\n  c.insert({letter:'b'});\n  c.insert({letter:'c'});\n\n  _.extend(Template.test_listmatching_a0, {\n    'var': function () { return R.get(); },\n    c: function () { return c.find(); }\n  });\n\n  var buf = [];\n  _.extend(Template.test_listmatching_a1, {\n    created: function () { buf.push('+'); },\n    rendered: function () {\n      var letter = canonicalizeHtml(\n        DomUtils.rangeToHtml(this.firstNode,\n                             this.lastNode).match(/\\S+/)[0]);\n      buf.push('*'+letter);\n    },\n    destroyed: function () { buf.push('-'); }\n  });\n\n  var R = ReactiveVar('foo');\n  var div = OnscreenDiv(Spark.render(Template.test_listmatching_a0));\n  Deps.flush();\n\n  test.equal(DomUtils.find(div.node(), 'span').innerHTML, 'foo');\n  test.equal(div.html().match(/<p>(.*?)<\\/p>/)[1].match(/\\S+/g), ['a','b','c']);\n  test.equal(buf.join(''), '+++*a*b*c');\n\n  buf.length = 0;\n  R.set('bar');\n  Deps.flush();\n  test.equal(DomUtils.find(div.node(), 'span').innerHTML, 'bar');\n  test.equal(div.html().match(/<p>(.*?)<\\/p>/)[1].match(/\\S+/g), ['a','b','c']);\n  test.equal(buf.join(''), '*a*b*c');\n\n  div.kill();\n  Deps.flush();\n\n});\n\nTinytest.add(\"templating - isolate helper\", function (test) {\n  var Rs = _.map(_.range(4), function () { return ReactiveVar(1); });\n  var touch = function (n) { Rs[n-1].get(); };\n  var bump = function (n) { Rs[n-1].set(Rs[n-1].get() + 1); };\n  var counts = _.map(_.range(4), function () { return 0; });\n  var tally = function (n) { return ++counts[n-1]; };\n\n  _.extend(Template.test_isolate_a, {\n    helper: function (n) {\n      touch(n);\n      return tally(n);\n    }\n  });\n\n  var div = OnscreenDiv(Meteor.render(Template.test_isolate_a));\n\n  var getTallies = function () {\n    return _.map(div.html().match(/\\S+/g), Number);\n  };\n  var expect = function(str) {\n    test.equal(getTallies().join(','), str);\n  };\n\n  Deps.flush();\n  expect(\"1,1,1,1\");\n  bump(1);  Deps.flush();  expect(\"2,2,2,2\");\n  bump(2);  Deps.flush();  expect(\"2,3,3,3\");\n  bump(3);  Deps.flush();  expect(\"2,3,4,4\");\n  bump(4);  Deps.flush();  expect(\"2,3,4,5\");\n  Deps.flush(); expect(\"2,3,4,5\");\n  bump(3);  Deps.flush();  expect(\"2,3,5,6\");\n  bump(2);  Deps.flush();  expect(\"2,4,6,7\");\n  bump(1);  Deps.flush();  expect(\"3,5,7,8\");\n\n  div.kill();\n  Deps.flush();\n\n});\n\nTinytest.add(\"templating - template arg\", function (test) {\n  Template.test_template_arg_a.events({\n    click: function (event, template) {\n      template.firstNode.innerHTML = 'Hello';\n      template.lastNode.innerHTML = 'World';\n      template.find('i').innerHTML =\n        (template.findAll('*').length)+\"-element\";\n      template.lastNode.innerHTML += ' (the secret is '+\n        template.secret+')';\n    }\n  });\n\n  Template.test_template_arg_a.created = function() {\n    var self = this;\n    test.isFalse(self.firstNode);\n    test.isFalse(self.lastNode);\n    test.throws(function () { return self.find(\"*\"); });\n    test.throws(function () { return self.findAll(\"*\"); });\n  };\n\n  Template.test_template_arg_a.rendered = function () {\n    var template = this;\n    template.firstNode.innerHTML = 'Greetings';\n    template.lastNode.innerHTML = 'Line';\n    template.find('i').innerHTML =\n      (template.findAll('b').length)+\"-bold\";\n    template.secret = \"strawberry \"+template.data.food;\n  };\n\n  Template.test_template_arg_a.destroyed = function() {\n    var self = this;\n    test.isFalse(self.firstNode);\n    test.isFalse(self.lastNode);\n    test.throws(function () { return self.find(\"*\"); });\n    test.throws(function () { return self.findAll(\"*\"); });\n  };\n\n  var div = OnscreenDiv(Spark.render(function () {\n    return Template.test_template_arg_a({food: \"pie\"});\n  }));\n\n  test.equal(div.text(), \"Foo Bar Baz\");\n  Deps.flush();\n  test.equal(div.text(), \"Greetings 1-bold Line\");\n  clickElement(DomUtils.find(div.node(), 'i'));\n  test.equal(div.text(), \"Hello 3-element World (the secret is strawberry pie)\");\n\n  div.kill();\n  Deps.flush();\n});\n\nTinytest.add(\"templating - preserve\", function (test) {\n  var R = ReactiveVar('foo');\n\n  var tmpl = Template.test_template_preserve_a;\n  tmpl.preserve(['.b']);\n  tmpl.preserve(['.c']);\n  tmpl.preserve({'.d': true});\n  tmpl.preserve({'span': function (n) {\n    return _.contains(['e','f'], n.className) && n.className;\n  }});\n  tmpl.preserve(['span.a']);\n  tmpl['var'] = function () { return R.get(); };\n\n  var div = OnscreenDiv(Meteor.render(tmpl));\n  Deps.flush();\n  test.equal(DomUtils.find(div.node(), 'u').firstChild.nodeValue.match(\n      /\\S+/)[0], 'foo');\n  var spans1 = {};\n  _.each(DomUtils.findAll(div.node(), 'span'), function (sp) {\n    spans1[sp.className] = sp;\n  });\n\n  R.set('bar');\n  Deps.flush();\n  test.equal(DomUtils.find(div.node(), 'u').firstChild.nodeValue.match(\n      /\\S+/)[0], 'bar');\n  var spans2 = {};\n  _.each(DomUtils.findAll(div.node(), 'span'), function (sp) {\n    spans2[sp.className] = sp;\n  });\n\n  test.isTrue(spans1.a === spans2.a);\n  test.isTrue(spans1.b === spans2.b);\n  test.isTrue(spans1.c === spans2.c);\n  test.isTrue(spans1.d === spans2.d);\n  test.isTrue(spans1.e === spans2.e);\n  test.isTrue(spans1.f === spans2.f);\n  test.isFalse(spans1.y === spans2.y);\n  test.isFalse(spans1.z === spans2.z);\n\n  div.kill();\n  Deps.flush();\n});\n\nTinytest.add(\"templating - helpers\", function (test) {\n  var tmpl = Template.test_template_helpers_a;\n\n  tmpl.foo = 'z';\n  tmpl.helpers({bar: 'b'});\n  // helpers(...) takes precendence of assigned helper\n  tmpl.helpers({foo: 'a', baz: function() { return 'c'; }});\n\n  var div = OnscreenDiv(Meteor.render(tmpl));\n  test.equal(div.text().match(/\\S+/)[0], 'abc');\n  div.kill();\n  Deps.flush();\n\n  tmpl = Template.test_template_helpers_b;\n\n  tmpl.helpers({\n    'name': 'A',\n    'arity': 'B',\n    'toString': 'C',\n    'length': 4,\n    'var': 'D'\n  });\n\n  div = OnscreenDiv(Meteor.render(tmpl));\n  var txt = div.text().match(/\\S+/)[0];\n  test.isTrue(txt.match(/^ABC?4D$/));\n  // We don't get 'C' (the ability to name a helper {{toString}})\n  // in IE < 9 because of the famed DontEnum bug.  This could be\n  // fixed but it would require making all the code that handles\n  // the dictionary of helpers be DontEnum-aware.  In practice,\n  // the Object prototype method names (toString, hasOwnProperty,\n  // isPropertyOf, ...) make poor helper names and are unlikely\n  // to be used in apps.\n  test.expect_fail();\n  test.equal(txt, 'ABC4D');\n  div.kill();\n  Deps.flush();\n\n  // test that helpers don't \"leak\"\n  tmpl = Template.test_template_helpers_c;\n  div = OnscreenDiv(Meteor.render(tmpl));\n  test.equal(div.text(), 'x');\n  div.kill();\n  Deps.flush();\n});\n\nTinytest.add(\"templating - events\", function (test) {\n  var tmpl = Template.test_template_events_a;\n\n  var buf = [];\n\n  // old style\n  tmpl.events = {\n    'click b': function () { buf.push('b'); }\n  };\n\n  var div = OnscreenDiv(Meteor.render(tmpl));\n  clickElement(DomUtils.find(div.node(), 'b'));\n  test.equal(buf, ['b']);\n  div.kill();\n  Deps.flush();\n\n  ///\n\n  tmpl = Template.test_template_events_b;\n  buf = [];\n  // new style\n  tmpl.events({\n    'click u': function () { buf.push('u'); }\n  });\n  tmpl.events({\n    'click i': function () { buf.push('i'); }\n  });\n\n  var div = OnscreenDiv(Meteor.render(tmpl));\n  clickElement(DomUtils.find(div.node(), 'u'));\n  clickElement(DomUtils.find(div.node(), 'i'));\n  test.equal(buf, ['u', 'i']);\n  div.kill();\n  Deps.flush();\n\n  //Test for identical callbacks for issue #650\n  tmpl = Template.test_template_events_c;\n  buf = [];\n  tmpl.events({\n    'click u': function () { buf.push('a'); }\n  });\n  tmpl.events({\n    'click u': function () { buf.push('b'); }\n  });\n\n  div = OnscreenDiv(Meteor.render(tmpl));\n  clickElement(DomUtils.find(div.node(), 'u'));\n  test.equal(buf.length, 2);\n  test.isTrue(_.contains(buf, 'a'));\n  test.isTrue(_.contains(buf, 'b'));\n  div.kill();\n  Deps.flush();\n});\n\nTinytest.add(\"templating - #each rendered callback\", function (test) {\n  // test that any list modification triggers a rendered callback on the\n  // enclosing template\n\n  var entries = new LocalCollection();\n  entries.insert({x:'a'});\n  entries.insert({x:'b'});\n  entries.insert({x:'c'});\n\n  var buf = [];\n\n  var tmpl = Template.test_template_eachrender_a;\n  tmpl.helpers({entries: function() {\n    return entries.find({}, {sort: ['x']}); }});\n  tmpl.rendered = function () {\n    buf.push(canonicalizeHtml(\n      DomUtils.rangeToHtml(this.firstNode, this.lastNode)).replace(/\\s/g, ''));\n  };\n  var div = OnscreenDiv(Meteor.render(tmpl));\n  Deps.flush();\n  test.equal(buf, ['<div>a</div><div>b</div><div>c</div>']);\n  buf.length = 0;\n\n  // added\n  entries.insert({x:'d'});\n  test.equal(buf, []);\n  Deps.flush();\n  test.equal(buf, ['<div>a</div><div>b</div><div>c</div><div>d</div>']);\n  buf.length = 0;\n\n  // removed\n  entries.remove({x:'a'});\n  test.equal(buf, []);\n  Deps.flush();\n  test.equal(buf, ['<div>b</div><div>c</div><div>d</div>']);\n  buf.length = 0;\n\n  // moved/changed\n  entries.update({x:'b'}, {$set: {x: 'z'}});\n  test.equal(buf, []);\n  Deps.flush();\n  test.equal(buf, ['<div>c</div><div>d</div><div>z</div>',\n                   '<div>c</div><div>d</div><div>z</div>']);\n  buf.length = 0;\n\n  div.kill();\n  Deps.flush();\n\n  // test pure \"moved\"\n\n  tmpl = Template.test_template_eachrender_b;\n  var cbks = [];\n  var xs = ['a','b','c'];\n  tmpl.helpers({entries: function() {\n    return { observeChanges: function (callbacks) {\n      cbks.push(callbacks);\n      _.each(xs, function(x) {\n        callbacks.addedBefore(x, {x:x}, null);\n      });\n      return {\n        stop: function () {\n          cbks = _.without(cbks, callbacks);\n        }\n      };\n    }};\n  }});\n  tmpl.rendered = function () {\n    buf.push(canonicalizeHtml(\n      DomUtils.rangeToHtml(this.firstNode, this.lastNode)).replace(/\\s/g, ''));\n  };\n  buf = [];\n  var div = OnscreenDiv(Meteor.render(tmpl));\n  test.equal(buf, []);\n  Deps.flush();\n  test.equal(buf, ['<div>a</div><div>b</div><div>c</div>']);\n  buf.length = 0;\n\n  _.each(cbks, function (callbacks) {\n    callbacks.movedBefore('a', null);\n  });\n  test.equal(buf, []);\n  Deps.flush();\n  test.equal(div.html().replace(/\\s/g, ''),\n             '<div>b</div><div>c</div><div>a</div>');\n  test.equal(buf, ['<div>b</div><div>c</div><div>a</div>']);\n  buf.length = 0;\n\n  div.kill();\n  Deps.flush();\n});\n\nTinytest.add(\"templating - landmarks in helpers\", function (test) {\n  var buf = [];\n\n  var R = ReactiveVar('foo');\n\n  var tmpl = Template.test_template_landmarks_a;\n  tmpl.LM = function () {\n    return new Handlebars.SafeString(\n      Spark.createLandmark({created: function () { buf.push('c'); },\n                            rendered: function () { buf.push('r'); },\n                            destroyed: function () { buf.push('d'); }},\n                           function () { return 'x'; }));\n  };\n  tmpl.v = function () {\n    return R.get();\n  };\n\n  var div = OnscreenDiv(Meteor.render(tmpl));\n  test.equal(div.text().match(/\\S+/)[0], 'xxxxfoo');\n  Deps.flush();\n  buf.sort();\n  test.equal(buf.join(''), 'ccccrrrr');\n  buf.length = 0;\n\n  R.set('bar');\n  Deps.flush();\n  test.equal(div.text().match(/\\S+/)[0], 'xxxxbar');\n  test.equal(buf.join(''), 'rrrr');\n  buf.length = 0;\n\n  div.kill();\n  Deps.flush();\n  test.equal(buf.join(''), 'dddd');\n});\n\nTinytest.add(\"templating - bare each has no matching\", function (test) {\n  var buf = [];\n\n  var R = ReactiveVar('foo');\n\n  var tmpl = Template.test_template_bare_each_a;\n  tmpl.abc = [{}, {}, {}];\n  tmpl.LM = function () {\n    return new Handlebars.SafeString(\n      Spark.createLandmark({created: function () { buf.push('c'); },\n                            rendered: function () { buf.push('r'); },\n                            destroyed: function () { buf.push('d'); }},\n                           function () { return 'x'; }));\n  };\n  tmpl.v = function () {\n    return R.get();\n  };\n\n  var div = OnscreenDiv(Meteor.render(tmpl));\n  Deps.flush();\n  buf.sort();\n  test.equal(buf.join(''), 'cccrrr');\n  buf.length = 0;\n\n  R.set('bar');\n  Deps.flush();\n  buf.sort();\n  test.equal(buf.join(''), 'cccdddrrr');\n  buf.length = 0;\n\n  div.kill();\n  Deps.flush();\n  test.equal(buf.join(''), 'ddd');\n});\n\nTinytest.add(\"templating - templates are labeled\", function (test) {\n  var buf = [];\n\n  var R = ReactiveVar('foo');\n\n  var tmpls = _.map([0,1,2,3], function (n) {\n    return Template['test_template_labels_a'+n];\n  });\n  tmpls[0].stuff = function () {\n    return tmpls[1]() + tmpls[2]() + tmpls[3]() + R.get();\n  };\n  _.each([tmpls[1], tmpls[2], tmpls[3]], function (tmpl) {\n    tmpl.preserve(['hr']);\n    tmpl.created = function () { buf.push('c'); };\n    tmpl.rendered = function () { buf.push('r'); };\n    tmpl.destroyed = function () { buf.push('d'); };\n  });\n\n  var div = OnscreenDiv(Meteor.render(tmpls[0]));\n  Deps.flush();\n  test.equal(div.html(), \"<hr><hr><hr>foo\");\n  buf.sort();\n  test.equal(buf.join(''), 'cccrrr');\n  buf.length = 0;\n\n  R.set('bar');\n  Deps.flush();\n  test.equal(div.html(), \"<hr><hr><hr>bar\");\n  buf.sort();\n  test.equal(buf.join(''), 'rrr');\n  buf.length = 0;\n\n  div.kill();\n  Deps.flush();\n  test.equal(buf.join(''), 'ddd');\n});\n\nTinytest.add(\"templating - unlabeled cursor\", function (test) {\n  var R = ReactiveVar(\"foo\");\n\n  var div = OnscreenDiv(Meteor.render(function () {\n    R.get(); // create dependency\n    return Template.test_unlabeled_cursor_a0(\n      {observeChanges: function (callbacks) {\n        callbacks.addedBefore('0', {}, null);\n        callbacks.addedBefore('1', {}, null);\n        callbacks.addedBefore('2', {}, null);\n        return { stop: function () {} };\n      }}\n    );\n  }));\n\n  R.set(\"bar\");\n  // This will fail with \"can't create second landmark in branch\"\n  // unless _id-less objects returned from a cursor are given\n  // unique branch labels in an {{#each}}.\n  Deps.flush();\n\n  div.kill();\n  Deps.flush();\n});\n\nTinytest.add(\"templating - constant text patching\", function (test) {\n  // Issue #323.\n\n  var tmpl = Template.test_constant_text_a0;\n\n  var R = ReactiveVar(\"foo\");\n\n  tmpl.preserve(['p']);\n  tmpl.v = function () {\n    return R.get();\n  };\n\n  var div = OnscreenDiv(Meteor.render(tmpl));\n  Deps.flush();\n\n  R.set(\"bar\");\n  // This flush will fail if we can't patch the constant region,\n  // which starts with a text node, after preserving the preceding\n  // paragraph.\n  Deps.flush();\n\n  div.kill();\n  Deps.flush();\n});\n\n\nTinytest.add('templating - helper typecast Issue #617', function (test) {\n\n  Handlebars.registerHelper('testTypeCasting', function (/*arguments*/) {\n    // Return a string representing the arguments passed to this\n    // function, including types. eg:\n    // (1, true) -> \"[number,1][boolean,true]\"\n    return _.reduce(_.toArray(arguments), function (memo, arg) {\n      if (typeof arg === 'object')\n        return memo + \"[object]\";\n      return memo + \"[\" + typeof arg + \",\" + arg + \"]\";\n    }, \"\");\n    return x;\n  });\n\n  var frag = Meteor.render(Template.test_type_casting);\n  var result = canonicalizeHtml(DomUtils.fragmentToHtml(frag));\n  test.equal(\n    result,\n    // This corresponds to entries in templating_tests.html.\n    // true/faslse\n    \"[string,true][string,false][boolean,true][boolean,false]\" +\n      // numbers\n      \"[number,0][number,1][number,-1][number,10][number,-10]\" +\n      // errors\n      \"[undefined,undefined][undefined,undefined]\" +\n      // handlebars 'options' argument. appended to args of all helpers.\n      \"[object]\");\n});\n\nTinytest.add(\"templating - tricky branch labels\", function (test) {\n  // regression test for issue #724\n\n  var loading = ReactiveVar(true);\n  var v = ReactiveVar(1);\n\n  var x = [];\n\n  Template.test_template_trickylabels_a0.loading = function () {\n    return loading.get();\n  };\n\n  Template.test_template_trickylabels_a1.v = function () {\n    return v.get();\n  };\n\n  _.extend(Template.test_template_trickylabels_a2, {\n    created: function () { x.push('c'); },\n    rendered: function () { x.push('r'); },\n    destroyed: function () { x.push('d'); }\n  });\n\n  var div = OnscreenDiv(Meteor.render(Template.test_template_trickylabels_a0));\n  Deps.flush();\n  loading.set(false);\n  Deps.flush();\n  x.length = 0;\n\n  v.set(2);\n  Deps.flush();\n  test.equal(x.join(''), 'r'); // no 'c' or 'd'\n  test.equal(div.html().replace(/\\s+/g, ''), '<div>foo</div>2<div>bar</div>');\n\n  div.kill();\n  Deps.flush();\n});\n\nTinytest.add('templating - each falsy Issue #801', function (test) {\n  //Minor test for issue #801\n  Template.test_template_issue801.values = function() { return [1,2,null,undefined]; };\n  var frag = Meteor.render(Template.test_template_issue801);\n  test.equal(canonicalizeHtml(DomUtils.fragmentToHtml(frag)), \"12null\");\n});\n\nTinytest.add('templating - with falsy Issue #770', function (test) {\n  Template.test_template_issue770.value1 = function () { return \"abc\"; };\n  Template.test_template_issue770.value2 = function () { return false; };\n  var frag = Meteor.render(Template.test_template_issue770);\n  test.equal(canonicalizeHtml(DomUtils.fragmentToHtml(frag)), \"abcxxxabc\");\n});\n","Template.__define__(\"test_assembly_a0\",Package.handlebars.Handlebars.json_ast_to_func([[\">\",\"test_assembly_a1\"]]));\nTemplate.__define__(\"test_assembly_a1\",Package.handlebars.Handlebars.json_ast_to_func([[\">\",\"test_assembly_a2\"]]));\nTemplate.__define__(\"test_assembly_a2\",Package.handlebars.Handlebars.json_ast_to_func([[\">\",\"test_assembly_a3\"]]));\nTemplate.__define__(\"test_assembly_a3\",Package.handlebars.Handlebars.json_ast_to_func([\"Hi\"]));\nTemplate.__define__(\"test_assembly_b0\",Package.handlebars.Handlebars.json_ast_to_func([[\">\",\"test_assembly_b1\"]]));\nTemplate.__define__(\"test_assembly_b1\",Package.handlebars.Handlebars.json_ast_to_func([\"x\",[\"#\",[[0,\"if\"],[0,\"stuff\"]],[\"y\"]],[\">\",\"test_assembly_b2\"]]));\nTemplate.__define__(\"test_assembly_b2\",Package.handlebars.Handlebars.json_ast_to_func([\"hi\"]));\nTemplate.__define__(\"test_table_a0\",Package.handlebars.Handlebars.json_ast_to_func([\"<table>\\n    \",[\">\",\"test_table_a1\"],\"\\n    \",[\">\",\"test_table_a1\"],\"\\n    \",[\">\",\"test_table_a1\"],\"\\n  </table>\"]));\nTemplate.__define__(\"test_table_a1\",Package.handlebars.Handlebars.json_ast_to_func([\"<tr>\\n    \",[\">\",\"test_table_a2\"],\"\\n  </tr>\"]));\nTemplate.__define__(\"test_table_a2\",Package.handlebars.Handlebars.json_ast_to_func([\"<td>\\n    \",[\">\",\"test_table_a3\"],\"\\n  </td>\"]));\nTemplate.__define__(\"test_table_a3\",Package.handlebars.Handlebars.json_ast_to_func([\"Foo.\"]));\nTemplate.__define__(\"test_table_b0\",Package.handlebars.Handlebars.json_ast_to_func([\"<table>\\n    <tbody>\\n      \",[\">\",\"test_table_b1\"],\"\\n      \",[\">\",\"test_table_b1\"],\"\\n      \",[\">\",\"test_table_b1\"],\"\\n    </tbody>\\n  </table>\"]));\nTemplate.__define__(\"test_table_b1\",Package.handlebars.Handlebars.json_ast_to_func([\"<tr>\\n    \",[\">\",\"test_table_b2\"],\"\\n  </tr>\"]));\nTemplate.__define__(\"test_table_b2\",Package.handlebars.Handlebars.json_ast_to_func([\"<td>\\n    \",[\">\",\"test_table_b3\"],\"\\n  </td>\"]));\nTemplate.__define__(\"test_table_b3\",Package.handlebars.Handlebars.json_ast_to_func([\"Foo.\"]));\nTemplate.__define__(\"test_table_each\",Package.handlebars.Handlebars.json_ast_to_func([\"<table>\\n    \",[\"#\",[[0,\"each\"],[0,\"foo\"]],[\"\\n      <tr><td>\",[\"{\",[[0,\"bar\"]]],\"</td></tr>\\n    \"]],\"\\n  </table>\"]));\nTemplate.__define__(\"test_event_data_with\",Package.handlebars.Handlebars.json_ast_to_func([\"<div>\\n  xxx\\n  \",[\"#\",[[0,\"with\"],[0,\"TWO\"]],[\"\\n    <div>\\n      xxx\\n      \",[\"#\",[[0,\"with\"],[0,\"THREE\"]],[\"\\n        <div>\\n          xxx\\n        </div>\\n      \"]],\"\\n    </div>\\n  \"]],\"\\n</div>\"]));\nTemplate.__define__(\"test_safestring_a\",Package.handlebars.Handlebars.json_ast_to_func([[\"{\",[[0,\"foo\"]]],\" \",[\"!\",[[0,\"foo\"]]],\" \",[\"{\",[[0,\"bar\"]]],\" \",[\"!\",[[0,\"bar\"]]],\"\\n  \",[\"#\",[[0,\"foo\"]],[]],\" \",[\"#\",[[0,\"bar\"]],[]],\"\\n  \",[\"{\",[[0,\"fooprop\"]]],\" \",[\"!\",[[0,\"fooprop\"]]],\" \",[\"{\",[[0,\"barprop\"]]],\" \",[\"!\",[[0,\"barprop\"]]],\"\\n  \",[\"#\",[[0,\"fooprop\"]],[]],\" \",[\"#\",[[0,\"barprop\"]],[]]]));\nTemplate.__define__(\"test_helpers_a\",Package.handlebars.Handlebars.json_ast_to_func([\"platypus=\",[\"{\",[[0,\"platypus\"]]],\"\\n  watermelon=\",[\"{\",[[0,\"watermelon\"]]],\"\\n  daisy=\",[\"{\",[[0,\"daisy\"]]],\"\\n  tree=\",[\"{\",[[0,\"tree\"]]],\"\\n  warthog=\",[\"{\",[[0,\"warthog\"]]]]));\nTemplate.__define__(\"test_helpers_b\",Package.handlebars.Handlebars.json_ast_to_func([\"unknown=\",[\"{\",[[0,\"unknown\"]]],\"\\n  zero=\",[\"{\",[[0,\"zero\"]]]]));\nTemplate.__define__(\"test_helpers_c\",Package.handlebars.Handlebars.json_ast_to_func([\"platypus.X=\",[\"{\",[[0,\"platypus\",\"X\"]]],\"\\n  watermelon.X=\",[\"{\",[[0,\"watermelon\",\"X\"]]],\"\\n  daisy.X=\",[\"{\",[[0,\"daisy\",\"X\"]]],\"\\n  tree.X=\",[\"{\",[[0,\"tree\",\"X\"]]],\"\\n  warthog.X=\",[\"{\",[[0,\"warthog\",\"X\"]]],\"\\n  getNull.X=\",[\"{\",[[0,\"getNull\",\"X\"]]],\"\\n  getUndefined.X=\",[\"{\",[[0,\"getUndefined\",\"X\"]]],\"\\n  getUndefined.X.Y=\",[\"{\",[[0,\"getUndefined\",\"X\",\"Y\"]]]]));\nTemplate.__define__(\"test_helpers_d\",Package.handlebars.Handlebars.json_ast_to_func([\"daisygetter=\",[\"{\",[[0,\"daisygetter\"]]],\"\\n  thisTest=\",[\"{\",[[0,\"thisTest\"]]],\"\\n  \",[\"#\",[[0,\"with\"],[0,\"fancy\"]],[\"\\n    ../thisTest=\",[\"{\",[[1,\"thisTest\"]]],\"\\n  \"]],\"\\n  \",[\"#\",[[0,\"with\"],\"foo\"],[\"\\n    ../fancy.currentFruit=\",[\"{\",[[1,\"fancy\",\"currentFruit\"]]],\"\\n  \"]]]));\nTemplate.__define__(\"test_helpers_e\",Package.handlebars.Handlebars.json_ast_to_func([\"fancy.foo=\",[\"{\",[[0,\"fancy\",\"foo\"]]],\"\\n  fancy.apple.banana=\",[\"{\",[[0,\"fancy\",\"apple\",\"banana\"]]],\"\\n  fancy.currentFruit=\",[\"{\",[[0,\"fancy\",\"currentFruit\"]]],\"\\n  fancy.currentCountry.name=\",[\"{\",[[0,\"fancy\",\"currentCountry\",\"name\"]]],\"\\n  fancy.currentCountry.population=\",[\"{\",[[0,\"fancy\",\"currentCountry\",\"population\"]]],\"\\n  fancy.currentCountry.unicorns=\",[\"{\",[[0,\"fancy\",\"currentCountry\",\"unicorns\"]]]]));\nTemplate.__define__(\"test_helpers_f\",Package.handlebars.Handlebars.json_ast_to_func([\"fancyhelper.foo=\",[\"{\",[[0,\"fancyhelper\",\"foo\"]]],\"\\n  fancyhelper.apple.banana=\",[\"{\",[[0,\"fancyhelper\",\"apple\",\"banana\"]]],\"\\n  fancyhelper.currentFruit=\",[\"{\",[[0,\"fancyhelper\",\"currentFruit\"]]],\"\\n  fancyhelper.currentCountry.name=\",[\"{\",[[0,\"fancyhelper\",\"currentCountry\",\"name\"]]],\"\\n  fancyhelper.currentCountry.population=\",[\"{\",[[0,\"fancyhelper\",\"currentCountry\",\"population\"]]],\"\\n  fancyhelper.currentCountry.unicorns=\",[\"{\",[[0,\"fancyhelper\",\"currentCountry\",\"unicorns\"]]]]));\nTemplate.__define__(\"test_helpers_g\",Package.handlebars.Handlebars.json_ast_to_func([\"platypus=\",[\"{\",[[0,\"platypus\"]]],\"\\n  this.platypus=\",[\"{\",[[0,\"\",\"platypus\"]]]]));\nTemplate.__define__(\"test_helpers_h\",Package.handlebars.Handlebars.json_ast_to_func([\"(methodListFour 6 7 8 9=\",[\"{\",[[0,\"methodListFour\"],6,7,8,9]],\")\\n  (methodListFour platypus thisTest fancyhelper.currentFruit fancyhelper.currentCountry.unicorns=\",[\"{\",[[0,\"methodListFour\"],[0,\"platypus\"],[0,\"thisTest\"],[0,\"fancyhelper\",\"currentFruit\"],[0,\"fancyhelper\",\"currentCountry\",\"unicorns\"]]],\")\\n  (methodListFour platypus thisTest fancyhelper.currentFruit fancyhelper.currentCountry.unicorns a=platypus b=thisTest c=fancyhelper.currentFruit d=fancyhelper.currentCountry.unicorns=\",[\"{\",[[0,\"methodListFour\"],[0,\"platypus\"],[0,\"thisTest\"],[0,\"fancyhelper\",\"currentFruit\"],[0,\"fancyhelper\",\"currentCountry\",\"unicorns\"],{\"a\":[0,\"platypus\"],\"b\":[0,\"thisTest\"],\"c\":[0,\"fancyhelper\",\"currentFruit\"],\"d\":[0,\"fancyhelper\",\"currentCountry\",\"unicorns\"]}]],\")\\n  (helperListFour platypus thisTest fancyhelper.currentFruit fancyhelper.currentCountry.unicorns=\",[\"{\",[[0,\"helperListFour\"],[0,\"platypus\"],[0,\"thisTest\"],[0,\"fancyhelper\",\"currentFruit\"],[0,\"fancyhelper\",\"currentCountry\",\"unicorns\"]]],\")\\n  (helperListFour platypus thisTest fancyhelper.currentFruit fancyhelper.currentCountry.unicorns a=platypus b=thisTest c=fancyhelper.currentFruit d=fancyhelper.currentCountry.unicorns=\",[\"{\",[[0,\"helperListFour\"],[0,\"platypus\"],[0,\"thisTest\"],[0,\"fancyhelper\",\"currentFruit\"],[0,\"fancyhelper\",\"currentCountry\",\"unicorns\"],{\"a\":[0,\"platypus\"],\"b\":[0,\"thisTest\"],\"c\":[0,\"fancyhelper\",\"currentFruit\"],\"d\":[0,\"fancyhelper\",\"currentCountry\",\"unicorns\"]}]],\")\"]));\nTemplate.__define__(\"test_helpers_i\",Package.handlebars.Handlebars.json_ast_to_func([\"(uppercase apple=\",[\"#\",[[0,\"uppercase\"]],[\"apple\"]],\")\\n  (altered banana=\",[\"#\",[[0,\"tr\"],{\"a\":\"o\",\"n\":\"d\"}],[\"banana\"]],\")\\n  (nokeys=\",[\"#\",[[0,\"arg_and_dict\"],\"foo\",{\"x\":\"foo\"}],[]],\")\\n  (nokeys=\",[\"#\",[[0,\"arg_and_dict\"],[0,\"tree\"],{\"x\":\"foo\"}],[]],\")\\n  (biggie=\",[\"#\",[[0,\"get_arg\"],[0,\"helperListFour\"],[0,\"platypus\"],[0,\"thisTest\"],[0,\"fancyhelper\",\"currentFruit\"],[0,\"fancyhelper\",\"currentCountry\",\"unicorns\"],{\"a\":[0,\"platypus\"],\"b\":[0,\"thisTest\"],\"c\":[0,\"fancyhelper\",\"currentFruit\"],\"d\":[0,\"fancyhelper\",\"currentCountry\",\"unicorns\"]}],[]],\")\\n  (twoArgBlock=\",[\"#\",[[0,\"two_args\"],\"foo\",\"foo\"],[]],\")\"]));\nTemplate.__define__(\"test_render_a\",Package.handlebars.Handlebars.json_ast_to_func([[\"{\",[[0,\"foo\"]]],\"<br><hr>\"]));\nTemplate.__define__(\"test_render_b\",Package.handlebars.Handlebars.json_ast_to_func([[\"#\",[[0,\"with\"],200],[[\"{\",[[0,\"foo\"]]],\"<br><hr>\"]]]));\nTemplate.__define__(\"test_render_c\",Package.handlebars.Handlebars.json_ast_to_func([\"<br><hr>\"]));\nTemplate.__define__(\"test_branches_a\",Package.handlebars.Handlebars.json_ast_to_func([\"<span>\",[\"{\",[[0,\"var\"]]],\"</span>\\n  \",[\"#\",[[0,\"myConstant\"]],[\"<hr/>\"]],\"\\n  \",[\"#\",[[0,\"if\"],1],[\"\\n    \",[\"#\",[[0,\"myConstant\"]],[\"<hr/>\"]],\"\\n  \"]],\"\\n  \",[\"#\",[[0,\"myConstant\"]],[\"<hr/>\"]]]));\nTemplate.__define__(\"test_listmatching_a0\",Package.handlebars.Handlebars.json_ast_to_func([\"<span>\",[\"{\",[[0,\"var\"]]],\"</span>\\n  <p>\\n    \",[\"#\",[[0,\"each\"],[0,\"c\"]],[\"\\n      \",[\">\",\"test_listmatching_a1\"],\"\\n    \"]],\"\\n  </p>\"]));\nTemplate.__define__(\"test_listmatching_a1\",Package.handlebars.Handlebars.json_ast_to_func([[\"{\",[[0,\"letter\"]]]]));\nTemplate.__define__(\"test_isolate_a\",Package.handlebars.Handlebars.json_ast_to_func([[\"{\",[[0,\"helper\"],1]],\"\\n  \",[\"#\",[[0,\"isolate\"]],[\"\\n    \",[\"{\",[[0,\"helper\"],2]],\"\\n    \",[\"#\",[[0,\"isolate\"]],[\"\\n      \",[\"{\",[[0,\"helper\"],3]],\"\\n      \",[\"#\",[[0,\"isolate\"]],[\"\\n        \",[\"{\",[[0,\"helper\"],4]],\"\\n      \"]],\"\\n    \"]],\"\\n  \"]]]));\nTemplate.__define__(\"test_template_arg_a\",Package.handlebars.Handlebars.json_ast_to_func([\"<b>Foo</b> <i>Bar</i> <u>Baz</u>\"]));\nTemplate.__define__(\"test_template_preserve_a\",Package.handlebars.Handlebars.json_ast_to_func([\"<span class=\\\"a\\\">x</span>\\n  <span class=\\\"b\\\">x</span>\\n  <span class=\\\"c\\\">x</span>\\n  <span class=\\\"d\\\">x</span>\\n  <span class=\\\"y\\\">x</span>\\n  <span class=\\\"e\\\">x</span>\\n  <span class=\\\"z\\\">x</span>\\n  <span class=\\\"f\\\">x</span>\\n  <u>\",[\"{\",[[0,\"var\"]]],\"</u>\"]));\nTemplate.__define__(\"test_template_helpers_a\",Package.handlebars.Handlebars.json_ast_to_func([[\"{\",[[0,\"foo\"]]],[\"{\",[[0,\"bar\"]]],[\"{\",[[0,\"baz\"]]]]));\nTemplate.__define__(\"test_template_helpers_b\",Package.handlebars.Handlebars.json_ast_to_func([[\"{\",[[0,\"name\"]]],[\"{\",[[0,\"arity\"]]],[\"{\",[[0,\"toString\"]]],[\"{\",[[0,\"length\"]]],[\"{\",[[0,\"var\"]]]]));\nTemplate.__define__(\"test_template_helpers_c\",Package.handlebars.Handlebars.json_ast_to_func([[\"{\",[[0,\"name\"]]],[\"{\",[[0,\"arity\"]]],[\"{\",[[0,\"toString\"]]],[\"{\",[[0,\"length\"]]],[\"{\",[[0,\"var\"]]],\"x\"]));\nTemplate.__define__(\"test_template_events_a\",Package.handlebars.Handlebars.json_ast_to_func([\"<b>foo</b><u>bar</u><i>baz</i>\"]));\nTemplate.__define__(\"test_template_events_b\",Package.handlebars.Handlebars.json_ast_to_func([\"<b>foo</b><u>bar</u><i>baz</i>\"]));\nTemplate.__define__(\"test_template_events_c\",Package.handlebars.Handlebars.json_ast_to_func([\"<b>foo</b><u>bar</u><i>baz</i>\"]));\nTemplate.__define__(\"test_template_eachrender_a\",Package.handlebars.Handlebars.json_ast_to_func([[\"#\",[[0,\"each\"],[0,\"entries\"]],[\"\\n    <div>\",[\"{\",[[0,\"x\"]]],\"</div>\\n  \"]]]));\nTemplate.__define__(\"test_template_eachrender_b\",Package.handlebars.Handlebars.json_ast_to_func([[\"#\",[[0,\"each\"],[0,\"entries\"]],[\"\\n    <div>\",[\"{\",[[0,\"x\"]]],\"</div>\\n  \"]]]));\nTemplate.__define__(\"test_template_landmarks_a\",Package.handlebars.Handlebars.json_ast_to_func([[\"{\",[[0,\"LM\"]]],[\"!\",[[0,\"LM\"]]],[\"{\",[[0,\"LM\"]]],[\"!\",[[0,\"LM\"]]],[\"{\",[[0,\"v\"]]]]));\nTemplate.__define__(\"test_template_bare_each_a\",Package.handlebars.Handlebars.json_ast_to_func([[\"#\",[[0,\"each\"],[0,\"abc\"]],[\"\\n    \",[\"{\",[[0,\"LM\"]]],\"\\n  \"]],\"\\n  \",[\"{\",[[0,\"v\"]]]]));\nTemplate.__define__(\"test_template_labels_a0\",Package.handlebars.Handlebars.json_ast_to_func([[\"!\",[[0,\"stuff\"]]]]));\nTemplate.__define__(\"test_template_labels_a1\",Package.handlebars.Handlebars.json_ast_to_func([\"<hr>\"]));\nTemplate.__define__(\"test_template_labels_a2\",Package.handlebars.Handlebars.json_ast_to_func([\"<hr>\"]));\nTemplate.__define__(\"test_template_labels_a3\",Package.handlebars.Handlebars.json_ast_to_func([\"<hr>\"]));\nTemplate.__define__(\"test_unlabeled_cursor_a0\",Package.handlebars.Handlebars.json_ast_to_func([[\"#\",[[0,\"each\"],[0]],[[\">\",\"test_unlabeled_cursor_a1\"]]]]));\nTemplate.__define__(\"test_unlabeled_cursor_a1\",Package.handlebars.Handlebars.json_ast_to_func([\"<div>foo</div>\"]));\nTemplate.__define__(\"test_constant_text_a0\",Package.handlebars.Handlebars.json_ast_to_func([\"<div><p>preserved P:\",[\"{\",[[0,\"v\"]]],\"</p>\",[\"#\",[[0,\"constant\"]],[\"text\"]],\"</div>\"]));\nTemplate.__define__(\"test_type_casting\",Package.handlebars.Handlebars.json_ast_to_func([[\"{\",[[0,\"testTypeCasting\"],\"true\",\"false\",true,false,0,1,-1,10,-10,[0,\"1asdf\"],[0,\"-1asdf\"]]]]));\nTemplate.__define__(\"test_template_trickylabels_a0\",Package.handlebars.Handlebars.json_ast_to_func([[\"#\",[[0,\"unless\"],[0,\"loading\"]],[\"\\n    \",[\">\",\"test_template_trickylabels_a1\"],\"\\n  \"]]]));\nTemplate.__define__(\"test_template_trickylabels_a1\",Package.handlebars.Handlebars.json_ast_to_func([[\"#\",[[0,\"isolate\"]],[\"\\n    \",[\">\",\"test_template_trickylabels_a2\"],\"\\n    \",[\"{\",[[0,\"v\"]]],\"\\n  \"]],\"\\n  <div>bar</div>\"]));\nTemplate.__define__(\"test_template_trickylabels_a2\",Package.handlebars.Handlebars.json_ast_to_func([\"<div>foo</div>\"]));\nTemplate.__define__(\"test_template_issue801\",Package.handlebars.Handlebars.json_ast_to_func([[\"#\",[[0,\"each\"],[0,\"values\"]],[[\"{\",[[0]]]]]]));\nTemplate.__define__(\"test_template_issue770\",Package.handlebars.Handlebars.json_ast_to_func([[\"#\",[[0,\"with\"],[0,\"value1\"]],[[\"{\",[[0]]]],[\"xxx\"]],[\"#\",[[0,\"with\"],[0,\"value2\"]],[[\"{\",[[0]]]],[\"xxx\"]],[\"#\",[[0,\"with\"],[0,\"value1\"]],[[\"{\",[[0]]]]],[\"#\",[[0,\"with\"],[0,\"value2\"]],[[\"{\",[[0]]]]]]));\n"]}