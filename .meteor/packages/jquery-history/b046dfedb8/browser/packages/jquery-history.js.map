{"version":3,"file":"/packages/jquery-history.js","sources":["jquery-history/history.adapter.jquery.js","jquery-history/history.html4.js","jquery-history/history.js"],"names":[],"mappings":";;;;;;;;AAAA,G;AACA,4B;AACA,wD;AACA,qE;AACA,sE;AACA,G;;AAEA,U;AACA,4B;AACA,c;;AAEA,oB;AACA,I;AACA,gD;AACA,yB;;AAEA,mB;AACA,gD;AACA,mE;AACA,E;;AAEA,mB;AACA,oB;AACA,K;AACA,4C;AACA,+B;AACA,uD;AACA,+B;AACA,mB;AACA,K;AACA,oC;AACA,mC;AACA,I;;AAEA,K;AACA,sC;AACA,+B;AACA,uD;AACA,qE;AACA,mB;AACA,K;AACA,oC;AACA,mC;AACA,I;;AAEA,K;AACA,sD;AACA,4D;AACA,uD;AACA,qE;AACA,oB;AACA,K;AACA,8C;AACA,sC;AACA,iH;;AAEA,Y;AACA,iB;AACA,I;;AAEA,K;AACA,wC;AACA,+B;AACA,mB;AACA,K;AACA,iC;AACA,oB;AACA,G;AACA,G;;AAEA,8B;AACA,6C;AACA,iB;AACA,E;;AAEA,W;;;;;;;;;;;;;;;;;;;;AC3EA,G;AACA,2B;AACA,+B;AACA,wD;AACA,qE;AACA,sE;AACA,G;;AAEA,4B;AACA,c;;AAEA,4E;AACA,c;;AAEA,oB;AACA,I;AACA,4E;AACA,6C;AACA,mD;AACA,gD;AACA,yE;;AAEA,mB;AACA,kD;AACA,yE;AACA,E;;;AAGA,4E;AACA,4B;;AAEA,4B;AACA,gC;AACA,e;AACA,+D;AACA,oB;AACA,gB;AACA,G;AACA,Q;AACA,wC;AACA,G;;;AAGA,yE;AACA,e;;AAEA,K;AACA,oB;AACA,wB;AACA,K;AACA,yB;;;AAGA,yE;AACA,iB;;AAEA,K;AACA,wB;AACA,iC;AACA,K;AACA,2B;;AAEA,K;AACA,gC;AACA,wC;AACA,4B;AACA,2B;AACA,K;AACA,yC;AACA,a;AACA,0C;AACA,W;;AAEA,W;AACA,gC;;AAEA,mB;AACA,iB;AACA,I;;AAEA,K;AACA,8B;AACA,gB;AACA,4B;AACA,2B;AACA,K;AACA,uC;AACA,gB;AACA,uC;AACA,iB;AACA,I;;AAEA,mB;AACA,qC;;AAEA,iB;AACA,e;AACA,I;;AAEA,K;AACA,6B;AACA,6B;AACA,2B;AACA,qB;AACA,K;AACA,2C;AACA,a;AACA,mB;;AAEA,Y;AACA,wC;AACA,4B;AACA,6D;AACA,I;AACA,0B;AACA,uB;AACA,iE;AACA,I;AACA,S;AACA,6B;AACA,sC;AACA,I;;AAEA,iB;AACA,e;AACA,I;;;AAGA,yE;AACA,qB;;AAEA,K;AACA,4B;AACA,uC;AACA,K;AACA,+B;;AAEA,K;AACA,4B;AACA,uC;AACA,K;AACA,+B;;AAEA,K;AACA,gC;AACA,sD;AACA,0B;AACA,mB;AACA,K;AACA,yE;AACA,sD;AACA,a;AACA,mE;AACA,kB;;AAEA,2B;AACA,oB;AACA,qC;AACA,2B;AACA,gC;AACA,K;;AAEA,4B;AACA,+D;;AAEA,iB;AACA,e;AACA,I;;AAEA,K;AACA,8B;AACA,qD;AACA,yB;AACA,mB;AACA,K;AACA,uE;AACA,sD;AACA,2B;AACA,wB;AACA,mC;AACA,2B;AACA,gC;AACA,K;;AAEA,0B;AACA,0D;;AAEA,iB;AACA,e;AACA,I;;AAEA,K;AACA,gC;AACA,4C;AACA,0B;AACA,mB;AACA,K;AACA,2C;AACA,a;AACA,iD;AACA,c;;AAEA,W;AACA,yD;;AAEA,iB;AACA,oB;AACA,I;;AAEA,K;AACA,gC;AACA,4C;AACA,0B;AACA,mB;AACA,K;AACA,yC;AACA,W;AACA,wD;;AAEA,iB;AACA,oB;AACA,I;;AAEA,K;AACA,gC;AACA,8C;AACA,yB;AACA,0B;AACA,wB;AACA,mB;AACA,K;AACA,yC;AACA,sD;AACA,a;AACA,iD;;AAEA,iC;AACA,yC;AACA,8C;AACA,I;;AAEA,iB;AACA,e;AACA,I;;;AAGA,yE;AACA,6B;;AAEA,sC;AACA,K;AACA,wF;AACA,M;;AAEA,M;AACA,8B;AACA,mC;AACA,M;AACA,uC;AACA,kC;AACA,mC;;AAEA,mE;AACA,8B;AACA,sB;AACA,oC;;AAEA,sC;AACA,yC;AACA,mB;AACA,wE;;AAEA,qB;AACA,mC;AACA,+C;;AAEA,qB;AACA,yC;AACA,mC;;AAEA,qB;AACA,uC;;AAEA,oC;AACA,0C;AACA,2C;;AAEA,oE;AACA,yB;AACA,4B;;AAEA,mC;AACA,0C;AACA,sB;AACA,6B;AACA,oB;AACA,O;;AAEA,uB;AACA,4B;;AAEA,c;AACA,+C;AACA,0F;;AAEA,2D;AACA,gD;AACA,kB;AACA,uC;;AAEA,8C;AACA,2C;AACA,wI;;AAEA,mB;AACA,mD;;AAEA,+B;AACA,6C;AACA,8C;;AAEA,mC;AACA,uF;AACA,Q;;AAEA,kC;AACA,oD;AACA,O;;AAEA,yD;AACA,iD;AACA,4I;;AAEA,kB;AACA,mC;;AAEA,yB;AACA,yC;AACA,O;;AAEA,sB;AACA,6B;;AAEA,oB;AACA,kB;AACA,O;AACA,K;AACA,U;AACA,qB;AACA,6B;;AAEA,mC;AACA,0C;AACA,gB;AACA,2C;;AAEA,2D;AACA,gD;AACA,kB;AACA,uC;;AAEA,kC;AACA,oD;AACA,O;;AAEA,oB;AACA,kB;AACA,O;AACA,K;;AAEA,iC;AACA,wG;;AAEA,W;AACA,gB;AACA,+B;;AAEA,yB;AACA,qD;;AAEA,kC;;;AAGA,yE;AACA,wB;;AAEA,wC;AACA,qC;AACA,K;AACA,0E;AACA,M;;AAEA,M;AACA,iC;AACA,oE;AACA,M;AACA,0C;AACA,uD;;AAEA,c;AACA,yE;AACA,oD;AACA,yB;AACA,6B;AACA,kC;AACA,mB;;AAEA,qC;AACA,4C;AACA,8E;AACA,wD;AACA,yB;AACA,kB;AACA,K;;AAEA,6B;AACA,kC;;AAEA,qE;AACA,kC;;AAEA,kB;AACA,oE;AACA,8E;AACA,+B;AACA,oD;AACA,yB;AACA,kB;AACA,K;;AAEA,mB;AACA,4G;;AAEA,qC;AACA,mD;AACA,wD;AACA,8E;AACA,yB;AACA,kB;AACA,K;;AAEA,4B;AACA,4D;;AAEA,qC;AACA,yD;AACA,0B;AACA,qF;AACA,+F;AACA,+B;AACA,4D;AACA,0B;AACA,a;AACA,8B;AACA,2D;AACA,6B;AACA,M;AACA,kB;AACA,K;;AAEA,+B;AACA,gE;AACA,mF;;AAEA,+B;AACA,gB;AACA,K;AACA,kE;;AAEA,M;AACA,uC;AACA,8E;AACA,gD;AACA,0B;AACA,2B;AACA,yB;AACA,oB;AACA,M;AACA,sD;AACA,4D;;AAEA,sB;AACA,sC;AACA,wG;AACA,K;;AAEA,sB;AACA,8C;AACA,4B;AACA,mE;AACA,wB;AACA,qB;AACA,kC;AACA,sB;AACA,kB;AACA,Q;AACA,kB;AACA,K;;AAEA,gB;AACA,uB;;AAEA,6B;AACA,6D;AACA,qD;AACA,wC;AACA,qD;AACA,mC;;AAEA,yB;AACA,iC;AACA,0C;;AAEA,wB;AACA,mC;;AAEA,gC;AACA,+B;;AAEA,qC;AACA,0C;AACA,mE;AACA,yB;AACA,kB;AACA,K;;AAEA,wB;AACA,uG;AACA,gF;AACA,yC;AACA,kB;AACA,K;;AAEA,yB;AACA,gC;;AAEA,uB;AACA,2D;AACA,kD;AACA,wB;;AAEA,4B;AACA,gB;AACA,K;;AAEA,M;AACA,0C;AACA,8C;AACA,gD;AACA,0B;AACA,2B;AACA,yB;AACA,oB;AACA,M;AACA,yD;AACA,+D;;AAEA,sB;AACA,sC;AACA,wG;AACA,K;;AAEA,sB;AACA,8C;AACA,4B;AACA,sE;AACA,wB;AACA,qB;AACA,qC;AACA,sB;AACA,kB;AACA,Q;AACA,kB;AACA,K;;AAEA,gB;AACA,uB;;AAEA,8B;AACA,oE;AACA,+C;AACA,mD;;AAEA,wB;AACA,0D;;AAEA,yB;AACA,uE;;AAEA,+B;AACA,gB;AACA,K;;AAEA,iC;;;;AAIA,yE;AACA,e;;AAEA,wC;AACA,qC;AACA,M;AACA,+C;AACA,M;AACA,6D;AACA,yC;AACA,kD;AACA,O;AACA,I;;AAEA,iC;;AAEA,wB;;AAEA,8B;AACA,6C;AACA,iB;AACA,E;;AAEA,W;;;;;;;;;;;;;;;;;;;AC5mBA,G;AACA,kB;AACA,wD;AACA,qE;AACA,sE;AACA,G;;AAEA,4B;AACA,c;;AAEA,4E;AACA,c;;AAEA,oB;AACA,I;AACA,mE;AACA,4E;AACA,+E;AACA,kE;AACA,iC;AACA,qC;AACA,mC;AACA,uC;AACA,qB;AACA,uB;AACA,yE;AACA,iD;;AAEA,0B;AACA,8C;AACA,sC;;AAEA,mB;AACA,6C;AACA,gE;AACA,E;;AAEA,sB;AACA,2B;AACA,iC;AACA,iD;AACA,gB;AACA,G;;AAEA,8B;AACA,kD;AACA,sB;AACA,G;;AAEA,uC;AACA,mD;AACA,uB;AACA,G;;AAEA,gB;AACA,c;AACA,G;;;AAGA,4E;AACA,mB;;AAEA,mB;AACA,+B;AACA,e;AACA,8D;AACA,oB;AACA,gB;AACA,G;AACA,Q;AACA,uC;AACA,G;;;AAGA,yE;AACA,Y;;AAEA,K;AACA,oB;AACA,yB;AACA,K;AACA,wC;;AAEA,K;AACA,uC;AACA,6D;AACA,K;AACA,iF;;AAEA,K;AACA,uC;AACA,8D;AACA,K;AACA,iF;;AAEA,K;AACA,wC;AACA,qE;AACA,K;AACA,mF;;AAEA,K;AACA,kC;AACA,gD;AACA,K;AACA,wE;;AAEA,K;AACA,8B;AACA,gD;AACA,K;AACA,+D;;AAEA,K;AACA,0B;AACA,oD;AACA,K;AACA,yD;;AAEA,K;AACA,iC;AACA,2C;AACA,K;AACA,gF;;;AAGA,yE;AACA,oB;;AAEA,K;AACA,yB;AACA,oE;AACA,K;AACA,4B;;AAEA,K;AACA,8B;AACA,sC;AACA,K;AACA,yC;AACA,oC;AACA,kD;AACA,qC;AACA,0B;AACA,K;AACA,gC;AACA,I;AACA,I;;;AAGA,yE;AACA,U;;AAEA,K;AACA,+B;AACA,+C;AACA,K;AACA,6B;AACA,0C;AACA,yC;AACA,I;AACA,I;;AAEA,K;AACA,6B;AACA,8B;AACA,K;AACA,2B;AACA,a;AACA,M;AACA,wI;AACA,8C;AACA,Y;AACA,Q;AACA,Y;AACA,K;;AAEA,sB;AACA,yB;AACA,iD;AACA,2B;AACA,iD;AACA,iD;AACA,K;AACA,U;AACA,+C;AACA,K;AACA,I;AACA,S;AACA,uC;AACA,I;;AAEA,kB;AACA,6C;AACA,uB;AACA,mE;AACA,U;AACA,gC;AACA,M;AACA,0B;AACA,yB;AACA,M;AACA,K;AACA,6B;AACA,I;;AAEA,c;AACA,oB;AACA,0C;AACA,uE;AACA,I;AACA,6B;AACA,+B;AACA,mB;AACA,I;;AAEA,iB;AACA,e;AACA,I;;;AAGA,yE;AACA,oB;;AAEA,K;AACA,8C;AACA,iD;AACA,sB;AACA,2B;AACA,0D;AACA,4D;AACA,K;AACA,uD;AACA,gE;AACA,4E;AACA,oD;AACA,kB;AACA,gB;AACA,4C;AACA,4C;AACA,iG;AACA,iC;AACA,S;AACA,K;AACA,iB;AACA,I;;AAEA,K;AACA,iC;AACA,oC;AACA,sB;AACA,2B;AACA,0D;AACA,K;AACA,0C;AACA,e;AACA,uC;AACA,8D;AACA,wC;AACA,yD;AACA,K;AACA,iB;AACA,I;;AAEA,K;AACA,qB;AACA,sC;AACA,K;AACA,sB;AACA,uB;AACA,6E;AACA,S;AACA,6I;AACA,8J;AACA,K;AACA,K;AACA,uB;AACA,iE;AACA,M;AACA,mF;AACA,I;AACA,I;;AAEA,K;AACA,oB;AACA,wB;AACA,K;AACA,gD;;AAEA,K;AACA,iB;AACA,2B;AACA,K;AACA,kB;AACA,M;AACA,oH;AACA,mD;AACA,M;AACA,4J;;AAEA,M;AACA,8F;AACA,mD;AACA,M;AACA,+J;;AAEA,M;AACA,oH;AACA,M;AACA,yG;;AAEA,M;AACA,oG;AACA,M;AACA,qG;AACA,I;;AAEA,K;AACA,+B;AACA,yC;AACA,wB;AACA,sB;AACA,K;AACA,yC;AACA,4B;AACA,iB;AACA,I;AACA,e;AACA,I;;AAEA,K;AACA,6B;AACA,0E;AACA,wB;AACA,qB;AACA,K;AACA,uC;AACA,mB;AACA,e;AACA,+B;AACA,8B;AACA,I;AACA,S;AACA,gB;AACA,I;AACA,iB;AACA,I;;;AAGA,yE;AACA,gB;;AAEA,K;AACA,yB;AACA,yE;AACA,6B;AACA,K;AACA,kC;AACA,Y;AACA,sG;AACA,yC;AACA,0C;AACA,I;AACA,kB;;AAEA,Y;AACA,kB;AACA,I;;AAEA,K;AACA,0B;AACA,iF;AACA,8B;AACA,K;AACA,mC;AACA,Y;AACA,M;AACA,yD;AACA,uB;AACA,kB;;AAEA,2B;AACA,qC;AACA,+B;AACA,kC;AACA,sD;AACA,I;;AAEA,2B;AACA,0C;AACA,mC;;AAEA,Y;AACA,mB;AACA,I;;AAEA,K;AACA,yB;AACA,gF;AACA,6B;AACA,K;AACA,kC;AACA,Y;AACA,uF;;AAEA,Y;AACA,kB;AACA,I;;AAEA,K;AACA,yB;AACA,wC;AACA,6B;AACA,K;AACA,kC;AACA,W;AACA,M;AACA,0C;AACA,uD;AACA,Y;;AAEA,Y;AACA,uF;AACA,+C;AACA,M;;AAEA,Y;AACA,kB;AACA,I;;AAEA,K;AACA,6B;AACA,yD;AACA,iC;AACA,K;AACA,sC;AACA,Y;AACA,gH;AACA,6C;AACA,6B;;AAEA,Y;AACA,sB;AACA,I;;AAEA,K;AACA,4B;AACA,gE;AACA,wB;AACA,mC;AACA,6B;AACA,K;AACA,mD;AACA,a;AACA,qD;AACA,iF;;AAEA,W;AACA,oC;AACA,e;AACA,I;AACA,kC;AACA,e;AACA,0D;AACA,I;AACA,kC;AACA,iB;AACA,yD;AACA,I;AACA,kC;AACA,gB;AACA,6D;AACA,I;AACA,S;AACA,mB;AACA,0B;AACA,+D;AACA,Y;AACA,mE;AACA,K;AACA,6D;AACA,qD;AACA,yD;AACA,6C;AACA,wD;AACA,I;;AAEA,Y;AACA,oC;AACA,I;;AAEA,K;AACA,6B;AACA,+D;AACA,wB;AACA,yB;AACA,K;AACA,sC;AACA,a;AACA,sF;;AAEA,kB;AACA,sC;AACA,iE;AACA,iE;AACA,4E;AACA,4C;AACA,I;;AAEA,kB;AACA,4C;;AAEA,8C;AACA,iD;AACA,6B;AACA,I;;AAEA,c;AACA,mE;;AAEA,Y;AACA,mB;AACA,I;;;AAGA,yE;AACA,kB;;AAEA,K;AACA,kB;AACA,4C;AACA,K;AACA,qB;;AAEA,K;AACA,sB;AACA,kC;AACA,K;AACA,4C;;AAEA,K;AACA,sB;AACA,kC;AACA,K;AACA,4C;;AAEA,K;AACA,oB;AACA,+B;AACA,K;AACA,wC;;AAEA,K;AACA,yB;AACA,iC;AACA,K;AACA,kD;;AAEA,K;AACA,wB;AACA,iC;AACA,K;AACA,gD;;AAEA,K;AACA,6B;AACA,mD;AACA,K;AACA,sC;AACA,yD;AACA,qD;AACA,yD;AACA,I;;AAEA,K;AACA,uB;AACA,0E;AACA,8B;AACA,4B;AACA,2B;AACA,K;AACA,+C;AACA,a;AACA,8D;AACA,0D;;AAEA,W;AACA,2C;;AAEA,Y;AACA,4B;AACA,wC;AACA,I;;AAEA,Y;AACA,oB;AACA,uC;AACA,0C;AACA,I;;AAEA,Y;AACA,gB;AACA,I;;AAEA,K;AACA,gC;AACA,0B;AACA,4B;AACA,wB;AACA,K;AACA,4C;;AAEA,c;AACA,4C;AACA,Q;AACA,G;AACA,e;AACA,+B;AACA,2C;AACA,0D;AACA,iC;AACA,K;AACA,qE;AACA,uC;AACA,K;AACA,U;AACA,yB;AACA,qB;AACA,4E;AACA,iH;AACA,a;AACA,O;AACA,M;;AAEA,qC;AACA,iC;AACA,sC;AACA,K;AACA,I;;AAEA,e;AACA,a;AACA,I;;AAEA,K;AACA,kC;AACA,2B;AACA,0B;AACA,qB;AACA,K;AACA,8C;AACA,e;AACA,8B;;AAEA,a;AACA,uD;AACA,kB;AACA,I;;AAEA,W;AACA,sD;AACA,oB;AACA,I;;AAEA,Y;AACA,iE;AACA,uB;AACA,I;;AAEA,sE;;AAEA,Y;AACA,iB;AACA,8B;AACA,uC;AACA,mG;AACA,qD;AACA,sD;;AAEA,c;AACA,gD;;AAEA,sE;;AAEA,mB;AACA,+D;AACA,oC;;AAEA,kD;AACA,wD;;AAEA,W;AACA,0C;AACA,qB;AACA,iF;AACA,sC;AACA,0B;AACA,K;AACA,2C;AACA,I;;AAEA,2B;AACA,0D;;AAEA,sE;;AAEA,2C;AACA,wG;AACA,sC;AACA,I;;AAEA,sE;;AAEA,Y;AACA,mB;AACA,I;;AAEA,K;AACA,8C;AACA,mE;AACA,yB;AACA,0B;AACA,wB;AACA,qB;AACA,K;AACA,uD;AACA,a;AACA,gB;AACA,iB;AACA,mB;AACA,c;AACA,K;;AAEA,sB;AACA,yC;;AAEA,mB;AACA,gB;AACA,I;;AAEA,K;AACA,6B;AACA,4B;AACA,uB;AACA,K;AACA,sC;AACA,a;AACA,mB;;AAEA,c;AACA,iF;;AAEA,kB;AACA,gB;AACA,I;;AAEA,K;AACA,yB;AACA,+B;AACA,K;AACA,iD;AACA,a;AACA,gC;;AAEA,W;AACA,+C;;AAEA,W;AACA,mB;AACA,qB;AACA,6B;AACA,wB;AACA,K;;AAEA,W;AACA,sC;;AAEA,Y;AACA,c;AACA,I;;AAEA,K;AACA,qB;AACA,+B;AACA,wB;AACA,K;AACA,6C;AACA,a;AACA,iB;AACA,G;AACA,W;AACA,+C;;AAEA,W;AACA,iB;;AAEA,Y;AACA,a;AACA,I;;AAEA,K;AACA,kC;AACA,wC;AACA,+B;AACA,0B;AACA,K;AACA,iD;AACA,a;AACA,mB;AACA,G;AACA,W;AACA,+C;;AAEA,U;AACA,qB;;AAEA,Y;AACA,e;AACA,I;;AAEA,K;AACA,mC;AACA,uC;AACA,gC;AACA,wB;AACA,K;AACA,gD;AACA,a;AACA,oB;;AAEA,a;AACA,qD;AACA,uD;AACA,0C;;AAEA,Y;AACA,oB;AACA,I;;AAEA,K;AACA,gC;AACA,4D;AACA,gC;AACA,sB;AACA,K;AACA,sD;AACA,W;AACA,uD;;AAEA,Y;AACA,wB;AACA,I;;AAEA,K;AACA,yB;AACA,oC;AACA,gC;AACA,yB;AACA,K;AACA,sD;AACA,a;AACA,6B;AACA,0B;;AAEA,gB;AACA,uC;AACA,c;AACA,qC;AACA,I;;AAEA,kC;AACA,kB;AACA,gB;AACA,0C;;AAEA,gB;AACA,wC;AACA,e;AACA,sC;AACA,K;;AAEA,mB;AACA,0E;AACA,sD;AACA,K;AACA,I;;AAEA,Y;AACA,gB;AACA,I;;AAEA,K;AACA,yB;AACA,kC;AACA,K;AACA,qC;AACA,W;AACA,4E;;AAEA,Y;AACA,a;AACA,I;;AAEA,K;AACA,gC;AACA,0E;AACA,2B;AACA,K;AACA,yC;AACA,uE;AACA,I;;AAEA,K;AACA,iC;AACA,0E;AACA,2B;AACA,K;AACA,0C;AACA,yE;AACA,I;;AAEA,K;AACA,4B;AACA,6C;AACA,6B;AACA,mC;AACA,K;AACA,gD;AACA,a;AACA,4B;AACA,a;;AAEA,W;AACA,iD;;AAEA,W;AACA,0D;;AAEA,Y;AACA,uB;AACA,I;;AAEA,K;AACA,uB;AACA,kB;AACA,6B;AACA,8B;AACA,K;AACA,0C;AACA,qB;AACA,+C;;AAEA,oB;AACA,4D;;AAEA,qB;AACA,mB;AACA,I;;AAEA,K;AACA,uC;AACA,gD;AACA,6B;AACA,6B;AACA,K;AACA,gD;AACA,a;AACA,sB;AACA,2B;;AAEA,W;AACA,sC;AACA,wB;AACA,2C;AACA,wB;;AAEA,Y;AACA,+B;AACA,I;;AAEA,Y;AACA,iB;AACA,I;;AAEA,K;AACA,sB;AACA,iB;AACA,6B;AACA,8B;AACA,K;AACA,yC;AACA,gB;AACA,8C;AACA,iB;AACA,I;;AAEA,oB;AACA,2D;;AAEA,iB;AACA,e;AACA,I;;AAEA,K;AACA,8B;AACA,8B;AACA,2B;AACA,qB;AACA,K;AACA,4C;AACA,a;AACA,oB;;AAEA,Y;AACA,wC;AACA,4B;AACA,8D;AACA,I;AACA,0B;AACA,uB;AACA,kE;AACA,I;AACA,S;AACA,6B;AACA,uC;AACA,I;;AAEA,kB;AACA,gB;AACA,I;;;AAGA,yE;AACA,iB;;AAEA,K;AACA,sB;AACA,mC;AACA,qB;AACA,K;AACA,+B;AACA,2D;AACA,e;AACA,I;;AAEA,K;AACA,6B;AACA,sB;AACA,wB;AACA,qB;AACA,K;AACA,yC;AACA,a;AACA,oB;AACA,Q;;AAEA,mB;AACA,mB;AACA,kC;AACA,2B;AACA,W;AACA,K;AACA,iB;AACA,I;;AAEA,mB;AACA,iB;AACA,I;;AAEA,K;AACA,2B;AACA,kC;AACA,yB;AACA,qB;AACA,K;AACA,wC;AACA,a;AACA,4C;;AAEA,mB;AACA,2C;;AAEA,mB;AACA,iB;AACA,I;;AAEA,K;AACA,4B;AACA,qC;AACA,qB;AACA,K;AACA,yC;AACA,a;AACA,6D;;AAEA,mB;AACA,iB;AACA,I;;AAEA,K;AACA,0B;AACA,2B;AACA,yB;AACA,sB;AACA,K;AACA,yC;AACA,a;AACA,oC;;AAEA,qB;AACA,6C;AACA,2B;AACA,gE;AACA,uB;AACA,oB;AACA,+B;AACA,qB;AACA,iB;AACA,O;AACA,iB;AACA,I;;AAEA,S;AACA,mD;;AAEA,a;AACA,2C;;AAEA,0B;AACA,sB;;AAEA,8B;AACA,2C;AACA,gD;AACA,0C;AACA,wH;;AAEA,gB;AACA,8D;AACA,I;AACA,wD;AACA,yC;;AAEA,0B;AACA,iC;AACA,oE;;AAEA,2B;AACA,oC;;AAEA,yB;AACA,iE;AACA,K;AACA,U;AACA,yB;AACA,2C;AACA,K;AACA,I;;AAEA,W;AACA,kB;AACA,I;;AAEA,K;AACA,qB;AACA,gC;AACA,qB;AACA,K;AACA,sC;AACA,a;AACA,4C;;AAEA,iB;AACA,kC;;AAEA,oB;AACA,oC;AACA,2B;AACA,mB;AACA,0B;AACA,0B;AACA,0B;AACA,2B;AACA,I;;AAEA,mB;AACA,iB;AACA,I;;AAEA,K;AACA,8B;AACA,iC;AACA,wB;AACA,yB;AACA,K;AACA,uC;AACA,sB;AACA,yB;AACA,4C;AACA,K;;AAEA,mB;AACA,qC;;AAEA,iB;AACA,e;AACA,I;;AAEA,K;AACA,4B;AACA,sC;AACA,4B;AACA,sB;AACA,K;AACA,wC;AACA,a;AACA,8B;AACA,e;;AAEA,a;AACA,kB;AACA,4C;AACA,0D;AACA,4D;AACA,K;AACA,I;;AAEA,W;AACA,Q;AACA,iI;AACA,I;AACA,0B;AACA,0B;;AAEA,W;AACA,kB;AACA,I;;;AAGA,yE;AACA,a;;AAEA,K;AACA,mB;AACA,8B;AACA,wB;AACA,K;AACA,sB;;AAEA,K;AACA,wB;AACA,sC;AACA,2B;AACA,K;AACA,iC;AACA,W;AACA,wC;AACA,8H;AACA,8B;AACA,I;AACA,a;AACA,yD;AACA,8B;AACA,I;;AAEA,W;AACA,8B;AACA,yC;AACA,uC;AACA,8B;AACA,wB;AACA,qC;AACA,qD;AACA,gC;AACA,yC;AACA,2B;AACA,kC;AACA,4E;AACA,M;AACA,M;AACA,0E;AACA,I;;AAEA,Y;AACA,4B;AACA,I;;AAEA,K;AACA,sB;AACA,K;AACA,4B;;AAEA,K;AACA,gC;AACA,sB;AACA,yB;AACA,2B;AACA,K;AACA,yC;AACA,iE;AACA,I;;AAEA,K;AACA,qC;AACA,6B;AACA,qD;AACA,K;AACA,qC;AACA,uB;AACA,qE;;AAEA,sB;AACA,4C;;AAEA,W;AACA,kB;AACA,I;;AAEA,K;AACA,6D;AACA,kE;AACA,K;AACA,uC;AACA,a;AACA,sC;AACA,Y;AACA,mB;AACA,M;AACA,I;AACA,wC;AACA,uB;AACA,I;;AAEA,Y;AACA,0B;AACA,4B;AACA,W;AACA,gC;AACA,I;;AAEA,W;AACA,kB;AACA,I;;AAEA,K;AACA,yB;AACA,qB;AACA,K;AACA,kC;AACA,6B;AACA,uB;AACA,kB;AACA,I;;;AAGA,yE;AACA,e;;AAEA,K;AACA,yB;AACA,4F;AACA,K;AACA,+B;;AAEA,K;AACA,0B;AACA,oD;AACA,K;AACA,gC;;AAEA,K;AACA,kC;AACA,4B;AACA,sB;AACA,K;AACA,2C;AACA,Y;AACA,+B;;AAEA,W;AACA,8B;;AAEA,W;AACA,kB;AACA,I;;AAEA,K;AACA,+B;AACA,yB;AACA,sB;AACA,K;AACA,wC;AACA,W;AACA,iC;AACA,wC;AACA,kC;AACA,I;;AAEA,W;AACA,kB;AACA,I;;AAEA,K;AACA,0B;AACA,0B;AACA,sB;AACA,K;AACA,2C;AACA,W;AACA,gC;AACA,8B;;AAEA,sI;AACA,+G;AACA,sC;AACA,kB;AACA,uC;AACA,gB;AACA,iC;AACA,oC;AACA,kG;AACA,oB;AACA,kB;AACA,O;AACA,kB;AACA,O;AACA,wC;AACA,M;AACA,I;;AAEA,W;AACA,kB;AACA,I;;;AAGA,yE;AACA,mB;;AAEA,K;AACA,8B;AACA,2B;AACA,sB;AACA,K;AACA,uC;AACA,kB;;AAEA,8C;AACA,M;AACA,4D;AACA,a;;AAEA,4B;AACA,+C;AACA,wB;AACA,I;AACA,S;AACA,W;AACA,I;;AAEA,4C;AACA,sB;AACA,qB;AACA,oD;AACA,2C;AACA,I;;AAEA,yB;AACA,uD;AACA,8C;;AAEA,W;AACA,kB;AACA,I;;;AAGA,yE;AACA,kB;;AAEA,K;AACA,wB;AACA,2C;AACA,sC;AACA,K;AACA,iC;AACA,sD;;AAEA,qB;AACA,6C;AACA,2B;AACA,6D;AACA,uB;AACA,oB;AACA,4B;AACA,qB;AACA,iB;AACA,O;AACA,iB;AACA,I;;AAEA,0B;AACA,sB;;AAEA,mE;AACA,kC;AACA,wB;AACA,M;;AAEA,a;AACA,kB;;AAEA,sB;AACA,e;AACA,I;;AAEA,K;AACA,2B;AACA,8C;AACA,sC;AACA,K;AACA,oC;AACA,yD;;AAEA,qB;AACA,6C;AACA,2B;AACA,gE;AACA,uB;AACA,oB;AACA,+B;AACA,qB;AACA,iB;AACA,O;AACA,iB;AACA,I;;AAEA,0B;AACA,sB;;AAEA,mE;AACA,kC;AACA,2B;AACA,M;;AAEA,gB;AACA,iB;;AAEA,yB;AACA,e;AACA,I;;AAEA,K;AACA,4B;AACA,yD;AACA,sC;AACA,K;AACA,qC;AACA,oD;;AAEA,a;AACA,S;;AAEA,Y;AACA,qB;AACA,c;AACA,gC;AACA,4B;AACA,K;AACA,I;AACA,0B;AACA,e;AACA,iC;AACA,yB;AACA,K;AACA,I;AACA,S;AACA,8F;AACA,I;;AAEA,W;AACA,kB;AACA,I;;;AAGA,yE;AACA,wB;;AAEA,wC;AACA,qC;AACA,K;AACA,yC;AACA,M;;AAEA,a;AACA,oC;AACA,wD;AACA,8D;AACA,iC;;AAEA,oC;AACA,Q;AACA,K;AACA,iD;AACA,M;;AAEA,M;AACA,qC;AACA,+B;AACA,M;AACA,8C;AACA,c;AACA,qE;;AAEA,6B;AACA,kC;;AAEA,8C;AACA,oC;AACA,wB;AACA,mB;AACA,mF;AACA,0B;AACA,sD;AACA,sC;AACA,qF;AACA,2F;AACA,M;AACA,W;AACA,2B;AACA,6E;AACA,qD;AACA,0B;AACA,M;;AAEA,gC;AACA,qC;AACA,kB;AACA,K;;AAEA,a;AACA,6E;;AAEA,kB;AACA,oB;AACA,6C;AACA,8C;AACA,K;AACA,yC;AACA,yE;AACA,8D;AACA,K;AACA,U;AACA,qB;AACA,6D;AACA,K;;AAEA,2C;AACA,sB;AACA,4B;AACA,4E;AACA,K;;AAEA,Y;AACA,oC;;AAEA,qC;AACA,+C;AACA,8E;AACA,qF;AACA,yB;AACA,kB;AACA,K;;AAEA,sB;AACA,iC;AACA,gC;;AAEA,gC;AACA,+B;;AAEA,qB;AACA,kD;AACA,wB;;AAEA,kB;AACA,gB;AACA,K;AACA,8D;;AAEA,M;AACA,uC;AACA,8E;AACA,gD;AACA,0B;AACA,2B;AACA,yB;AACA,oB;AACA,M;AACA,sD;AACA,4D;;AAEA,sB;AACA,oE;AACA,wG;AACA,K;;AAEA,sB;AACA,8C;AACA,4B;AACA,mE;AACA,wB;AACA,qB;AACA,kC;AACA,sB;AACA,kB;AACA,Q;AACA,kB;AACA,K;;AAEA,2B;AACA,uB;;AAEA,0B;AACA,6D;;AAEA,e;AACA,+C;AACA,yB;AACA,yB;AACA,K;AACA,U;AACA,0B;AACA,kC;AACA,2C;;AAEA,yB;AACA,gE;;AAEA,wB;AACA,gD;AACA,K;;AAEA,4B;AACA,gB;AACA,K;;AAEA,M;AACA,0C;AACA,8C;AACA,gD;AACA,0B;AACA,2B;AACA,yB;AACA,oB;AACA,M;AACA,yD;AACA,+D;;AAEA,sB;AACA,oE;AACA,wG;AACA,K;;AAEA,sB;AACA,8C;AACA,4B;AACA,sE;AACA,wB;AACA,qB;AACA,qC;AACA,sB;AACA,kB;AACA,Q;AACA,kB;AACA,K;;AAEA,2B;AACA,uB;;AAEA,0B;AACA,6D;;AAEA,e;AACA,+C;AACA,yB;AACA,yB;AACA,K;AACA,U;AACA,0B;AACA,kC;AACA,2C;;AAEA,yB;AACA,mE;;AAEA,wB;AACA,gD;AACA,K;;AAEA,+B;AACA,gB;AACA,K;;AAEA,kC;;;AAGA,yE;AACA,e;;AAEA,K;AACA,mB;AACA,K;AACA,yB;AACA,W;AACA,Q;AACA,4E;AACA,I;AACA,kB;AACA,uB;AACA,I;;AAEA,e;AACA,4B;AACA,G;AACA,Q;AACA,kB;AACA,sB;AACA,4B;AACA,G;;AAEA,K;AACA,oD;AACA,K;AACA,wE;AACA,kE;;AAEA,K;AACA,6B;AACA,K;AACA,2F;;AAEA,K;AACA,0B;AACA,K;AACA,yB;AACA,6B;AACA,iC;AACA,c;AACA,2B;;AAEA,Y;AACA,S;AACA,4E;AACA,K;AACA,mB;AACA,uB;AACA,K;;AAEA,a;AACA,0D;AACA,sD;AACA,0D;;AAEA,W;AACA,uC;AACA,qD;AACA,e;AACA,M;AACA,4D;AACA,K;AACA,qC;AACA,mD;AACA,e;AACA,M;AACA,wD;AACA,K;AACA,uC;AACA,qD;AACA,e;AACA,M;AACA,4D;AACA,K;;AAEA,a;AACA,iC;AACA,6B;;AAEA,Y;AACA,yE;AACA,K;;AAEA,2B;AACA,0F;AACA,G;AACA,wB;AACA,gE;AACA,0D;AACA,G;AACA,sC;AACA,G;;AAEA,wC;AACA,sC;AACA,0E;AACA,8D;AACA,yC;;AAEA,M;AACA,sB;AACA,M;AACA,mC;AACA,wG;AACA,I;;AAEA,M;AACA,wC;AACA,M;AACA,oG;AACA,O;AACA,kC;AACA,O;;AAEA,kB;AACA,wD;AACA,gD;AACA,O;;AAEA,uB;AACA,8B;AACA,0C;AACA,mD;AACA,Q;AACA,K;AACA,I;;AAEA,kC;;;AAGA,uB;;AAEA,8B;AACA,gB;;AAEA,W","sourcesContent":["/**\n * History.js jQuery Adapter\n * @author Benjamin Arthur Lupton <contact@balupton.com>\n * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>\n * @license New BSD License <http://creativecommons.org/licenses/BSD/>\n */\n\n// Closure\n(function(window,undefined){\n\t\"use strict\";\n\n\t// Localise Globals\n\tvar\n\t\tHistory = window.History = window.History||{},\n\t\tjQuery = window.jQuery;\n\n\t// Check Existence\n\tif ( typeof History.Adapter !== 'undefined' ) {\n\t\tthrow new Error('History.js Adapter has already been loaded...');\n\t}\n\n\t// Add the Adapter\n\tHistory.Adapter = {\n\t\t/**\n\t\t * History.Adapter.bind(el,event,callback)\n\t\t * @param {Element|string} el\n\t\t * @param {string} event - custom and standard events\n\t\t * @param {function} callback\n\t\t * @return {void}\n\t\t */\n\t\tbind: function(el,event,callback){\n\t\t\tjQuery(el).bind(event,callback);\n\t\t},\n\n\t\t/**\n\t\t * History.Adapter.trigger(el,event)\n\t\t * @param {Element|string} el\n\t\t * @param {string} event - custom and standard events\n\t\t * @param {Object=} extra - a object of extra event data (optional)\n\t\t * @return {void}\n\t\t */\n\t\ttrigger: function(el,event,extra){\n\t\t\tjQuery(el).trigger(event,extra);\n\t\t},\n\n\t\t/**\n\t\t * History.Adapter.extractEventData(key,event,extra)\n\t\t * @param {string} key - key for the event data to extract\n\t\t * @param {string} event - custom and standard events\n\t\t * @param {Object=} extra - a object of extra event data (optional)\n\t\t * @return {mixed}\n\t\t */\n\t\textractEventData: function(key,event,extra){\n\t\t\t// jQuery Native then jQuery Custom\n\t\t\tvar result = (event && event.originalEvent && event.originalEvent[key]) || (extra && extra[key]) || undefined;\n\n\t\t\t// Return\n\t\t\treturn result;\n\t\t},\n\n\t\t/**\n\t\t * History.Adapter.onDomLoad(callback)\n\t\t * @param {function} callback\n\t\t * @return {void}\n\t\t */\n\t\tonDomLoad: function(callback) {\n\t\t\tjQuery(callback);\n\t\t}\n\t};\n\n\t// Try and Initialise History\n\tif ( typeof History.init !== 'undefined' ) {\n\t\tHistory.init();\n\t}\n\n})(window);\n\n","/**\n * History.js HTML4 Support\n * Depends on the HTML5 Support\n * @author Benjamin Arthur Lupton <contact@balupton.com>\n * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>\n * @license New BSD License <http://creativecommons.org/licenses/BSD/>\n */\n\n(function(window,undefined){\n\t\"use strict\";\n\n\t// ========================================================================\n\t// Initialise\n\n\t// Localise Globals\n\tvar\n\t\tdocument = window.document, // Make sure we are using the correct document\n\t\tsetTimeout = window.setTimeout||setTimeout,\n\t\tclearTimeout = window.clearTimeout||clearTimeout,\n\t\tsetInterval = window.setInterval||setInterval,\n\t\tHistory = window.History = window.History||{}; // Public History Object\n\n\t// Check Existence\n\tif ( typeof History.initHtml4 !== 'undefined' ) {\n\t\tthrow new Error('History.js HTML4 Support has already been loaded...');\n\t}\n\n\n\t// ========================================================================\n\t// Initialise HTML4 Support\n\n\t// Initialise HTML4 Support\n\tHistory.initHtml4 = function(){\n\t\t// Initialise\n\t\tif ( typeof History.initHtml4.initialized !== 'undefined' ) {\n\t\t\t// Already Loaded\n\t\t\treturn false;\n\t\t}\n\t\telse {\n\t\t\tHistory.initHtml4.initialized = true;\n\t\t}\n\n\n\t\t// ====================================================================\n\t\t// Properties\n\n\t\t/**\n\t\t * History.enabled\n\t\t * Is History enabled?\n\t\t */\n\t\tHistory.enabled = true;\n\n\n\t\t// ====================================================================\n\t\t// Hash Storage\n\n\t\t/**\n\t\t * History.savedHashes\n\t\t * Store the hashes in an array\n\t\t */\n\t\tHistory.savedHashes = [];\n\n\t\t/**\n\t\t * History.isLastHash(newHash)\n\t\t * Checks if the hash is the last hash\n\t\t * @param {string} newHash\n\t\t * @return {boolean} true\n\t\t */\n\t\tHistory.isLastHash = function(newHash){\n\t\t\t// Prepare\n\t\t\tvar oldHash = History.getHashByIndex(),\n\t\t\t\tisLast;\n\n\t\t\t// Check\n\t\t\tisLast = newHash === oldHash;\n\n\t\t\t// Return isLast\n\t\t\treturn isLast;\n\t\t};\n\n\t\t/**\n\t\t * History.saveHash(newHash)\n\t\t * Push a Hash\n\t\t * @param {string} newHash\n\t\t * @return {boolean} true\n\t\t */\n\t\tHistory.saveHash = function(newHash){\n\t\t\t// Check Hash\n\t\t\tif ( History.isLastHash(newHash) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Push the Hash\n\t\t\tHistory.savedHashes.push(newHash);\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.getHashByIndex()\n\t\t * Gets a hash by the index\n\t\t * @param {integer} index\n\t\t * @return {string}\n\t\t */\n\t\tHistory.getHashByIndex = function(index){\n\t\t\t// Prepare\n\t\t\tvar hash = null;\n\n\t\t\t// Handle\n\t\t\tif ( typeof index === 'undefined' ) {\n\t\t\t\t// Get the last inserted\n\t\t\t\thash = History.savedHashes[History.savedHashes.length-1];\n\t\t\t}\n\t\t\telse if ( index < 0 ) {\n\t\t\t\t// Get from the end\n\t\t\t\thash = History.savedHashes[History.savedHashes.length+index];\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Get from the beginning\n\t\t\t\thash = History.savedHashes[index];\n\t\t\t}\n\n\t\t\t// Return hash\n\t\t\treturn hash;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// Discarded States\n\n\t\t/**\n\t\t * History.discardedHashes\n\t\t * A hashed array of discarded hashes\n\t\t */\n\t\tHistory.discardedHashes = {};\n\n\t\t/**\n\t\t * History.discardedStates\n\t\t * A hashed array of discarded states\n\t\t */\n\t\tHistory.discardedStates = {};\n\n\t\t/**\n\t\t * History.discardState(State)\n\t\t * Discards the state by ignoring it through History\n\t\t * @param {object} State\n\t\t * @return {true}\n\t\t */\n\t\tHistory.discardState = function(discardedState,forwardState,backState){\n\t\t\t//History.debug('History.discardState', arguments);\n\t\t\t// Prepare\n\t\t\tvar discardedStateHash = History.getHashByState(discardedState),\n\t\t\t\tdiscardObject;\n\n\t\t\t// Create Discard Object\n\t\t\tdiscardObject = {\n\t\t\t\t'discardedState': discardedState,\n\t\t\t\t'backState': backState,\n\t\t\t\t'forwardState': forwardState\n\t\t\t};\n\n\t\t\t// Add to DiscardedStates\n\t\t\tHistory.discardedStates[discardedStateHash] = discardObject;\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.discardHash(hash)\n\t\t * Discards the hash by ignoring it through History\n\t\t * @param {string} hash\n\t\t * @return {true}\n\t\t */\n\t\tHistory.discardHash = function(discardedHash,forwardState,backState){\n\t\t\t//History.debug('History.discardState', arguments);\n\t\t\t// Create Discard Object\n\t\t\tvar discardObject = {\n\t\t\t\t'discardedHash': discardedHash,\n\t\t\t\t'backState': backState,\n\t\t\t\t'forwardState': forwardState\n\t\t\t};\n\n\t\t\t// Add to discardedHash\n\t\t\tHistory.discardedHashes[discardedHash] = discardObject;\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.discardState(State)\n\t\t * Checks to see if the state is discarded\n\t\t * @param {object} State\n\t\t * @return {bool}\n\t\t */\n\t\tHistory.discardedState = function(State){\n\t\t\t// Prepare\n\t\t\tvar StateHash = History.getHashByState(State),\n\t\t\t\tdiscarded;\n\n\t\t\t// Check\n\t\t\tdiscarded = History.discardedStates[StateHash]||false;\n\n\t\t\t// Return true\n\t\t\treturn discarded;\n\t\t};\n\n\t\t/**\n\t\t * History.discardedHash(hash)\n\t\t * Checks to see if the state is discarded\n\t\t * @param {string} State\n\t\t * @return {bool}\n\t\t */\n\t\tHistory.discardedHash = function(hash){\n\t\t\t// Check\n\t\t\tvar discarded = History.discardedHashes[hash]||false;\n\n\t\t\t// Return true\n\t\t\treturn discarded;\n\t\t};\n\n\t\t/**\n\t\t * History.recycleState(State)\n\t\t * Allows a discarded state to be used again\n\t\t * @param {object} data\n\t\t * @param {string} title\n\t\t * @param {string} url\n\t\t * @return {true}\n\t\t */\n\t\tHistory.recycleState = function(State){\n\t\t\t//History.debug('History.recycleState', arguments);\n\t\t\t// Prepare\n\t\t\tvar StateHash = History.getHashByState(State);\n\n\t\t\t// Remove from DiscardedStates\n\t\t\tif ( History.discardedState(State) ) {\n\t\t\t\tdelete History.discardedStates[StateHash];\n\t\t\t}\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// HTML4 HashChange Support\n\n\t\tif ( History.emulated.hashChange ) {\n\t\t\t/*\n\t\t\t * We must emulate the HTML4 HashChange Support by manually checking for hash changes\n\t\t\t */\n\n\t\t\t/**\n\t\t\t * History.hashChangeInit()\n\t\t\t * Init the HashChange Emulation\n\t\t\t */\n\t\t\tHistory.hashChangeInit = function(){\n\t\t\t\t// Define our Checker Function\n\t\t\t\tHistory.checkerFunction = null;\n\n\t\t\t\t// Define some variables that will help in our checker function\n\t\t\t\tvar lastDocumentHash = '',\n\t\t\t\t\tiframeId, iframe,\n\t\t\t\t\tlastIframeHash, checkerRunning;\n\n\t\t\t\t// Handle depending on the browser\n\t\t\t\tif ( History.isInternetExplorer() ) {\n\t\t\t\t\t// IE6 and IE7\n\t\t\t\t\t// We need to use an iframe to emulate the back and forward buttons\n\n\t\t\t\t\t// Create iFrame\n\t\t\t\t\tiframeId = 'historyjs-iframe';\n\t\t\t\t\tiframe = document.createElement('iframe');\n\n\t\t\t\t\t// Adjust iFarme\n\t\t\t\t\tiframe.setAttribute('id', iframeId);\n\t\t\t\t\tiframe.style.display = 'none';\n\n\t\t\t\t\t// Append iFrame\n\t\t\t\t\tdocument.body.appendChild(iframe);\n\n\t\t\t\t\t// Create initial history entry\n\t\t\t\t\tiframe.contentWindow.document.open();\n\t\t\t\t\tiframe.contentWindow.document.close();\n\n\t\t\t\t\t// Define some variables that will help in our checker function\n\t\t\t\t\tlastIframeHash = '';\n\t\t\t\t\tcheckerRunning = false;\n\n\t\t\t\t\t// Define the checker function\n\t\t\t\t\tHistory.checkerFunction = function(){\n\t\t\t\t\t\t// Check Running\n\t\t\t\t\t\tif ( checkerRunning ) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Update Running\n\t\t\t\t\t\tcheckerRunning = true;\n\n\t\t\t\t\t\t// Fetch\n\t\t\t\t\t\tvar documentHash = History.getHash()||'',\n\t\t\t\t\t\t\tiframeHash = History.unescapeHash(iframe.contentWindow.document.location.hash)||'';\n\n\t\t\t\t\t\t// The Document Hash has changed (application caused)\n\t\t\t\t\t\tif ( documentHash !== lastDocumentHash ) {\n\t\t\t\t\t\t\t// Equalise\n\t\t\t\t\t\t\tlastDocumentHash = documentHash;\n\n\t\t\t\t\t\t\t// Create a history entry in the iframe\n\t\t\t\t\t\t\tif ( iframeHash !== documentHash ) {\n\t\t\t\t\t\t\t\t//History.debug('hashchange.checker: iframe hash change', 'documentHash (new):', documentHash, 'iframeHash (old):', iframeHash);\n\n\t\t\t\t\t\t\t\t// Equalise\n\t\t\t\t\t\t\t\tlastIframeHash = iframeHash = documentHash;\n\n\t\t\t\t\t\t\t\t// Create History Entry\n\t\t\t\t\t\t\t\tiframe.contentWindow.document.open();\n\t\t\t\t\t\t\t\tiframe.contentWindow.document.close();\n\n\t\t\t\t\t\t\t\t// Update the iframe's hash\n\t\t\t\t\t\t\t\tiframe.contentWindow.document.location.hash = History.escapeHash(documentHash);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Trigger Hashchange Event\n\t\t\t\t\t\t\tHistory.Adapter.trigger(window,'hashchange');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// The iFrame Hash has changed (back button caused)\n\t\t\t\t\t\telse if ( iframeHash !== lastIframeHash ) {\n\t\t\t\t\t\t\t//History.debug('hashchange.checker: iframe hash out of sync', 'iframeHash (new):', iframeHash, 'documentHash (old):', documentHash);\n\n\t\t\t\t\t\t\t// Equalise\n\t\t\t\t\t\t\tlastIframeHash = iframeHash;\n\n\t\t\t\t\t\t\t// Update the Hash\n\t\t\t\t\t\t\tHistory.setHash(iframeHash,false);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Reset Running\n\t\t\t\t\t\tcheckerRunning = false;\n\n\t\t\t\t\t\t// Return true\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// We are not IE\n\t\t\t\t\t// Firefox 1 or 2, Opera\n\n\t\t\t\t\t// Define the checker function\n\t\t\t\t\tHistory.checkerFunction = function(){\n\t\t\t\t\t\t// Prepare\n\t\t\t\t\t\tvar documentHash = History.getHash();\n\n\t\t\t\t\t\t// The Document Hash has changed (application caused)\n\t\t\t\t\t\tif ( documentHash !== lastDocumentHash ) {\n\t\t\t\t\t\t\t// Equalise\n\t\t\t\t\t\t\tlastDocumentHash = documentHash;\n\n\t\t\t\t\t\t\t// Trigger Hashchange Event\n\t\t\t\t\t\t\tHistory.Adapter.trigger(window,'hashchange');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Return true\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Apply the checker function\n\t\t\t\tHistory.intervalList.push(setInterval(History.checkerFunction, History.options.hashChangeInterval));\n\n\t\t\t\t// Done\n\t\t\t\treturn true;\n\t\t\t}; // History.hashChangeInit\n\n\t\t\t// Bind hashChangeInit\n\t\t\tHistory.Adapter.onDomLoad(History.hashChangeInit);\n\n\t\t} // History.emulated.hashChange\n\n\n\t\t// ====================================================================\n\t\t// HTML5 State Support\n\n\t\t// Non-Native pushState Implementation\n\t\tif ( History.emulated.pushState ) {\n\t\t\t/*\n\t\t\t * We must emulate the HTML5 State Management by using HTML4 HashChange\n\t\t\t */\n\n\t\t\t/**\n\t\t\t * History.onHashChange(event)\n\t\t\t * Trigger HTML5's window.onpopstate via HTML4 HashChange Support\n\t\t\t */\n\t\t\tHistory.onHashChange = function(event){\n\t\t\t\t//History.debug('History.onHashChange', arguments);\n\n\t\t\t\t// Prepare\n\t\t\t\tvar currentUrl = ((event && event.newURL) || document.location.href),\n\t\t\t\t\tcurrentHash = History.getHashByUrl(currentUrl),\n\t\t\t\t\tcurrentState = null,\n\t\t\t\t\tcurrentStateHash = null,\n\t\t\t\t\tcurrentStateHashExits = null,\n\t\t\t\t\tdiscardObject;\n\n\t\t\t\t// Check if we are the same state\n\t\t\t\tif ( History.isLastHash(currentHash) ) {\n\t\t\t\t\t// There has been no change (just the page's hash has finally propagated)\n\t\t\t\t\t//History.debug('History.onHashChange: no change');\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Reset the double check\n\t\t\t\tHistory.doubleCheckComplete();\n\n\t\t\t\t// Store our location for use in detecting back/forward direction\n\t\t\t\tHistory.saveHash(currentHash);\n\n\t\t\t\t// Expand Hash\n\t\t\t\tif ( currentHash && History.isTraditionalAnchor(currentHash) ) {\n\t\t\t\t\t//History.debug('History.onHashChange: traditional anchor', currentHash);\n\t\t\t\t\t// Traditional Anchor Hash\n\t\t\t\t\tHistory.Adapter.trigger(window,'anchorchange');\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Create State\n\t\t\t\tcurrentState = History.extractState(History.getFullUrl(currentHash||document.location.href,false),true);\n\n\t\t\t\t// Check if we are the same state\n\t\t\t\tif ( History.isLastSavedState(currentState) ) {\n\t\t\t\t\t//History.debug('History.onHashChange: no change');\n\t\t\t\t\t// There has been no change (just the page's hash has finally propagated)\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Create the state Hash\n\t\t\t\tcurrentStateHash = History.getHashByState(currentState);\n\n\t\t\t\t// Check if we are DiscardedState\n\t\t\t\tdiscardObject = History.discardedState(currentState);\n\t\t\t\tif ( discardObject ) {\n\t\t\t\t\t// Ignore this state as it has been discarded and go back to the state before it\n\t\t\t\t\tif ( History.getHashByIndex(-2) === History.getHashByState(discardObject.forwardState) ) {\n\t\t\t\t\t\t// We are going backwards\n\t\t\t\t\t\t//History.debug('History.onHashChange: go backwards');\n\t\t\t\t\t\tHistory.back(false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We are going forwards\n\t\t\t\t\t\t//History.debug('History.onHashChange: go forwards');\n\t\t\t\t\t\tHistory.forward(false);\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Push the new HTML5 State\n\t\t\t\t//History.debug('History.onHashChange: success hashchange');\n\t\t\t\tHistory.pushState(currentState.data,currentState.title,currentState.url,false);\n\n\t\t\t\t// End onHashChange closure\n\t\t\t\treturn true;\n\t\t\t};\n\t\t\tHistory.Adapter.bind(window,'hashchange',History.onHashChange);\n\n\t\t\t/**\n\t\t\t * History.pushState(data,title,url)\n\t\t\t * Add a new State to the history object, become it, and trigger onpopstate\n\t\t\t * We have to trigger for HTML4 compatibility\n\t\t\t * @param {object} data\n\t\t\t * @param {string} title\n\t\t\t * @param {string} url\n\t\t\t * @return {true}\n\t\t\t */\n\t\t\tHistory.pushState = function(data,title,url,queue){\n\t\t\t\t//History.debug('History.pushState: called', arguments);\n\n\t\t\t\t// Check the State\n\t\t\t\tif ( History.getHashByUrl(url) ) {\n\t\t\t\t\tthrow new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');\n\t\t\t\t}\n\n\t\t\t\t// Handle Queueing\n\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t//History.debug('History.pushState: we must wait', arguments);\n\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\tcallback: History.pushState,\n\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Make Busy\n\t\t\t\tHistory.busy(true);\n\n\t\t\t\t// Fetch the State Object\n\t\t\t\tvar newState = History.createStateObject(data,title,url),\n\t\t\t\t\tnewStateHash = History.getHashByState(newState),\n\t\t\t\t\toldState = History.getState(false),\n\t\t\t\t\toldStateHash = History.getHashByState(oldState),\n\t\t\t\t\thtml4Hash = History.getHash();\n\n\t\t\t\t// Store the newState\n\t\t\t\tHistory.storeState(newState);\n\t\t\t\tHistory.expectedStateId = newState.id;\n\n\t\t\t\t// Recycle the State\n\t\t\t\tHistory.recycleState(newState);\n\n\t\t\t\t// Force update of the title\n\t\t\t\tHistory.setTitle(newState);\n\n\t\t\t\t// Check if we are the same State\n\t\t\t\tif ( newStateHash === oldStateHash ) {\n\t\t\t\t\t//History.debug('History.pushState: no change', newStateHash);\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Update HTML4 Hash\n\t\t\t\tif ( newStateHash !== html4Hash && newStateHash !== History.getShortUrl(document.location.href) ) {\n\t\t\t\t\t//History.debug('History.pushState: update hash', newStateHash, html4Hash);\n\t\t\t\t\tHistory.setHash(newStateHash,false);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Update HTML5 State\n\t\t\t\tHistory.saveState(newState);\n\n\t\t\t\t// Fire HTML5 Event\n\t\t\t\t//History.debug('History.pushState: trigger popstate');\n\t\t\t\tHistory.Adapter.trigger(window,'statechange');\n\t\t\t\tHistory.busy(false);\n\n\t\t\t\t// End pushState closure\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.replaceState(data,title,url)\n\t\t\t * Replace the State and trigger onpopstate\n\t\t\t * We have to trigger for HTML4 compatibility\n\t\t\t * @param {object} data\n\t\t\t * @param {string} title\n\t\t\t * @param {string} url\n\t\t\t * @return {true}\n\t\t\t */\n\t\t\tHistory.replaceState = function(data,title,url,queue){\n\t\t\t\t//History.debug('History.replaceState: called', arguments);\n\n\t\t\t\t// Check the State\n\t\t\t\tif ( History.getHashByUrl(url) ) {\n\t\t\t\t\tthrow new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');\n\t\t\t\t}\n\n\t\t\t\t// Handle Queueing\n\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t//History.debug('History.replaceState: we must wait', arguments);\n\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\tcallback: History.replaceState,\n\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Make Busy\n\t\t\t\tHistory.busy(true);\n\n\t\t\t\t// Fetch the State Objects\n\t\t\t\tvar newState        = History.createStateObject(data,title,url),\n\t\t\t\t\toldState        = History.getState(false),\n\t\t\t\t\tpreviousState   = History.getStateByIndex(-2);\n\n\t\t\t\t// Discard Old State\n\t\t\t\tHistory.discardState(oldState,newState,previousState);\n\n\t\t\t\t// Alias to PushState\n\t\t\t\tHistory.pushState(newState.data,newState.title,newState.url,false);\n\n\t\t\t\t// End replaceState closure\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t} // History.emulated.pushState\n\n\n\n\t\t// ====================================================================\n\t\t// Initialise\n\n\t\t// Non-Native pushState Implementation\n\t\tif ( History.emulated.pushState ) {\n\t\t\t/**\n\t\t\t * Ensure initial state is handled correctly\n\t\t\t */\n\t\t\tif ( History.getHash() && !History.emulated.hashChange ) {\n\t\t\t\tHistory.Adapter.onDomLoad(function(){\n\t\t\t\t\tHistory.Adapter.trigger(window,'hashchange');\n\t\t\t\t});\n\t\t\t}\n\n\t\t} // History.emulated.pushState\n\n\t}; // History.initHtml4\n\n\t// Try and Initialise History\n\tif ( typeof History.init !== 'undefined' ) {\n\t\tHistory.init();\n\t}\n\n})(window);\n","/**\n * History.js Core\n * @author Benjamin Arthur Lupton <contact@balupton.com>\n * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>\n * @license New BSD License <http://creativecommons.org/licenses/BSD/>\n */\n\n(function(window,undefined){\n\t\"use strict\";\n\n\t// ========================================================================\n\t// Initialise\n\n\t// Localise Globals\n\tvar\n\t\tconsole = window.console||undefined, // Prevent a JSLint complain\n\t\tdocument = window.document, // Make sure we are using the correct document\n\t\tnavigator = window.navigator, // Make sure we are using the correct navigator\n\t\tsessionStorage = window.sessionStorage||false, // sessionStorage\n\t\tsetTimeout = window.setTimeout,\n\t\tclearTimeout = window.clearTimeout,\n\t\tsetInterval = window.setInterval,\n\t\tclearInterval = window.clearInterval,\n\t\tJSON = window.JSON,\n\t\talert = window.alert,\n\t\tHistory = window.History = window.History||{}, // Public History Object\n\t\thistory = window.history; // Old History Object\n\n\t// MooTools Compatibility\n\tJSON.stringify = JSON.stringify||JSON.encode;\n\tJSON.parse = JSON.parse||JSON.decode;\n\n\t// Check Existence\n\tif ( typeof History.init !== 'undefined' ) {\n\t\tthrow new Error('History.js Core has already been loaded...');\n\t}\n\n\t// Initialise History\n\tHistory.init = function(){\n\t\t// Check Load Status of Adapter\n\t\tif ( typeof History.Adapter === 'undefined' ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check Load Status of Core\n\t\tif ( typeof History.initCore !== 'undefined' ) {\n\t\t\tHistory.initCore();\n\t\t}\n\n\t\t// Check Load Status of HTML4 Support\n\t\tif ( typeof History.initHtml4 !== 'undefined' ) {\n\t\t\tHistory.initHtml4();\n\t\t}\n\n\t\t// Return true\n\t\treturn true;\n\t};\n\n\n\t// ========================================================================\n\t// Initialise Core\n\n\t// Initialise Core\n\tHistory.initCore = function(){\n\t\t// Initialise\n\t\tif ( typeof History.initCore.initialized !== 'undefined' ) {\n\t\t\t// Already Loaded\n\t\t\treturn false;\n\t\t}\n\t\telse {\n\t\t\tHistory.initCore.initialized = true;\n\t\t}\n\n\n\t\t// ====================================================================\n\t\t// Options\n\n\t\t/**\n\t\t * History.options\n\t\t * Configurable options\n\t\t */\n\t\tHistory.options = History.options||{};\n\n\t\t/**\n\t\t * History.options.hashChangeInterval\n\t\t * How long should the interval be before hashchange checks\n\t\t */\n\t\tHistory.options.hashChangeInterval = History.options.hashChangeInterval || 100;\n\n\t\t/**\n\t\t * History.options.safariPollInterval\n\t\t * How long should the interval be before safari poll checks\n\t\t */\n\t\tHistory.options.safariPollInterval = History.options.safariPollInterval || 500;\n\n\t\t/**\n\t\t * History.options.doubleCheckInterval\n\t\t * How long should the interval be before we perform a double check\n\t\t */\n\t\tHistory.options.doubleCheckInterval = History.options.doubleCheckInterval || 500;\n\n\t\t/**\n\t\t * History.options.storeInterval\n\t\t * How long should we wait between store calls\n\t\t */\n\t\tHistory.options.storeInterval = History.options.storeInterval || 1000;\n\n\t\t/**\n\t\t * History.options.busyDelay\n\t\t * How long should we wait between busy events\n\t\t */\n\t\tHistory.options.busyDelay = History.options.busyDelay || 250;\n\n\t\t/**\n\t\t * History.options.debug\n\t\t * If true will enable debug messages to be logged\n\t\t */\n\t\tHistory.options.debug = History.options.debug || false;\n\n\t\t/**\n\t\t * History.options.initialTitle\n\t\t * What is the title of the initial state\n\t\t */\n\t\tHistory.options.initialTitle = History.options.initialTitle || document.title;\n\n\n\t\t// ====================================================================\n\t\t// Interval record\n\n\t\t/**\n\t\t * History.intervalList\n\t\t * List of intervals set, to be cleared when document is unloaded.\n\t\t */\n\t\tHistory.intervalList = [];\n\n\t\t/**\n\t\t * History.clearAllIntervals\n\t\t * Clears all setInterval instances.\n\t\t */\n\t\tHistory.clearAllIntervals = function(){\n\t\t\tvar i, il = History.intervalList;\n\t\t\tif (typeof il !== \"undefined\" && il !== null) {\n\t\t\t\tfor (i = 0; i < il.length; i++) {\n\t\t\t\t\tclearInterval(il[i]);\n\t\t\t\t}\n\t\t\t\tHistory.intervalList = null;\n\t\t\t}\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// Debug\n\n\t\t/**\n\t\t * History.debug(message,...)\n\t\t * Logs the passed arguments if debug enabled\n\t\t */\n\t\tHistory.debug = function(){\n\t\t\tif ( (History.options.debug||false) ) {\n\t\t\t\tHistory.log.apply(History,arguments);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * History.log(message,...)\n\t\t * Logs the passed arguments\n\t\t */\n\t\tHistory.log = function(){\n\t\t\t// Prepare\n\t\t\tvar\n\t\t\t\tconsoleExists = !(typeof console === 'undefined' || typeof console.log === 'undefined' || typeof console.log.apply === 'undefined'),\n\t\t\t\ttextarea = document.getElementById('log'),\n\t\t\t\tmessage,\n\t\t\t\ti,n,\n\t\t\t\targs,arg\n\t\t\t\t;\n\n\t\t\t// Write to Console\n\t\t\tif ( consoleExists ) {\n\t\t\t\targs = Array.prototype.slice.call(arguments);\n\t\t\t\tmessage = args.shift();\n\t\t\t\tif ( typeof console.debug !== 'undefined' ) {\n\t\t\t\t\tconsole.debug.apply(console,[message,args]);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.log.apply(console,[message,args]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmessage = (\"\\n\"+arguments[0]+\"\\n\");\n\t\t\t}\n\n\t\t\t// Write to log\n\t\t\tfor ( i=1,n=arguments.length; i<n; ++i ) {\n\t\t\t\targ = arguments[i];\n\t\t\t\tif ( typeof arg === 'object' && typeof JSON !== 'undefined' ) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\targ = JSON.stringify(arg);\n\t\t\t\t\t}\n\t\t\t\t\tcatch ( Exception ) {\n\t\t\t\t\t\t// Recursive Object\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tmessage += \"\\n\"+arg+\"\\n\";\n\t\t\t}\n\n\t\t\t// Textarea\n\t\t\tif ( textarea ) {\n\t\t\t\ttextarea.value += message+\"\\n-----\\n\";\n\t\t\t\ttextarea.scrollTop = textarea.scrollHeight - textarea.clientHeight;\n\t\t\t}\n\t\t\t// No Textarea, No Console\n\t\t\telse if ( !consoleExists ) {\n\t\t\t\talert(message);\n\t\t\t}\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// Emulated Status\n\n\t\t/**\n\t\t * History.getInternetExplorerMajorVersion()\n\t\t * Get's the major version of Internet Explorer\n\t\t * @return {integer}\n\t\t * @license Public Domain\n\t\t * @author Benjamin Arthur Lupton <contact@balupton.com>\n\t\t * @author James Padolsey <https://gist.github.com/527683>\n\t\t */\n\t\tHistory.getInternetExplorerMajorVersion = function(){\n\t\t\tvar result = History.getInternetExplorerMajorVersion.cached =\n\t\t\t\t\t(typeof History.getInternetExplorerMajorVersion.cached !== 'undefined')\n\t\t\t\t?\tHistory.getInternetExplorerMajorVersion.cached\n\t\t\t\t:\t(function(){\n\t\t\t\t\t\tvar v = 3,\n\t\t\t\t\t\t\t\tdiv = document.createElement('div'),\n\t\t\t\t\t\t\t\tall = div.getElementsByTagName('i');\n\t\t\t\t\t\twhile ( (div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->') && all[0] ) {}\n\t\t\t\t\t\treturn (v > 4) ? v : false;\n\t\t\t\t\t})()\n\t\t\t\t;\n\t\t\treturn result;\n\t\t};\n\n\t\t/**\n\t\t * History.isInternetExplorer()\n\t\t * Are we using Internet Explorer?\n\t\t * @return {boolean}\n\t\t * @license Public Domain\n\t\t * @author Benjamin Arthur Lupton <contact@balupton.com>\n\t\t */\n\t\tHistory.isInternetExplorer = function(){\n\t\t\tvar result =\n\t\t\t\tHistory.isInternetExplorer.cached =\n\t\t\t\t(typeof History.isInternetExplorer.cached !== 'undefined')\n\t\t\t\t\t?\tHistory.isInternetExplorer.cached\n\t\t\t\t\t:\tBoolean(History.getInternetExplorerMajorVersion())\n\t\t\t\t;\n\t\t\treturn result;\n\t\t};\n\n\t\t/**\n\t\t * History.emulated\n\t\t * Which features require emulating?\n\t\t */\n\t\tHistory.emulated = {\n\t\t\tpushState: !Boolean(\n\t\t\t\twindow.history && window.history.pushState && window.history.replaceState\n\t\t\t\t&& !(\n\t\t\t\t\t(/ Mobile\\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(navigator.userAgent) /* disable for versions of iOS before version 4.3 (8F190) */\n\t\t\t\t\t|| (/AppleWebKit\\/5([0-2]|3[0-2])/i).test(navigator.userAgent) /* disable for the mercury iOS browser, or at least older versions of the webkit engine */\n\t\t\t\t)\n\t\t\t),\n\t\t\thashChange: Boolean(\n\t\t\t\t!(('onhashchange' in window) || ('onhashchange' in document))\n\t\t\t\t||\n\t\t\t\t(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8)\n\t\t\t)\n\t\t};\n\n\t\t/**\n\t\t * History.enabled\n\t\t * Is History enabled?\n\t\t */\n\t\tHistory.enabled = !History.emulated.pushState;\n\n\t\t/**\n\t\t * History.bugs\n\t\t * Which bugs are present\n\t\t */\n\t\tHistory.bugs = {\n\t\t\t/**\n\t\t\t * Safari 5 and Safari iOS 4 fail to return to the correct state once a hash is replaced by a `replaceState` call\n\t\t\t * https://bugs.webkit.org/show_bug.cgi?id=56249\n\t\t\t */\n\t\t\tsetHash: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\\/5([0-2]|3[0-3])/.test(navigator.userAgent)),\n\n\t\t\t/**\n\t\t\t * Safari 5 and Safari iOS 4 sometimes fail to apply the state change under busy conditions\n\t\t\t * https://bugs.webkit.org/show_bug.cgi?id=42940\n\t\t\t */\n\t\t\tsafariPoll: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\\/5([0-2]|3[0-3])/.test(navigator.userAgent)),\n\n\t\t\t/**\n\t\t\t * MSIE 6 and 7 sometimes do not apply a hash even it was told to (requiring a second call to the apply function)\n\t\t\t */\n\t\t\tieDoubleCheck: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8),\n\n\t\t\t/**\n\t\t\t * MSIE 6 requires the entire hash to be encoded for the hashes to trigger the onHashChange event\n\t\t\t */\n\t\t\thashEscape: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 7)\n\t\t};\n\n\t\t/**\n\t\t * History.isEmptyObject(obj)\n\t\t * Checks to see if the Object is Empty\n\t\t * @param {Object} obj\n\t\t * @return {boolean}\n\t\t */\n\t\tHistory.isEmptyObject = function(obj) {\n\t\t\tfor ( var name in obj ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.cloneObject(obj)\n\t\t * Clones a object and eliminate all references to the original contexts\n\t\t * @param {Object} obj\n\t\t * @return {Object}\n\t\t */\n\t\tHistory.cloneObject = function(obj) {\n\t\t\tvar hash,newObj;\n\t\t\tif ( obj ) {\n\t\t\t\thash = JSON.stringify(obj);\n\t\t\t\tnewObj = JSON.parse(hash);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tnewObj = {};\n\t\t\t}\n\t\t\treturn newObj;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// URL Helpers\n\n\t\t/**\n\t\t * History.getRootUrl()\n\t\t * Turns \"http://mysite.com/dir/page.html?asd\" into \"http://mysite.com\"\n\t\t * @return {String} rootUrl\n\t\t */\n\t\tHistory.getRootUrl = function(){\n\t\t\t// Create\n\t\t\tvar rootUrl = document.location.protocol+'//'+(document.location.hostname||document.location.host);\n\t\t\tif ( document.location.port||false ) {\n\t\t\t\trootUrl += ':'+document.location.port;\n\t\t\t}\n\t\t\trootUrl += '/';\n\n\t\t\t// Return\n\t\t\treturn rootUrl;\n\t\t};\n\n\t\t/**\n\t\t * History.getBaseHref()\n\t\t * Fetches the `href` attribute of the `<base href=\"...\">` element if it exists\n\t\t * @return {String} baseHref\n\t\t */\n\t\tHistory.getBaseHref = function(){\n\t\t\t// Create\n\t\t\tvar\n\t\t\t\tbaseElements = document.getElementsByTagName('base'),\n\t\t\t\tbaseElement = null,\n\t\t\t\tbaseHref = '';\n\n\t\t\t// Test for Base Element\n\t\t\tif ( baseElements.length === 1 ) {\n\t\t\t\t// Prepare for Base Element\n\t\t\t\tbaseElement = baseElements[0];\n\t\t\t\tbaseHref = baseElement.href.replace(/[^\\/]+$/,'');\n\t\t\t}\n\n\t\t\t// Adjust trailing slash\n\t\t\tbaseHref = baseHref.replace(/\\/+$/,'');\n\t\t\tif ( baseHref ) baseHref += '/';\n\n\t\t\t// Return\n\t\t\treturn baseHref;\n\t\t};\n\n\t\t/**\n\t\t * History.getBaseUrl()\n\t\t * Fetches the baseHref or basePageUrl or rootUrl (whichever one exists first)\n\t\t * @return {String} baseUrl\n\t\t */\n\t\tHistory.getBaseUrl = function(){\n\t\t\t// Create\n\t\t\tvar baseUrl = History.getBaseHref()||History.getBasePageUrl()||History.getRootUrl();\n\n\t\t\t// Return\n\t\t\treturn baseUrl;\n\t\t};\n\n\t\t/**\n\t\t * History.getPageUrl()\n\t\t * Fetches the URL of the current page\n\t\t * @return {String} pageUrl\n\t\t */\n\t\tHistory.getPageUrl = function(){\n\t\t\t// Fetch\n\t\t\tvar\n\t\t\t\tState = History.getState(false,false),\n\t\t\t\tstateUrl = (State||{}).url||document.location.href,\n\t\t\t\tpageUrl;\n\n\t\t\t// Create\n\t\t\tpageUrl = stateUrl.replace(/\\/+$/,'').replace(/[^\\/]+$/,function(part,index,string){\n\t\t\t\treturn (/\\./).test(part) ? part : part+'/';\n\t\t\t});\n\n\t\t\t// Return\n\t\t\treturn pageUrl;\n\t\t};\n\n\t\t/**\n\t\t * History.getBasePageUrl()\n\t\t * Fetches the Url of the directory of the current page\n\t\t * @return {String} basePageUrl\n\t\t */\n\t\tHistory.getBasePageUrl = function(){\n\t\t\t// Create\n\t\t\tvar basePageUrl = document.location.href.replace(/[#\\?].*/,'').replace(/[^\\/]+$/,function(part,index,string){\n\t\t\t\treturn (/[^\\/]$/).test(part) ? '' : part;\n\t\t\t}).replace(/\\/+$/,'')+'/';\n\n\t\t\t// Return\n\t\t\treturn basePageUrl;\n\t\t};\n\n\t\t/**\n\t\t * History.getFullUrl(url)\n\t\t * Ensures that we have an absolute URL and not a relative URL\n\t\t * @param {string} url\n\t\t * @param {Boolean} allowBaseHref\n\t\t * @return {string} fullUrl\n\t\t */\n\t\tHistory.getFullUrl = function(url,allowBaseHref){\n\t\t\t// Prepare\n\t\t\tvar fullUrl = url, firstChar = url.substring(0,1);\n\t\t\tallowBaseHref = (typeof allowBaseHref === 'undefined') ? true : allowBaseHref;\n\n\t\t\t// Check\n\t\t\tif ( /[a-z]+\\:\\/\\//.test(url) ) {\n\t\t\t\t// Full URL\n\t\t\t}\n\t\t\telse if ( firstChar === '/' ) {\n\t\t\t\t// Root URL\n\t\t\t\tfullUrl = History.getRootUrl()+url.replace(/^\\/+/,'');\n\t\t\t}\n\t\t\telse if ( firstChar === '#' ) {\n\t\t\t\t// Anchor URL\n\t\t\t\tfullUrl = History.getPageUrl().replace(/#.*/,'')+url;\n\t\t\t}\n\t\t\telse if ( firstChar === '?' ) {\n\t\t\t\t// Query URL\n\t\t\t\tfullUrl = History.getPageUrl().replace(/[\\?#].*/,'')+url;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Relative URL\n\t\t\t\tif ( allowBaseHref ) {\n\t\t\t\t\tfullUrl = History.getBaseUrl()+url.replace(/^(\\.\\/)+/,'');\n\t\t\t\t} else {\n\t\t\t\t\tfullUrl = History.getBasePageUrl()+url.replace(/^(\\.\\/)+/,'');\n\t\t\t\t}\n\t\t\t\t// We have an if condition above as we do not want hashes\n\t\t\t\t// which are relative to the baseHref in our URLs\n\t\t\t\t// as if the baseHref changes, then all our bookmarks\n\t\t\t\t// would now point to different locations\n\t\t\t\t// whereas the basePageUrl will always stay the same\n\t\t\t}\n\n\t\t\t// Return\n\t\t\treturn fullUrl.replace(/\\#$/,'');\n\t\t};\n\n\t\t/**\n\t\t * History.getShortUrl(url)\n\t\t * Ensures that we have a relative URL and not a absolute URL\n\t\t * @param {string} url\n\t\t * @return {string} url\n\t\t */\n\t\tHistory.getShortUrl = function(url){\n\t\t\t// Prepare\n\t\t\tvar shortUrl = url, baseUrl = History.getBaseUrl(), rootUrl = History.getRootUrl();\n\n\t\t\t// Trim baseUrl\n\t\t\tif ( History.emulated.pushState ) {\n\t\t\t\t// We are in a if statement as when pushState is not emulated\n\t\t\t\t// The actual url these short urls are relative to can change\n\t\t\t\t// So within the same session, we the url may end up somewhere different\n\t\t\t\tshortUrl = shortUrl.replace(baseUrl,'');\n\t\t\t}\n\n\t\t\t// Trim rootUrl\n\t\t\tshortUrl = shortUrl.replace(rootUrl,'/');\n\n\t\t\t// Ensure we can still detect it as a state\n\t\t\tif ( History.isTraditionalAnchor(shortUrl) ) {\n\t\t\t\tshortUrl = './'+shortUrl;\n\t\t\t}\n\n\t\t\t// Clean It\n\t\t\tshortUrl = shortUrl.replace(/^(\\.\\/)+/g,'./').replace(/\\#$/,'');\n\n\t\t\t// Return\n\t\t\treturn shortUrl;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// State Storage\n\n\t\t/**\n\t\t * History.store\n\t\t * The store for all session specific data\n\t\t */\n\t\tHistory.store = {};\n\n\t\t/**\n\t\t * History.idToState\n\t\t * 1-1: State ID to State Object\n\t\t */\n\t\tHistory.idToState = History.idToState||{};\n\n\t\t/**\n\t\t * History.stateToId\n\t\t * 1-1: State String to State ID\n\t\t */\n\t\tHistory.stateToId = History.stateToId||{};\n\n\t\t/**\n\t\t * History.urlToId\n\t\t * 1-1: State URL to State ID\n\t\t */\n\t\tHistory.urlToId = History.urlToId||{};\n\n\t\t/**\n\t\t * History.storedStates\n\t\t * Store the states in an array\n\t\t */\n\t\tHistory.storedStates = History.storedStates||[];\n\n\t\t/**\n\t\t * History.savedStates\n\t\t * Saved the states in an array\n\t\t */\n\t\tHistory.savedStates = History.savedStates||[];\n\n\t\t/**\n\t\t * History.noramlizeStore()\n\t\t * Noramlize the store by adding necessary values\n\t\t */\n\t\tHistory.normalizeStore = function(){\n\t\t\tHistory.store.idToState = History.store.idToState||{};\n\t\t\tHistory.store.urlToId = History.store.urlToId||{};\n\t\t\tHistory.store.stateToId = History.store.stateToId||{};\n\t\t};\n\n\t\t/**\n\t\t * History.getState()\n\t\t * Get an object containing the data, title and url of the current state\n\t\t * @param {Boolean} friendly\n\t\t * @param {Boolean} create\n\t\t * @return {Object} State\n\t\t */\n\t\tHistory.getState = function(friendly,create){\n\t\t\t// Prepare\n\t\t\tif ( typeof friendly === 'undefined' ) { friendly = true; }\n\t\t\tif ( typeof create === 'undefined' ) { create = true; }\n\n\t\t\t// Fetch\n\t\t\tvar State = History.getLastSavedState();\n\n\t\t\t// Create\n\t\t\tif ( !State && create ) {\n\t\t\t\tState = History.createStateObject();\n\t\t\t}\n\n\t\t\t// Adjust\n\t\t\tif ( friendly ) {\n\t\t\t\tState = History.cloneObject(State);\n\t\t\t\tState.url = State.cleanUrl||State.url;\n\t\t\t}\n\n\t\t\t// Return\n\t\t\treturn State;\n\t\t};\n\n\t\t/**\n\t\t * History.getIdByState(State)\n\t\t * Gets a ID for a State\n\t\t * @param {State} newState\n\t\t * @return {String} id\n\t\t */\n\t\tHistory.getIdByState = function(newState){\n\n\t\t\t// Fetch ID\n\t\t\tvar id = History.extractId(newState.url),\n\t\t\t\tstr;\n\t\t\t\n\t\t\tif ( !id ) {\n\t\t\t\t// Find ID via State String\n\t\t\t\tstr = History.getStateString(newState);\n\t\t\t\tif ( typeof History.stateToId[str] !== 'undefined' ) {\n\t\t\t\t\tid = History.stateToId[str];\n\t\t\t\t}\n\t\t\t\telse if ( typeof History.store.stateToId[str] !== 'undefined' ) {\n\t\t\t\t\tid = History.store.stateToId[str];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Generate a new ID\n\t\t\t\t\twhile ( true ) {\n\t\t\t\t\t\tid = (new Date()).getTime() + String(Math.random()).replace(/\\D/g,'');\n\t\t\t\t\t\tif ( typeof History.idToState[id] === 'undefined' && typeof History.store.idToState[id] === 'undefined' ) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Apply the new State to the ID\n\t\t\t\t\tHistory.stateToId[str] = id;\n\t\t\t\t\tHistory.idToState[id] = newState;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Return ID\n\t\t\treturn id;\n\t\t};\n\n\t\t/**\n\t\t * History.normalizeState(State)\n\t\t * Expands a State Object\n\t\t * @param {object} State\n\t\t * @return {object}\n\t\t */\n\t\tHistory.normalizeState = function(oldState){\n\t\t\t// Variables\n\t\t\tvar newState, dataNotEmpty;\n\n\t\t\t// Prepare\n\t\t\tif ( !oldState || (typeof oldState !== 'object') ) {\n\t\t\t\toldState = {};\n\t\t\t}\n\n\t\t\t// Check\n\t\t\tif ( typeof oldState.normalized !== 'undefined' ) {\n\t\t\t\treturn oldState;\n\t\t\t}\n\n\t\t\t// Adjust\n\t\t\tif ( !oldState.data || (typeof oldState.data !== 'object') ) {\n\t\t\t\toldState.data = {};\n\t\t\t}\n\n\t\t\t// ----------------------------------------------------------------\n\n\t\t\t// Create\n\t\t\tnewState = {};\n\t\t\tnewState.normalized = true;\n\t\t\tnewState.title = oldState.title||'';\n\t\t\tnewState.url = History.getFullUrl(History.unescapeString(oldState.url||document.location.href));\n\t\t\tnewState.hash = History.getShortUrl(newState.url);\n\t\t\tnewState.data = History.cloneObject(oldState.data);\n\n\t\t\t// Fetch ID\n\t\t\tnewState.id = History.getIdByState(newState);\n\n\t\t\t// ----------------------------------------------------------------\n\n\t\t\t// Clean the URL\n\t\t\tnewState.cleanUrl = newState.url.replace(/\\??\\&_suid.*/,'');\n\t\t\tnewState.url = newState.cleanUrl;\n\n\t\t\t// Check to see if we have more than just a url\n\t\t\tdataNotEmpty = !History.isEmptyObject(newState.data);\n\n\t\t\t// Apply\n\t\t\tif ( newState.title || dataNotEmpty ) {\n\t\t\t\t// Add ID to Hash\n\t\t\t\tnewState.hash = History.getShortUrl(newState.url).replace(/\\??\\&_suid.*/,'');\n\t\t\t\tif ( !/\\?/.test(newState.hash) ) {\n\t\t\t\t\tnewState.hash += '?';\n\t\t\t\t}\n\t\t\t\tnewState.hash += '&_suid='+newState.id;\n\t\t\t}\n\n\t\t\t// Create the Hashed URL\n\t\t\tnewState.hashedUrl = History.getFullUrl(newState.hash);\n\n\t\t\t// ----------------------------------------------------------------\n\n\t\t\t// Update the URL if we have a duplicate\n\t\t\tif ( (History.emulated.pushState || History.bugs.safariPoll) && History.hasUrlDuplicate(newState) ) {\n\t\t\t\tnewState.url = newState.hashedUrl;\n\t\t\t}\n\n\t\t\t// ----------------------------------------------------------------\n\n\t\t\t// Return\n\t\t\treturn newState;\n\t\t};\n\n\t\t/**\n\t\t * History.createStateObject(data,title,url)\n\t\t * Creates a object based on the data, title and url state params\n\t\t * @param {object} data\n\t\t * @param {string} title\n\t\t * @param {string} url\n\t\t * @return {object}\n\t\t */\n\t\tHistory.createStateObject = function(data,title,url){\n\t\t\t// Hashify\n\t\t\tvar State = {\n\t\t\t\t'data': data,\n\t\t\t\t'title': title,\n\t\t\t\t'url': url\n\t\t\t};\n\n\t\t\t// Expand the State\n\t\t\tState = History.normalizeState(State);\n\n\t\t\t// Return object\n\t\t\treturn State;\n\t\t};\n\n\t\t/**\n\t\t * History.getStateById(id)\n\t\t * Get a state by it's UID\n\t\t * @param {String} id\n\t\t */\n\t\tHistory.getStateById = function(id){\n\t\t\t// Prepare\n\t\t\tid = String(id);\n\n\t\t\t// Retrieve\n\t\t\tvar State = History.idToState[id] || History.store.idToState[id] || undefined;\n\n\t\t\t// Return State\n\t\t\treturn State;\n\t\t};\n\n\t\t/**\n\t\t * Get a State's String\n\t\t * @param {State} passedState\n\t\t */\n\t\tHistory.getStateString = function(passedState){\n\t\t\t// Prepare\n\t\t\tvar State, cleanedState, str;\n\n\t\t\t// Fetch\n\t\t\tState = History.normalizeState(passedState);\n\n\t\t\t// Clean\n\t\t\tcleanedState = {\n\t\t\t\tdata: State.data,\n\t\t\t\ttitle: passedState.title,\n\t\t\t\turl: passedState.url\n\t\t\t};\n\n\t\t\t// Fetch\n\t\t\tstr = JSON.stringify(cleanedState);\n\n\t\t\t// Return\n\t\t\treturn str;\n\t\t};\n\n\t\t/**\n\t\t * Get a State's ID\n\t\t * @param {State} passedState\n\t\t * @return {String} id\n\t\t */\n\t\tHistory.getStateId = function(passedState){\n\t\t\t// Prepare\n\t\t\tvar State, id;\n\t\t\t\n\t\t\t// Fetch\n\t\t\tState = History.normalizeState(passedState);\n\n\t\t\t// Fetch\n\t\t\tid = State.id;\n\n\t\t\t// Return\n\t\t\treturn id;\n\t\t};\n\n\t\t/**\n\t\t * History.getHashByState(State)\n\t\t * Creates a Hash for the State Object\n\t\t * @param {State} passedState\n\t\t * @return {String} hash\n\t\t */\n\t\tHistory.getHashByState = function(passedState){\n\t\t\t// Prepare\n\t\t\tvar State, hash;\n\t\t\t\n\t\t\t// Fetch\n\t\t\tState = History.normalizeState(passedState);\n\n\t\t\t// Hash\n\t\t\thash = State.hash;\n\n\t\t\t// Return\n\t\t\treturn hash;\n\t\t};\n\n\t\t/**\n\t\t * History.extractId(url_or_hash)\n\t\t * Get a State ID by it's URL or Hash\n\t\t * @param {string} url_or_hash\n\t\t * @return {string} id\n\t\t */\n\t\tHistory.extractId = function ( url_or_hash ) {\n\t\t\t// Prepare\n\t\t\tvar id,parts,url;\n\n\t\t\t// Extract\n\t\t\tparts = /(.*)\\&_suid=([0-9]+)$/.exec(url_or_hash);\n\t\t\turl = parts ? (parts[1]||url_or_hash) : url_or_hash;\n\t\t\tid = parts ? String(parts[2]||'') : '';\n\n\t\t\t// Return\n\t\t\treturn id||false;\n\t\t};\n\n\t\t/**\n\t\t * History.isTraditionalAnchor\n\t\t * Checks to see if the url is a traditional anchor or not\n\t\t * @param {String} url_or_hash\n\t\t * @return {Boolean}\n\t\t */\n\t\tHistory.isTraditionalAnchor = function(url_or_hash){\n\t\t\t// Check\n\t\t\tvar isTraditional = !(/[\\/\\?\\.]/.test(url_or_hash));\n\n\t\t\t// Return\n\t\t\treturn isTraditional;\n\t\t};\n\n\t\t/**\n\t\t * History.extractState\n\t\t * Get a State by it's URL or Hash\n\t\t * @param {String} url_or_hash\n\t\t * @return {State|null}\n\t\t */\n\t\tHistory.extractState = function(url_or_hash,create){\n\t\t\t// Prepare\n\t\t\tvar State = null, id, url;\n\t\t\tcreate = create||false;\n\n\t\t\t// Fetch SUID\n\t\t\tid = History.extractId(url_or_hash);\n\t\t\tif ( id ) {\n\t\t\t\tState = History.getStateById(id);\n\t\t\t}\n\n\t\t\t// Fetch SUID returned no State\n\t\t\tif ( !State ) {\n\t\t\t\t// Fetch URL\n\t\t\t\turl = History.getFullUrl(url_or_hash);\n\n\t\t\t\t// Check URL\n\t\t\t\tid = History.getIdByUrl(url)||false;\n\t\t\t\tif ( id ) {\n\t\t\t\t\tState = History.getStateById(id);\n\t\t\t\t}\n\n\t\t\t\t// Create State\n\t\t\t\tif ( !State && create && !History.isTraditionalAnchor(url_or_hash) ) {\n\t\t\t\t\tState = History.createStateObject(null,null,url);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Return\n\t\t\treturn State;\n\t\t};\n\n\t\t/**\n\t\t * History.getIdByUrl()\n\t\t * Get a State ID by a State URL\n\t\t */\n\t\tHistory.getIdByUrl = function(url){\n\t\t\t// Fetch\n\t\t\tvar id = History.urlToId[url] || History.store.urlToId[url] || undefined;\n\n\t\t\t// Return\n\t\t\treturn id;\n\t\t};\n\n\t\t/**\n\t\t * History.getLastSavedState()\n\t\t * Get an object containing the data, title and url of the current state\n\t\t * @return {Object} State\n\t\t */\n\t\tHistory.getLastSavedState = function(){\n\t\t\treturn History.savedStates[History.savedStates.length-1]||undefined;\n\t\t};\n\n\t\t/**\n\t\t * History.getLastStoredState()\n\t\t * Get an object containing the data, title and url of the current state\n\t\t * @return {Object} State\n\t\t */\n\t\tHistory.getLastStoredState = function(){\n\t\t\treturn History.storedStates[History.storedStates.length-1]||undefined;\n\t\t};\n\n\t\t/**\n\t\t * History.hasUrlDuplicate\n\t\t * Checks if a Url will have a url conflict\n\t\t * @param {Object} newState\n\t\t * @return {Boolean} hasDuplicate\n\t\t */\n\t\tHistory.hasUrlDuplicate = function(newState) {\n\t\t\t// Prepare\n\t\t\tvar hasDuplicate = false,\n\t\t\t\toldState;\n\n\t\t\t// Fetch\n\t\t\toldState = History.extractState(newState.url);\n\n\t\t\t// Check\n\t\t\thasDuplicate = oldState && oldState.id !== newState.id;\n\n\t\t\t// Return\n\t\t\treturn hasDuplicate;\n\t\t};\n\n\t\t/**\n\t\t * History.storeState\n\t\t * Store a State\n\t\t * @param {Object} newState\n\t\t * @return {Object} newState\n\t\t */\n\t\tHistory.storeState = function(newState){\n\t\t\t// Store the State\n\t\t\tHistory.urlToId[newState.url] = newState.id;\n\n\t\t\t// Push the State\n\t\t\tHistory.storedStates.push(History.cloneObject(newState));\n\n\t\t\t// Return newState\n\t\t\treturn newState;\n\t\t};\n\n\t\t/**\n\t\t * History.isLastSavedState(newState)\n\t\t * Tests to see if the state is the last state\n\t\t * @param {Object} newState\n\t\t * @return {boolean} isLast\n\t\t */\n\t\tHistory.isLastSavedState = function(newState){\n\t\t\t// Prepare\n\t\t\tvar isLast = false,\n\t\t\t\tnewId, oldState, oldId;\n\n\t\t\t// Check\n\t\t\tif ( History.savedStates.length ) {\n\t\t\t\tnewId = newState.id;\n\t\t\t\toldState = History.getLastSavedState();\n\t\t\t\toldId = oldState.id;\n\n\t\t\t\t// Check\n\t\t\t\tisLast = (newId === oldId);\n\t\t\t}\n\n\t\t\t// Return\n\t\t\treturn isLast;\n\t\t};\n\n\t\t/**\n\t\t * History.saveState\n\t\t * Push a State\n\t\t * @param {Object} newState\n\t\t * @return {boolean} changed\n\t\t */\n\t\tHistory.saveState = function(newState){\n\t\t\t// Check Hash\n\t\t\tif ( History.isLastSavedState(newState) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Push the State\n\t\t\tHistory.savedStates.push(History.cloneObject(newState));\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.getStateByIndex()\n\t\t * Gets a state by the index\n\t\t * @param {integer} index\n\t\t * @return {Object}\n\t\t */\n\t\tHistory.getStateByIndex = function(index){\n\t\t\t// Prepare\n\t\t\tvar State = null;\n\n\t\t\t// Handle\n\t\t\tif ( typeof index === 'undefined' ) {\n\t\t\t\t// Get the last inserted\n\t\t\t\tState = History.savedStates[History.savedStates.length-1];\n\t\t\t}\n\t\t\telse if ( index < 0 ) {\n\t\t\t\t// Get from the end\n\t\t\t\tState = History.savedStates[History.savedStates.length+index];\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Get from the beginning\n\t\t\t\tState = History.savedStates[index];\n\t\t\t}\n\n\t\t\t// Return State\n\t\t\treturn State;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// Hash Helpers\n\n\t\t/**\n\t\t * History.getHash()\n\t\t * Gets the current document hash\n\t\t * @return {string}\n\t\t */\n\t\tHistory.getHash = function(){\n\t\t\tvar hash = History.unescapeHash(document.location.hash);\n\t\t\treturn hash;\n\t\t};\n\n\t\t/**\n\t\t * History.unescapeString()\n\t\t * Unescape a string\n\t\t * @param {String} str\n\t\t * @return {string}\n\t\t */\n\t\tHistory.unescapeString = function(str){\n\t\t\t// Prepare\n\t\t\tvar result = str,\n\t\t\t\ttmp;\n\n\t\t\t// Unescape hash\n\t\t\twhile ( true ) {\n\t\t\t\ttmp = window.unescape(result);\n\t\t\t\tif ( tmp === result ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tresult = tmp;\n\t\t\t}\n\n\t\t\t// Return result\n\t\t\treturn result;\n\t\t};\n\n\t\t/**\n\t\t * History.unescapeHash()\n\t\t * normalize and Unescape a Hash\n\t\t * @param {String} hash\n\t\t * @return {string}\n\t\t */\n\t\tHistory.unescapeHash = function(hash){\n\t\t\t// Prepare\n\t\t\tvar result = History.normalizeHash(hash);\n\n\t\t\t// Unescape hash\n\t\t\tresult = History.unescapeString(result);\n\n\t\t\t// Return result\n\t\t\treturn result;\n\t\t};\n\n\t\t/**\n\t\t * History.normalizeHash()\n\t\t * normalize a hash across browsers\n\t\t * @return {string}\n\t\t */\n\t\tHistory.normalizeHash = function(hash){\n\t\t\t// Prepare\n\t\t\tvar result = hash.replace(/[^#]*#/,'').replace(/#.*/, '');\n\n\t\t\t// Return result\n\t\t\treturn result;\n\t\t};\n\n\t\t/**\n\t\t * History.setHash(hash)\n\t\t * Sets the document hash\n\t\t * @param {string} hash\n\t\t * @return {History}\n\t\t */\n\t\tHistory.setHash = function(hash,queue){\n\t\t\t// Prepare\n\t\t\tvar adjustedHash, State, pageUrl;\n\n\t\t\t// Handle Queueing\n\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t// Wait + Push to Queue\n\t\t\t\t//History.debug('History.setHash: we must wait', arguments);\n\t\t\t\tHistory.pushQueue({\n\t\t\t\t\tscope: History,\n\t\t\t\t\tcallback: History.setHash,\n\t\t\t\t\targs: arguments,\n\t\t\t\t\tqueue: queue\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Log\n\t\t\t//History.debug('History.setHash: called',hash);\n\n\t\t\t// Prepare\n\t\t\tadjustedHash = History.escapeHash(hash);\n\n\t\t\t// Make Busy + Continue\n\t\t\tHistory.busy(true);\n\n\t\t\t// Check if hash is a state\n\t\t\tState = History.extractState(hash,true);\n\t\t\tif ( State && !History.emulated.pushState ) {\n\t\t\t\t// Hash is a state so skip the setHash\n\t\t\t\t//History.debug('History.setHash: Hash is a state so skipping the hash set with a direct pushState call',arguments);\n\n\t\t\t\t// PushState\n\t\t\t\tHistory.pushState(State.data,State.title,State.url,false);\n\t\t\t}\n\t\t\telse if ( document.location.hash !== adjustedHash ) {\n\t\t\t\t// Hash is a proper hash, so apply it\n\n\t\t\t\t// Handle browser bugs\n\t\t\t\tif ( History.bugs.setHash ) {\n\t\t\t\t\t// Fix Safari Bug https://bugs.webkit.org/show_bug.cgi?id=56249\n\n\t\t\t\t\t// Fetch the base page\n\t\t\t\t\tpageUrl = History.getPageUrl();\n\n\t\t\t\t\t// Safari hash apply\n\t\t\t\t\tHistory.pushState(null,null,pageUrl+'#'+adjustedHash,false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Normal hash apply\n\t\t\t\t\tdocument.location.hash = adjustedHash;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\t\t/**\n\t\t * History.escape()\n\t\t * normalize and Escape a Hash\n\t\t * @return {string}\n\t\t */\n\t\tHistory.escapeHash = function(hash){\n\t\t\t// Prepare\n\t\t\tvar result = History.normalizeHash(hash);\n\n\t\t\t// Escape hash\n\t\t\tresult = window.escape(result);\n\n\t\t\t// IE6 Escape Bug\n\t\t\tif ( !History.bugs.hashEscape ) {\n\t\t\t\t// Restore common parts\n\t\t\t\tresult = result\n\t\t\t\t\t.replace(/\\%21/g,'!')\n\t\t\t\t\t.replace(/\\%26/g,'&')\n\t\t\t\t\t.replace(/\\%3D/g,'=')\n\t\t\t\t\t.replace(/\\%3F/g,'?');\n\t\t\t}\n\n\t\t\t// Return result\n\t\t\treturn result;\n\t\t};\n\n\t\t/**\n\t\t * History.getHashByUrl(url)\n\t\t * Extracts the Hash from a URL\n\t\t * @param {string} url\n\t\t * @return {string} url\n\t\t */\n\t\tHistory.getHashByUrl = function(url){\n\t\t\t// Extract the hash\n\t\t\tvar hash = String(url)\n\t\t\t\t.replace(/([^#]*)#?([^#]*)#?(.*)/, '$2')\n\t\t\t\t;\n\n\t\t\t// Unescape hash\n\t\t\thash = History.unescapeHash(hash);\n\n\t\t\t// Return hash\n\t\t\treturn hash;\n\t\t};\n\n\t\t/**\n\t\t * History.setTitle(title)\n\t\t * Applies the title to the document\n\t\t * @param {State} newState\n\t\t * @return {Boolean}\n\t\t */\n\t\tHistory.setTitle = function(newState){\n\t\t\t// Prepare\n\t\t\tvar title = newState.title,\n\t\t\t\tfirstState;\n\n\t\t\t// Initial\n\t\t\tif ( !title ) {\n\t\t\t\tfirstState = History.getStateByIndex(0);\n\t\t\t\tif ( firstState && firstState.url === newState.url ) {\n\t\t\t\t\ttitle = firstState.title||History.options.initialTitle;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Apply\n\t\t\ttry {\n\t\t\t\tdocument.getElementsByTagName('title')[0].innerHTML = title.replace('<','&lt;').replace('>','&gt;').replace(' & ',' &amp; ');\n\t\t\t}\n\t\t\tcatch ( Exception ) { }\n\t\t\tdocument.title = title;\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// Queueing\n\n\t\t/**\n\t\t * History.queues\n\t\t * The list of queues to use\n\t\t * First In, First Out\n\t\t */\n\t\tHistory.queues = [];\n\n\t\t/**\n\t\t * History.busy(value)\n\t\t * @param {boolean} value [optional]\n\t\t * @return {boolean} busy\n\t\t */\n\t\tHistory.busy = function(value){\n\t\t\t// Apply\n\t\t\tif ( typeof value !== 'undefined' ) {\n\t\t\t\t//History.debug('History.busy: changing ['+(History.busy.flag||false)+'] to ['+(value||false)+']', History.queues.length);\n\t\t\t\tHistory.busy.flag = value;\n\t\t\t}\n\t\t\t// Default\n\t\t\telse if ( typeof History.busy.flag === 'undefined' ) {\n\t\t\t\tHistory.busy.flag = false;\n\t\t\t}\n\n\t\t\t// Queue\n\t\t\tif ( !History.busy.flag ) {\n\t\t\t\t// Execute the next item in the queue\n\t\t\t\tclearTimeout(History.busy.timeout);\n\t\t\t\tvar fireNext = function(){\n\t\t\t\t\tvar i, queue, item;\n\t\t\t\t\tif ( History.busy.flag ) return;\n\t\t\t\t\tfor ( i=History.queues.length-1; i >= 0; --i ) {\n\t\t\t\t\t\tqueue = History.queues[i];\n\t\t\t\t\t\tif ( queue.length === 0 ) continue;\n\t\t\t\t\t\titem = queue.shift();\n\t\t\t\t\t\tHistory.fireQueueItem(item);\n\t\t\t\t\t\tHistory.busy.timeout = setTimeout(fireNext,History.options.busyDelay);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tHistory.busy.timeout = setTimeout(fireNext,History.options.busyDelay);\n\t\t\t}\n\n\t\t\t// Return\n\t\t\treturn History.busy.flag;\n\t\t};\n\n\t\t/**\n\t\t * History.busy.flag\n\t\t */\n\t\tHistory.busy.flag = false;\n\n\t\t/**\n\t\t * History.fireQueueItem(item)\n\t\t * Fire a Queue Item\n\t\t * @param {Object} item\n\t\t * @return {Mixed} result\n\t\t */\n\t\tHistory.fireQueueItem = function(item){\n\t\t\treturn item.callback.apply(item.scope||History,item.args||[]);\n\t\t};\n\n\t\t/**\n\t\t * History.pushQueue(callback,args)\n\t\t * Add an item to the queue\n\t\t * @param {Object} item [scope,callback,args,queue]\n\t\t */\n\t\tHistory.pushQueue = function(item){\n\t\t\t// Prepare the queue\n\t\t\tHistory.queues[item.queue||0] = History.queues[item.queue||0]||[];\n\n\t\t\t// Add to the queue\n\t\t\tHistory.queues[item.queue||0].push(item);\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\t\t/**\n\t\t * History.queue (item,queue), (func,queue), (func), (item)\n\t\t * Either firs the item now if not busy, or adds it to the queue\n\t\t */\n\t\tHistory.queue = function(item,queue){\n\t\t\t// Prepare\n\t\t\tif ( typeof item === 'function' ) {\n\t\t\t\titem = {\n\t\t\t\t\tcallback: item\n\t\t\t\t};\n\t\t\t}\n\t\t\tif ( typeof queue !== 'undefined' ) {\n\t\t\t\titem.queue = queue;\n\t\t\t}\n\n\t\t\t// Handle\n\t\t\tif ( History.busy() ) {\n\t\t\t\tHistory.pushQueue(item);\n\t\t\t} else {\n\t\t\t\tHistory.fireQueueItem(item);\n\t\t\t}\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\t\t/**\n\t\t * History.clearQueue()\n\t\t * Clears the Queue\n\t\t */\n\t\tHistory.clearQueue = function(){\n\t\t\tHistory.busy.flag = false;\n\t\t\tHistory.queues = [];\n\t\t\treturn History;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// IE Bug Fix\n\n\t\t/**\n\t\t * History.stateChanged\n\t\t * States whether or not the state has changed since the last double check was initialised\n\t\t */\n\t\tHistory.stateChanged = false;\n\n\t\t/**\n\t\t * History.doubleChecker\n\t\t * Contains the timeout used for the double checks\n\t\t */\n\t\tHistory.doubleChecker = false;\n\n\t\t/**\n\t\t * History.doubleCheckComplete()\n\t\t * Complete a double check\n\t\t * @return {History}\n\t\t */\n\t\tHistory.doubleCheckComplete = function(){\n\t\t\t// Update\n\t\t\tHistory.stateChanged = true;\n\n\t\t\t// Clear\n\t\t\tHistory.doubleCheckClear();\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\t\t/**\n\t\t * History.doubleCheckClear()\n\t\t * Clear a double check\n\t\t * @return {History}\n\t\t */\n\t\tHistory.doubleCheckClear = function(){\n\t\t\t// Clear\n\t\t\tif ( History.doubleChecker ) {\n\t\t\t\tclearTimeout(History.doubleChecker);\n\t\t\t\tHistory.doubleChecker = false;\n\t\t\t}\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\t\t/**\n\t\t * History.doubleCheck()\n\t\t * Create a double check\n\t\t * @return {History}\n\t\t */\n\t\tHistory.doubleCheck = function(tryAgain){\n\t\t\t// Reset\n\t\t\tHistory.stateChanged = false;\n\t\t\tHistory.doubleCheckClear();\n\n\t\t\t// Fix IE6,IE7 bug where calling history.back or history.forward does not actually change the hash (whereas doing it manually does)\n\t\t\t// Fix Safari 5 bug where sometimes the state does not change: https://bugs.webkit.org/show_bug.cgi?id=42940\n\t\t\tif ( History.bugs.ieDoubleCheck ) {\n\t\t\t\t// Apply Check\n\t\t\t\tHistory.doubleChecker = setTimeout(\n\t\t\t\t\tfunction(){\n\t\t\t\t\t\tHistory.doubleCheckClear();\n\t\t\t\t\t\tif ( !History.stateChanged ) {\n\t\t\t\t\t\t\t//History.debug('History.doubleCheck: State has not yet changed, trying again', arguments);\n\t\t\t\t\t\t\t// Re-Attempt\n\t\t\t\t\t\t\ttryAgain();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\tHistory.options.doubleCheckInterval\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// Safari Bug Fix\n\n\t\t/**\n\t\t * History.safariStatePoll()\n\t\t * Poll the current state\n\t\t * @return {History}\n\t\t */\n\t\tHistory.safariStatePoll = function(){\n\t\t\t// Poll the URL\n\n\t\t\t// Get the Last State which has the new URL\n\t\t\tvar\n\t\t\t\turlState = History.extractState(document.location.href),\n\t\t\t\tnewState;\n\n\t\t\t// Check for a difference\n\t\t\tif ( !History.isLastSavedState(urlState) ) {\n\t\t\t\tnewState = urlState;\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if we have a state with that url\n\t\t\t// If not create it\n\t\t\tif ( !newState ) {\n\t\t\t\t//History.debug('History.safariStatePoll: new');\n\t\t\t\tnewState = History.createStateObject();\n\t\t\t}\n\n\t\t\t// Apply the New State\n\t\t\t//History.debug('History.safariStatePoll: trigger');\n\t\t\tHistory.Adapter.trigger(window,'popstate');\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// State Aliases\n\n\t\t/**\n\t\t * History.back(queue)\n\t\t * Send the browser history back one item\n\t\t * @param {Integer} queue [optional]\n\t\t */\n\t\tHistory.back = function(queue){\n\t\t\t//History.debug('History.back: called', arguments);\n\n\t\t\t// Handle Queueing\n\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t// Wait + Push to Queue\n\t\t\t\t//History.debug('History.back: we must wait', arguments);\n\t\t\t\tHistory.pushQueue({\n\t\t\t\t\tscope: History,\n\t\t\t\t\tcallback: History.back,\n\t\t\t\t\targs: arguments,\n\t\t\t\t\tqueue: queue\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Make Busy + Continue\n\t\t\tHistory.busy(true);\n\n\t\t\t// Fix certain browser bugs that prevent the state from changing\n\t\t\tHistory.doubleCheck(function(){\n\t\t\t\tHistory.back(false);\n\t\t\t});\n\n\t\t\t// Go back\n\t\t\thistory.go(-1);\n\n\t\t\t// End back closure\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.forward(queue)\n\t\t * Send the browser history forward one item\n\t\t * @param {Integer} queue [optional]\n\t\t */\n\t\tHistory.forward = function(queue){\n\t\t\t//History.debug('History.forward: called', arguments);\n\n\t\t\t// Handle Queueing\n\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t// Wait + Push to Queue\n\t\t\t\t//History.debug('History.forward: we must wait', arguments);\n\t\t\t\tHistory.pushQueue({\n\t\t\t\t\tscope: History,\n\t\t\t\t\tcallback: History.forward,\n\t\t\t\t\targs: arguments,\n\t\t\t\t\tqueue: queue\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Make Busy + Continue\n\t\t\tHistory.busy(true);\n\n\t\t\t// Fix certain browser bugs that prevent the state from changing\n\t\t\tHistory.doubleCheck(function(){\n\t\t\t\tHistory.forward(false);\n\t\t\t});\n\n\t\t\t// Go forward\n\t\t\thistory.go(1);\n\n\t\t\t// End forward closure\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.go(index,queue)\n\t\t * Send the browser history back or forward index times\n\t\t * @param {Integer} queue [optional]\n\t\t */\n\t\tHistory.go = function(index,queue){\n\t\t\t//History.debug('History.go: called', arguments);\n\n\t\t\t// Prepare\n\t\t\tvar i;\n\n\t\t\t// Handle\n\t\t\tif ( index > 0 ) {\n\t\t\t\t// Forward\n\t\t\t\tfor ( i=1; i<=index; ++i ) {\n\t\t\t\t\tHistory.forward(queue);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if ( index < 0 ) {\n\t\t\t\t// Backward\n\t\t\t\tfor ( i=-1; i>=index; --i ) {\n\t\t\t\t\tHistory.back(queue);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthrow new Error('History.go: History.go requires a positive or negative integer passed.');\n\t\t\t}\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// HTML5 State Support\n\n\t\t// Non-Native pushState Implementation\n\t\tif ( History.emulated.pushState ) {\n\t\t\t/*\n\t\t\t * Provide Skeleton for HTML4 Browsers\n\t\t\t */\n\n\t\t\t// Prepare\n\t\t\tvar emptyFunction = function(){};\n\t\t\tHistory.pushState = History.pushState||emptyFunction;\n\t\t\tHistory.replaceState = History.replaceState||emptyFunction;\n\t\t} // History.emulated.pushState\n\n\t\t// Native pushState Implementation\n\t\telse {\n\t\t\t/*\n\t\t\t * Use native HTML5 History API Implementation\n\t\t\t */\n\n\t\t\t/**\n\t\t\t * History.onPopState(event,extra)\n\t\t\t * Refresh the Current State\n\t\t\t */\n\t\t\tHistory.onPopState = function(event,extra){\n\t\t\t\t// Prepare\n\t\t\t\tvar stateId = false, newState = false, currentHash, currentState;\n\n\t\t\t\t// Reset the double check\n\t\t\t\tHistory.doubleCheckComplete();\n\n\t\t\t\t// Check for a Hash, and handle apporiatly\n\t\t\t\tcurrentHash\t= History.getHash();\n\t\t\t\tif ( currentHash ) {\n\t\t\t\t\t// Expand Hash\n\t\t\t\t\tcurrentState = History.extractState(currentHash||document.location.href,true);\n\t\t\t\t\tif ( currentState ) {\n\t\t\t\t\t\t// We were able to parse it, it must be a State!\n\t\t\t\t\t\t// Let's forward to replaceState\n\t\t\t\t\t\t//History.debug('History.onPopState: state anchor', currentHash, currentState);\n\t\t\t\t\t\tHistory.replaceState(currentState.data, currentState.title, currentState.url, false);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Traditional Anchor\n\t\t\t\t\t\t//History.debug('History.onPopState: traditional anchor', currentHash);\n\t\t\t\t\t\tHistory.Adapter.trigger(window,'anchorchange');\n\t\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\t}\n\n\t\t\t\t\t// We don't care for hashes\n\t\t\t\t\tHistory.expectedStateId = false;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Ensure\n\t\t\t\tstateId = History.Adapter.extractEventData('state',event,extra) || false;\n\n\t\t\t\t// Fetch State\n\t\t\t\tif ( stateId ) {\n\t\t\t\t\t// Vanilla: Back/forward button was used\n\t\t\t\t\tnewState = History.getStateById(stateId);\n\t\t\t\t}\n\t\t\t\telse if ( History.expectedStateId ) {\n\t\t\t\t\t// Vanilla: A new state was pushed, and popstate was called manually\n\t\t\t\t\tnewState = History.getStateById(History.expectedStateId);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Initial State\n\t\t\t\t\tnewState = History.extractState(document.location.href);\n\t\t\t\t}\n\n\t\t\t\t// The State did not exist in our store\n\t\t\t\tif ( !newState ) {\n\t\t\t\t\t// Regenerate the State\n\t\t\t\t\tnewState = History.createStateObject(null,null,document.location.href);\n\t\t\t\t}\n\n\t\t\t\t// Clean\n\t\t\t\tHistory.expectedStateId = false;\n\n\t\t\t\t// Check if we are the same state\n\t\t\t\tif ( History.isLastSavedState(newState) ) {\n\t\t\t\t\t// There has been no change (just the page's hash has finally propagated)\n\t\t\t\t\t//History.debug('History.onPopState: no change', newState, History.savedStates);\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Store the State\n\t\t\t\tHistory.storeState(newState);\n\t\t\t\tHistory.saveState(newState);\n\n\t\t\t\t// Force update of the title\n\t\t\t\tHistory.setTitle(newState);\n\n\t\t\t\t// Fire Our Event\n\t\t\t\tHistory.Adapter.trigger(window,'statechange');\n\t\t\t\tHistory.busy(false);\n\n\t\t\t\t// Return true\n\t\t\t\treturn true;\n\t\t\t};\n\t\t\tHistory.Adapter.bind(window,'popstate',History.onPopState);\n\n\t\t\t/**\n\t\t\t * History.pushState(data,title,url)\n\t\t\t * Add a new State to the history object, become it, and trigger onpopstate\n\t\t\t * We have to trigger for HTML4 compatibility\n\t\t\t * @param {object} data\n\t\t\t * @param {string} title\n\t\t\t * @param {string} url\n\t\t\t * @return {true}\n\t\t\t */\n\t\t\tHistory.pushState = function(data,title,url,queue){\n\t\t\t\t//History.debug('History.pushState: called', arguments);\n\n\t\t\t\t// Check the State\n\t\t\t\tif ( History.getHashByUrl(url) && History.emulated.pushState ) {\n\t\t\t\t\tthrow new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');\n\t\t\t\t}\n\n\t\t\t\t// Handle Queueing\n\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t//History.debug('History.pushState: we must wait', arguments);\n\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\tcallback: History.pushState,\n\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Make Busy + Continue\n\t\t\t\tHistory.busy(true);\n\n\t\t\t\t// Create the newState\n\t\t\t\tvar newState = History.createStateObject(data,title,url);\n\n\t\t\t\t// Check it\n\t\t\t\tif ( History.isLastSavedState(newState) ) {\n\t\t\t\t\t// Won't be a change\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Store the newState\n\t\t\t\t\tHistory.storeState(newState);\n\t\t\t\t\tHistory.expectedStateId = newState.id;\n\n\t\t\t\t\t// Push the newState\n\t\t\t\t\thistory.pushState(newState.id,newState.title,newState.url);\n\n\t\t\t\t\t// Fire HTML5 Event\n\t\t\t\t\tHistory.Adapter.trigger(window,'popstate');\n\t\t\t\t}\n\n\t\t\t\t// End pushState closure\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.replaceState(data,title,url)\n\t\t\t * Replace the State and trigger onpopstate\n\t\t\t * We have to trigger for HTML4 compatibility\n\t\t\t * @param {object} data\n\t\t\t * @param {string} title\n\t\t\t * @param {string} url\n\t\t\t * @return {true}\n\t\t\t */\n\t\t\tHistory.replaceState = function(data,title,url,queue){\n\t\t\t\t//History.debug('History.replaceState: called', arguments);\n\n\t\t\t\t// Check the State\n\t\t\t\tif ( History.getHashByUrl(url) && History.emulated.pushState ) {\n\t\t\t\t\tthrow new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');\n\t\t\t\t}\n\n\t\t\t\t// Handle Queueing\n\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t//History.debug('History.replaceState: we must wait', arguments);\n\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\tcallback: History.replaceState,\n\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Make Busy + Continue\n\t\t\t\tHistory.busy(true);\n\n\t\t\t\t// Create the newState\n\t\t\t\tvar newState = History.createStateObject(data,title,url);\n\n\t\t\t\t// Check it\n\t\t\t\tif ( History.isLastSavedState(newState) ) {\n\t\t\t\t\t// Won't be a change\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Store the newState\n\t\t\t\t\tHistory.storeState(newState);\n\t\t\t\t\tHistory.expectedStateId = newState.id;\n\n\t\t\t\t\t// Push the newState\n\t\t\t\t\thistory.replaceState(newState.id,newState.title,newState.url);\n\n\t\t\t\t\t// Fire HTML5 Event\n\t\t\t\t\tHistory.Adapter.trigger(window,'popstate');\n\t\t\t\t}\n\n\t\t\t\t// End replaceState closure\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t} // !History.emulated.pushState\n\n\n\t\t// ====================================================================\n\t\t// Initialise\n\n\t\t/**\n\t\t * Load the Store\n\t\t */\n\t\tif ( sessionStorage ) {\n\t\t\t// Fetch\n\t\t\ttry {\n\t\t\t\tHistory.store = JSON.parse(sessionStorage.getItem('History.store'))||{};\n\t\t\t}\n\t\t\tcatch ( err ) {\n\t\t\t\tHistory.store = {};\n\t\t\t}\n\n\t\t\t// Normalize\n\t\t\tHistory.normalizeStore();\n\t\t}\n\t\telse {\n\t\t\t// Default Load\n\t\t\tHistory.store = {};\n\t\t\tHistory.normalizeStore();\n\t\t}\n\n\t\t/**\n\t\t * Clear Intervals on exit to prevent memory leaks\n\t\t */\n\t\tHistory.Adapter.bind(window,\"beforeunload\",History.clearAllIntervals);\n\t\tHistory.Adapter.bind(window,\"unload\",History.clearAllIntervals);\n\n\t\t/**\n\t\t * Create the initial State\n\t\t */\n\t\tHistory.saveState(History.storeState(History.extractState(document.location.href,true)));\n\n\t\t/**\n\t\t * Bind for Saving Store\n\t\t */\n\t\tif ( sessionStorage ) {\n\t\t\t// When the page is closed\n\t\t\tHistory.onUnload = function(){\n\t\t\t\t// Prepare\n\t\t\t\tvar\tcurrentStore, item;\n\n\t\t\t\t// Fetch\n\t\t\t\ttry {\n\t\t\t\t\tcurrentStore = JSON.parse(sessionStorage.getItem('History.store'))||{};\n\t\t\t\t}\n\t\t\t\tcatch ( err ) {\n\t\t\t\t\tcurrentStore = {};\n\t\t\t\t}\n\n\t\t\t\t// Ensure\n\t\t\t\tcurrentStore.idToState = currentStore.idToState || {};\n\t\t\t\tcurrentStore.urlToId = currentStore.urlToId || {};\n\t\t\t\tcurrentStore.stateToId = currentStore.stateToId || {};\n\n\t\t\t\t// Sync\n\t\t\t\tfor ( item in History.idToState ) {\n\t\t\t\t\tif ( !History.idToState.hasOwnProperty(item) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentStore.idToState[item] = History.idToState[item];\n\t\t\t\t}\n\t\t\t\tfor ( item in History.urlToId ) {\n\t\t\t\t\tif ( !History.urlToId.hasOwnProperty(item) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentStore.urlToId[item] = History.urlToId[item];\n\t\t\t\t}\n\t\t\t\tfor ( item in History.stateToId ) {\n\t\t\t\t\tif ( !History.stateToId.hasOwnProperty(item) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentStore.stateToId[item] = History.stateToId[item];\n\t\t\t\t}\n\n\t\t\t\t// Update\n\t\t\t\tHistory.store = currentStore;\n\t\t\t\tHistory.normalizeStore();\n\n\t\t\t\t// Store\n\t\t\t\tsessionStorage.setItem('History.store',JSON.stringify(currentStore));\n\t\t\t};\n\n\t\t\t// For Internet Explorer\n\t\t\tHistory.intervalList.push(setInterval(History.onUnload,History.options.storeInterval));\n\t\t\t\n\t\t\t// For Other Browsers\n\t\t\tHistory.Adapter.bind(window,'beforeunload',History.onUnload);\n\t\t\tHistory.Adapter.bind(window,'unload',History.onUnload);\n\t\t\t\n\t\t\t// Both are enabled for consistency\n\t\t}\n\n\t\t// Non-Native pushState Implementation\n\t\tif ( !History.emulated.pushState ) {\n\t\t\t// Be aware, the following is only for native pushState implementations\n\t\t\t// If you are wanting to include something for all browsers\n\t\t\t// Then include it above this if block\n\n\t\t\t/**\n\t\t\t * Setup Safari Fix\n\t\t\t */\n\t\t\tif ( History.bugs.safariPoll ) {\n\t\t\t\tHistory.intervalList.push(setInterval(History.safariStatePoll, History.options.safariPollInterval));\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Ensure Cross Browser Compatibility\n\t\t\t */\n\t\t\tif ( navigator.vendor === 'Apple Computer, Inc.' || (navigator.appCodeName||'') === 'Mozilla' ) {\n\t\t\t\t/**\n\t\t\t\t * Fix Safari HashChange Issue\n\t\t\t\t */\n\n\t\t\t\t// Setup Alias\n\t\t\t\tHistory.Adapter.bind(window,'hashchange',function(){\n\t\t\t\t\tHistory.Adapter.trigger(window,'popstate');\n\t\t\t\t});\n\n\t\t\t\t// Initialise Alias\n\t\t\t\tif ( History.getHash() ) {\n\t\t\t\t\tHistory.Adapter.onDomLoad(function(){\n\t\t\t\t\t\tHistory.Adapter.trigger(window,'hashchange');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t} // !History.emulated.pushState\n\n\n\t}; // History.initCore\n\n\t// Try and Initialise History\n\tHistory.init();\n\n})(window);\n"]}